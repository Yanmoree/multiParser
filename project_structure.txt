–°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê
=================
–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: /Users/yanmore/IdeaProjects/multiParser
–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞: 2026-02-02T22:07:11.395023

================================================================================

[DIR] multiParser

  [FILE] cookies_debug_20260119_111051.properties
    –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/cookies_debug_20260119_111051.properties
    –†–∞–∑–º–µ—Ä: 707 –±–∞–π—Ç
    –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T08:10:51.547108795Z
    –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
    ----------------------------------------
    #Debug cookies from Selenium
    #Mon Jan 19 11:10:51 MSK 2026
    _m_h5_tk=b12d2a731e6520d120e8161ce5fe04b9_1768819591926
    _m_h5_tk_enc=249a48b09dd379e555bcfb051f1bcd97
    _samesite_flag_=true
    _tb_token_=f9e88355b71e3
    cna=/NT0IfVnoCECAZH5bfmSUNgE
    cookie2=1e0d1a49c3fe5c7836bd5bc4c9285c87
    mtop_partitioned_detect=1
    t=d09c844f0516a76e622a53cf60c5c174
    tfstk=gz1nfMbBrhiblCnai0RQLxvSAiwTdBOWAghJ2QKzQh-62ytpvaSlrZJPvBdKE7bPYL5p9wIGZMIOJksJ90VljhI-wwClCbbfP6UBwyOCRQOzDoFAZw_BNDIjhkqO7z8WZe-n8GC5RQOzDaBi9lQCvGjOqQRzSC8k80RrTQzi_UtZTUlezczMPhRrTXlEQN8p-XlyLg7aSUtw4QJF4CzMPh-yaQ7wgu-h4iCa2fSpf0bwW1YHKn7UsbllsjpH0w-iamfM-u-V8hcrZnWq5v_P4ucJgtsGZK-G4TDZ3qZINFzRsYMWLFTMDGwoA-6vlsk_SPD0Rp86WIUgSYgHLFTMzP4ihJ9e5eEA.
    xlly_s=1
    ----------------------------------------

  [FILE] cookies_backup.json
    –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/cookies_backup.json
    –†–∞–∑–º–µ—Ä: 234 –±–∞–π—Ç
    –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-15T21:52:33.371178586Z
    –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
    ----------------------------------------
    {"cookie2":"5a79ddd35987b6f0","t":"1768513953364","cna":"494076cb8fea546e6cf5b1ce","_m_h5_tk_enc":"dd9f12d7ed319f2cd4f8f1ff2f0e9078","isg":"BO559b452585b8aa255d6fc31daab814","_m_h5_tk":"e9da8ac727806d44dbb99febdd72dbd9_1768513953364"}
    ----------------------------------------

  [FILE] cookies.properties
    –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/cookies.properties
    –†–∞–∑–º–µ—Ä: 2120 –±–∞–π—Ç
    –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-02-02T19:04:48.170073454Z
    –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
    ----------------------------------------
    #Cookies for HTTP requests
    #Auto-generated file
    #Mon Feb 02 22:04:48 MSK 2026
    h5api.m.goofish.com.cookies=t\=e8e3f74f7eb79ed1ccb2d633e21835c9; cna\=SOMHIm/z8VcCAZH5bfkv7YY8; _m_h5_tk_enc\=eb054554c7ea9c395bf3a5737c064063; _samesite_flag_\=true; tfstk\=g_SSf7VNY6I4psy89byq1u_9DgKCR-rNwv9dI9nrp3KRpH6dKBRy8B7jOsCc8TRPYZOCMsOJzaWUAs5ci_WPL9HBps-J-aReaBtCK1w4_lrNETxH25PabCbCTL-H9k-LunCk3bYb_lrNEyZPIuVNzkuRipvpvLLKyteXBpKppeCpMEp9QbKpv6eXkLJB9YLJJIHvLIdpvHCdH-9eMLKpv6BYhpbw6P9bFBW7dqfCH9kXhTdjvDIbPUO1e2oKvi9WPdWJGTWPcLTW1eNXC9j1BTIMdM2tRB954rmw1woZRxTivKOah-gn-pvJjLtkhRU9yKvc3-wjWvYJnK9Lh-gnFUpDFEybhbQh.; mtop_partitioned_detect\=1; _m_h5_tk\=3364347f5e6ca18bd79d4050a426c6da_1770068073965; _tb_token_\=5ef55f3ef8788; cookie2\=106ff634d28df18b87a910c4a588a2f8
    m.goofish.com.cookies=t\=e8e3f74f7eb79ed1ccb2d633e21835c9; cna\=SOMHIm/z8VcCAZH5bfkv7YY8; _m_h5_tk_enc\=eb054554c7ea9c395bf3a5737c064063; _samesite_flag_\=true; tfstk\=g_SSf7VNY6I4psy89byq1u_9DgKCR-rNwv9dI9nrp3KRpH6dKBRy8B7jOsCc8TRPYZOCMsOJzaWUAs5ci_WPL9HBps-J-aReaBtCK1w4_lrNETxH25PabCbCTL-H9k-LunCk3bYb_lrNEyZPIuVNzkuRipvpvLLKyteXBpKppeCpMEp9QbKpv6eXkLJB9YLJJIHvLIdpvHCdH-9eMLKpv6BYhpbw6P9bFBW7dqfCH9kXhTdjvDIbPUO1e2oKvi9WPdWJGTWPcLTW1eNXC9j1BTIMdM2tRB954rmw1woZRxTivKOah-gn-pvJjLtkhRU9yKvc3-wjWvYJnK9Lh-gnFUpDFEybhbQh.; mtop_partitioned_detect\=1; _m_h5_tk\=3364347f5e6ca18bd79d4050a426c6da_1770068073965; _tb_token_\=5ef55f3ef8788; cookie2\=106ff634d28df18b87a910c4a588a2f8
    www.goofish.com.cookies=t\=e8e3f74f7eb79ed1ccb2d633e21835c9; cna\=SOMHIm/z8VcCAZH5bfkv7YY8; _m_h5_tk_enc\=eb054554c7ea9c395bf3a5737c064063; _samesite_flag_\=true; tfstk\=g_SSf7VNY6I4psy89byq1u_9DgKCR-rNwv9dI9nrp3KRpH6dKBRy8B7jOsCc8TRPYZOCMsOJzaWUAs5ci_WPL9HBps-J-aReaBtCK1w4_lrNETxH25PabCbCTL-H9k-LunCk3bYb_lrNEyZPIuVNzkuRipvpvLLKyteXBpKppeCpMEp9QbKpv6eXkLJB9YLJJIHvLIdpvHCdH-9eMLKpv6BYhpbw6P9bFBW7dqfCH9kXhTdjvDIbPUO1e2oKvi9WPdWJGTWPcLTW1eNXC9j1BTIMdM2tRB954rmw1woZRxTivKOah-gn-pvJjLtkhRU9yKvc3-wjWvYJnK9Lh-gnFUpDFEybhbQh.; mtop_partitioned_detect\=1; _m_h5_tk\=3364347f5e6ca18bd79d4050a426c6da_1770068073965; _tb_token_\=5ef55f3ef8788; cookie2\=106ff634d28df18b87a910c4a588a2f8
    ----------------------------------------

  [FILE] cookies_debug_20260119_110719.properties
    –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/cookies_debug_20260119_110719.properties
    –†–∞–∑–º–µ—Ä: 707 –±–∞–π—Ç
    –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T08:07:19.924885946Z
    –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
    ----------------------------------------
    #Debug cookies from Selenium
    #Mon Jan 19 11:07:19 MSK 2026
    _m_h5_tk=a2fb5ecd01473606f2bfd7945c52c0be_1768817939872
    _m_h5_tk_enc=44dce6002c231414b419f226d3965ae8
    _samesite_flag_=true
    _tb_token_=3087353eee3f7
    cna=J9T0IXmu2XgCAZH5bfkjRUxx
    cookie2=1403bde346bb58557e386148aeba44a0
    mtop_partitioned_detect=1
    t=64133aecceeb26e02f50523e13365762
    tfstk=gShIfFtqa0hZA08p2M8NfPxg6mNWuFRqvaa-o4CFyWFKy7g-rurUUuk1VcniU2rEaAZSXcZLLvuyNcoijDuEz4Q7ycPLEvrzYuNSrmTw0IRq-2Vu9n-2ghVGckFu2QPJQ5n37M260IRq-LOEoBxqL2SQWz48wyeRwGL_kzFR9yn8XRUYuMF8w0L_Br4C9wCRpNCT8lE8w7n-WFazXyF8w0395zbwRKa6RuuBu-MZWAA472E1w_h6dJZjJT5RwfaQd7uLf2gI1ywQc8G805Gjk2h0PbYAFuaC4YC4cY5VFNwcwPZ25F6lE657l0PfA60_pP4i7FT1Ha2LSPaJ5F6lRJUgRR865MHl.
    xlly_s=1
    ----------------------------------------

  [FILE] cookies_debug_20260119_110644.properties
    –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/cookies_debug_20260119_110644.properties
    –†–∞–∑–º–µ—Ä: 914 –±–∞–π—Ç
    –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T08:06:44.215926548Z
    –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
    ----------------------------------------
    #Debug cookies from Selenium
    #Mon Jan 19 11:06:44 MSK 2026
    _m_h5_tk=7d68b9a8674a1132b8409fa14f718b8d_1768820435299
    _m_h5_tk_enc=483c9281f86a55476fbbad9e30330cd1
    _samesite_flag_=true
    _tb_token_=f7334330313bf
    cna=DdT0IfMdNC4CAZH5bflo0D4h
    cookie2=1e2b09a51b2586a50f3677fbb24e450a
    mtop_partitioned_detect=1
    t=f2a9ba561f3ed1eec3a8f82a1ee30ebb
    tfstk=gZPKdb1c4NLdNjf1DBXGqIVdfg_GIO4UKkzXZ0mHFlETlr-nFWc32LE3zuD5YXV8XzZA84jUZeyamrO3t9lkwXlrNijcisYU8blSPpECDDz_74_iRCylTacrNijGis4U8brKK-DKdP_tr4vWRuMBChiZueGSAYt6CqisVbZSFf9szqvWADi75N3rf0GSNuG1W4msVbG7VP_N5QnWdDR8K9aPkoTSVQO762HdGyi6NVPtJvnbRXRWNEgKpmaIfMdfYqD8vvFG9nuLCrnf4nF0MQZ2mm3kdNQ9ULkI7hJCkUI0QsUIWmbw0LJrLAutmNIeULkIvVncJ_pyUA7N.
    x5secdata=xg009017cece8e3989jaee31abb12c2ae6ec2a9abdbb212344cb1768809997a-717315356a1781995901abaad3eaa33b4c7594061890541dfbd6da8ac0c001efxianyuSpace_default__bx__h5api.m.goofish.com\:443/h5/mtop.taobao.idlemtopsearch.pc.search/1.0
    ----------------------------------------

  [FILE] pom.xml
    –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/pom.xml
    –†–∞–∑–º–µ—Ä: 5093 –±–∞–π—Ç
    –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T23:35:23.299531773Z
    –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
    ----------------------------------------
    <project xmlns="http://maven.apache.org/POM/4.0.0"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
             http://maven.apache.org/xsd/maven-4.0.0.xsd">
        <modelVersion>4.0.0</modelVersion>
    
        <groupId>com.parser</groupId>
        <artifactId>product-parser</artifactId>
        <version>1.0.0</version>
        <packaging>jar</packaging>
    
        <properties>
            <maven.compiler.source>17</maven.compiler.source>
            <maven.compiler.target>17</maven.compiler.target>
            <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
            <selenium.version>4.20.0</selenium.version>
        </properties>
    
        <dependencies>
            <!-- HTTP –∫–ª–∏–µ–Ω—Ç -->
            <dependency>
                <groupId>org.apache.httpcomponents</groupId>
                <artifactId>httpclient</artifactId>
                <version>4.5.14</version>
            </dependency>
    
            <!-- JSON -->
            <dependency>
                <groupId>org.json</groupId>
                <artifactId>json</artifactId>
                <version>20231013</version>
            </dependency>
    
    
            <dependency>
                <groupId>io.github.bonigarcia</groupId>
                <artifactId>webdrivermanager</artifactId>
                <version>5.8.0</version>
            </dependency>
    
            <!-- Telegram -->
            <dependency>
                <groupId>org.telegram</groupId>
                <artifactId>telegrambots</artifactId>
                <version>6.8.0</version>
            </dependency>
    
            <!-- Logging -->
            <dependency>
                <groupId>ch.qos.logback</groupId>
                <artifactId>logback-classic</artifactId>
                <version>1.4.11</version>
            </dependency>
    
            <!-- Jackson -->
            <dependency>
                <groupId>com.fasterxml.jackson.core</groupId>
                <artifactId>jackson-databind</artifactId>
                <version>2.15.3</version>
            </dependency>
    
            <!-- Selenium -->
            <dependency>
                <groupId>org.seleniumhq.selenium</groupId>
                <artifactId>selenium-java</artifactId>
                <version>${selenium.version}</version>
            </dependency>
    
    
            <!-- Apache Commons –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ -->
            <dependency>
                <groupId>org.apache.commons</groupId>
                <artifactId>commons-lang3</artifactId>
                <version>3.14.0</version>
            </dependency>
    
            <dependency>
                <groupId>com.github.luben</groupId>
                <artifactId>zstd-jni</artifactId>
                <version>1.5.5-5</version>
            </dependency>
    
            <!-- SLF4J API -->
            <dependency>
                <groupId>org.slf4j</groupId>
                <artifactId>slf4j-api</artifactId>
                <version>2.0.9</version>
            </dependency>
        </dependencies>
    
        <build>
            <plugins>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-compiler-plugin</artifactId>
                    <version>3.11.0</version>
                    <configuration>
                        <source>17</source>
                        <target>17</target>
                        <encoding>UTF-8</encoding>
                    </configuration>
                </plugin>
    
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-shade-plugin</artifactId>
                    <version>3.5.0</version>
                    <executions>
                        <execution>
                            <phase>package</phase>
                            <goals>
                                <goal>shade</goal>
                            </goals>
                            <configuration>
                                <transformers>
                                    <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                                        <mainClass>com.parser.Main</mainClass>
                                    </transformer>
                                </transformers>
                                <filters>
                                    <filter>
                                        <artifact>*:*</artifact>
                                        <excludes>
                                            <exclude>META-INF/*.SF</exclude>
                                            <exclude>META-INF/*.DSA</exclude>
                                            <exclude>META-INF/*.RSA</exclude>
                                            <exclude>META-INF/*.EC</exclude>
                                            <exclude>META-INF/NOTICE*</exclude>
                                            <exclude>META-INF/LICENSE*</exclude>
                                            <exclude>META-INF/versions/*</exclude>
                                            <exclude>META-INF/maven/**</exclude>
                                        </excludes>
                                    </filter>
                                </filters>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
            </plugins>
        </build>
    </project>
    ----------------------------------------
  [DIR] logs

  [FILE] dependency-reduced-pom.xml
    –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/dependency-reduced-pom.xml
    –†–∞–∑–º–µ—Ä: 2216 –±–∞–π—Ç
    –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-02-02T19:00:39.562929284Z
    –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
    ----------------------------------------
    <?xml version="1.0" encoding="UTF-8"?>
    <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
      <modelVersion>4.0.0</modelVersion>
      <groupId>com.parser</groupId>
      <artifactId>product-parser</artifactId>
      <version>1.0.0</version>
      <build>
        <plugins>
          <plugin>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>3.11.0</version>
            <configuration>
              <source>17</source>
              <target>17</target>
              <encoding>UTF-8</encoding>
            </configuration>
          </plugin>
          <plugin>
            <artifactId>maven-shade-plugin</artifactId>
            <version>3.5.0</version>
            <executions>
              <execution>
                <phase>package</phase>
                <goals>
                  <goal>shade</goal>
                </goals>
                <configuration>
                  <transformers>
                    <transformer>
                      <mainClass>com.parser.Main</mainClass>
                    </transformer>
                  </transformers>
                  <filters>
                    <filter>
                      <artifact>*:*</artifact>
                      <excludes>
                        <exclude>META-INF/*.SF</exclude>
                        <exclude>META-INF/*.DSA</exclude>
                        <exclude>META-INF/*.RSA</exclude>
                        <exclude>META-INF/*.EC</exclude>
                        <exclude>META-INF/NOTICE*</exclude>
                        <exclude>META-INF/LICENSE*</exclude>
                        <exclude>META-INF/versions/*</exclude>
                        <exclude>META-INF/maven/**</exclude>
                      </excludes>
                    </filter>
                  </filters>
                </configuration>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
      <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.target>17</maven.compiler.target>
        <selenium.version>4.20.0</selenium.version>
        <maven.compiler.source>17</maven.compiler.source>
      </properties>
    </project>
    ----------------------------------------

  [FILE] .gitignore
    –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/.gitignore
    –†–∞–∑–º–µ—Ä: 0 –±–∞–π—Ç
    –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-17T12:50:01.802474294Z
    [–ë–ò–ù–ê–†–ù–´–ô –§–ê–ô–õ –ò–õ–ò –°–õ–ò–®–ö–û–ú –ë–û–õ–¨–®–û–ô]
  [DIR] .mvn
  [DIR] data

    [FILE] whitelist.txt
      –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/whitelist.txt
      –†–∞–∑–º–µ—Ä: 136 –±–∞–π—Ç
      –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-29T10:55:50.388651323Z
      –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
      ----------------------------------------
      # Whitelist - authorized users
      # Format: one user ID per line
      # Created: Thu Jan 29 13:55:50 MSK 2026
      
      1080595280
      1652510924
      5328022266
      ----------------------------------------
    [DIR] user_queries

      [FILE] 1080595280.txt
        –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/user_queries/1080595280.txt
        –†–∞–∑–º–µ—Ä: 22 –±–∞–π—Ç
        –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T07:36:06.709025027Z
        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
        ----------------------------------------
        stone island
        cav empt
        ----------------------------------------

      [FILE] 5328022266.txt
        –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/user_queries/5328022266.txt
        –†–∞–∑–º–µ—Ä: 23 –±–∞–π—Ç
        –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T07:42:44.706382918Z
        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
        ----------------------------------------
        number nine
        raf simons
        ----------------------------------------
    [DIR] logs
    [DIR] user_products
    [DIR] sent_products
    [DIR] user_settings

      [FILE] 6937423668.json
        –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/user_settings/6937423668.json
        –†–∞–∑–º–µ—Ä: 334 –±–∞–π—Ç
        –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-17T21:22:17.000818167Z
        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
        ----------------------------------------
        {"checkInterval":20,"maxAgeMinutes":1440,"maxPages":3,"rowsPerPage":500,"priceCurrency":"rubles","notifyNewOnly":true,"notifyTelegram":true,"notifyEmail":false,"notifySound":true,"minPrice":0.0,"maxPrice":0.0,"locations":[],"excludedKeywords":[],"enableProxy":false,"proxyAddress":"","proxyPort":0,"requestDelay":2000,"maxRetries":3}
        ----------------------------------------

      [FILE] 5328022266.json
        –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/user_settings/5328022266.json
        –†–∞–∑–º–µ—Ä: 227 –±–∞–π—Ç
        –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T07:43:10.908043946Z
        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
        ----------------------------------------
        {"checkInterval":300,"maxAgeMinutes":1440,"maxPages":3,"rowsPerPage":100,"priceCurrency":"rubles","notifyNewOnly":true,"notifyTelegram":true,"notifyEmail":false,"minPrice":0.0,"maxPrice":0.0,"requestDelay":2000,"maxRetries":3}
        ----------------------------------------

      [FILE] 1080595280.json
        –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/user_settings/1080595280.json
        –†–∞–∑–º–µ—Ä: 335 –±–∞–π—Ç
        –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-29T10:53:09.510649779Z
        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
        ----------------------------------------
        {"checkInterval":20,"maxAgeMinutes":1440,"maxPages":3,"rowsPerPage":500,"priceCurrency":"rubles","notifyNewOnly":false,"notifyTelegram":true,"notifyEmail":false,"notifySound":true,"minPrice":0.0,"maxPrice":0.0,"locations":[],"excludedKeywords":[],"enableProxy":false,"proxyAddress":"","proxyPort":0,"requestDelay":2000,"maxRetries":3}
        ----------------------------------------

    [FILE] user_6937423668_queries.txt
      –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/user_6937423668_queries.txt
      –†–∞–∑–º–µ—Ä: 13 –±–∞–π—Ç
      –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-17T15:22:23.938396657Z
      –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
      ----------------------------------------
      stone island
      ----------------------------------------
    [DIR] data

      [FILE] whitelist.txt
        –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/data/whitelist.txt
        –†–∞–∑–º–µ—Ä: 114 –±–∞–π—Ç
        –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-20T08:42:33.667681455Z
        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
        ----------------------------------------
        # Whitelist - authorized users
        # Format: one user ID per line
        # Created: Tue Jan 20 11:42:33 MSK 2026
        
        1080595280
        ----------------------------------------
      [DIR] sent_products

        [FILE] user_1080595280.txt
          –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/data/sent_products/user_1080595280.txt
          –†–∞–∑–º–µ—Ä: 140 –±–∞–π—Ç
          –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-02-02T19:05:18.423146543Z
          –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
          ----------------------------------------
          1017965551724
          1020224548404
          1017900287383
          1019333209711
          1017981123243
          1017950847552
          1018532542947
          1020262756125
          1018451522440
          1018443154622
          ----------------------------------------

    [FILE] user_1080595280_queries.txt
      –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/user_1080595280_queries.txt
      –†–∞–∑–º–µ—Ä: 9 –±–∞–π—Ç
      –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-28T19:11:57.254333202Z
      –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
      ----------------------------------------
      cav empt
      ----------------------------------------
    [DIR] backups

    [FILE] access_requests.txt
      –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/data/access_requests.txt
      –†–∞–∑–º–µ—Ä: 52 –±–∞–π—Ç
      –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-29T10:55:59.759454594Z
      –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
      ----------------------------------------
      6937423668|2026-01-29 13:55:59|unauthorized_command
      ----------------------------------------

  [FILE] cookies_debug_20260119_110601.properties
    –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/cookies_debug_20260119_110601.properties
    –†–∞–∑–º–µ—Ä: 707 –±–∞–π—Ç
    –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T08:06:01.137442836Z
    –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
    ----------------------------------------
    #Debug cookies from Selenium
    #Mon Jan 19 11:06:01 MSK 2026
    _m_h5_tk=03ffba78ff01b19a143f62da64ed7518_1768819991518
    _m_h5_tk_enc=fbbdfeddb5169b78b9cd607444edc4b4
    _samesite_flag_=true
    _tb_token_=30534765ade34
    cna=vNP0ITpe7B4CAZH5bfmZYBFQ
    cookie2=14d4fe13fa81de8fa73e38ce3ce3eb9a
    mtop_partitioned_detect=1
    t=9bbd9ee8e9bdd9d9ebbebb787f244820
    tfstk=gvcjfutE_chyRdYvXi8PVzAkW4VsMUREDNat-VCVWSFxW5gtSlr4Qlk5f0noQqrq_YZs20ZY3xuw10ooqmuq7VQ_W0PYIxra0lNsSDTyYBREoqVgMH-eTqnZJ2PgXCP9U7n0zi2WYBREoKU0_4KE3qWfcP4T6reO6aL7JPFODRnT28UL8iFT6cL7eP4QWZCYDuE8RuET65ntyUaa2rFT6c3JPPbCQpaWlluX8JM85X9Hkqr561h7lEZKluaurbabhkHuV13jNrwbvqGpVjd85vhQnDKP3oHQhgrhTkMNTO_7K1U7YUT5IOfV1yiaVC_E1-Uur48WP9QgHz47WUT5IZwYrrwyPUsxI
    xlly_s=1
    ----------------------------------------
  [DIR] src
    [DIR] test
      [DIR] java
    [DIR] main
      [DIR] resources

        [FILE] logback.xml
          –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/resources/logback.xml
          –†–∞–∑–º–µ—Ä: 1358 –±–∞–π—Ç
          –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-16T19:18:24.207912756Z
          –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
          ----------------------------------------
          <?xml version="1.0" encoding="UTF-8"?>
          <configuration>
              <property name="LOG_DIR" value="./logs" />
              <property name="LOG_FILE" value="parser" />
          
              <!-- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –∞–ø–ø–µ–Ω–¥–µ—Ä -->
              <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
                  <encoder>
                      <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
                  </encoder>
              </appender>
          
              <!-- –§–∞–π–ª–æ–≤—ã–π –∞–ø–ø–µ–Ω–¥–µ—Ä -->
              <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
                  <file>${LOG_DIR}/${LOG_FILE}.log</file>
                  <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
                      <fileNamePattern>${LOG_DIR}/${LOG_FILE}.%d{yyyy-MM-dd}.log</fileNamePattern>
                      <maxHistory>30</maxHistory>
                      <totalSizeCap>1GB</totalSizeCap>
                  </rollingPolicy>
                  <encoder>
                      <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
                  </encoder>
              </appender>
          
              <!-- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Selenium -->
              <logger name="org.openqa.selenium" level="WARN" />
              <logger name="io.github.bonigarcia" level="WARN" />
          
              <!-- –ö–æ—Ä–Ω–µ–≤–æ–π –ª–æ–≥–≥–µ—Ä -->
              <root level="INFO">
                  <appender-ref ref="CONSOLE" />
                  <appender-ref ref="FILE" />
              </root>
          </configuration>
          ----------------------------------------

        [FILE] cookie.properties
          –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/resources/cookie.properties
          –†–∞–∑–º–µ—Ä: 233 –±–∞–π—Ç
          –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T09:31:29.778055459Z
          –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
          ----------------------------------------
          h5api.m.goofish.com.cookies=_m_h5_tk=abc123def456_1705420800000; _m_h5_tk_enc=abc123def456_1705420800000; _tb_token_=xyz789; cna=test123; t=md5hash123; cookie2=md5hash456; _samesite_flag_=true; XSRF-TOKEN=token123; isg=BC_randomtoken
          ----------------------------------------

        [FILE] logback-debug.xml
          –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/resources/logback-debug.xml
          –†–∞–∑–º–µ—Ä: 363 –±–∞–π—Ç
          –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-16T19:22:31.341841447Z
          –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
          ----------------------------------------
          <?xml version="1.0" encoding="UTF-8"?>
          <configuration>
              <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
                  <encoder>
                      <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
                  </encoder>
              </appender>
          
              <root level="DEBUG">
                  <appender-ref ref="CONSOLE" />
              </root>
          </configuration>
          ----------------------------------------

        [FILE] config.properties
          –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/resources/config.properties
          –†–∞–∑–º–µ—Ä: 1369 –±–∞–π—Ç
          –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-02-02T19:00:28.434188371Z
          –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
          ----------------------------------------
          # ======================
          # Telegram Bot Settings
          # ======================
          telegram.bot.token=8538627254:AAE_niIKdyWgM69JSrto7tKntao5vS7qj5g
          telegram.bot.username=goofishparse_bot
          telegram.admin.id=1080595280
          
          # Parser Configuration
          parser.default.check_interval=20
          parser.default.max_age_minutes=1440
          parser.default.rows_per_page=30
          parser.default.max_pages=20
          parser.default.notify_new_only=true
          
          # Thread Pool Configuration
          thread.pool.core.size=5
          thread.pool.max.size=20
          thread.pool.queue.capacity=100
          thread.pool.keepalive.seconds=60
          
          # Storage Configuration
          storage.data.dir=./data
          storage.backup.enabled=true
          storage.backup.interval.hours=24
          
          # HTTP Configuration
          http.connect.timeout=30000
          http.read.timeout=45000
          http.user.agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
          http.max.retries=3
          http.retry.delay=1000
          
          # Cookie Configuration
          cookie.file=cookies.properties
          cookie.auto.update=true
          cookie.update.interval.minutes=60
          cookie.backup.enabled=true
          cookie.dynamic.enabled=true
          cookie.cache.ttl.minutes=30
          
          # Logging Configuration
          logging.level=INFO
          logging.file=parser.log
          logging.max.size.mb=10
          logging.max.backups=5
          
          # API Configuration
          api.goofish.base_url=https://h5api.m.goofish.com
          api.goofish.search.endpoint=/h5/mtop.taobao.idlemtopsearch.pc.search/1.0/
          api.goofish.delay.between.requests=2000
          api.goofish.max.products.per.page=500
          ----------------------------------------
      [DIR] java
        [DIR] com
          [DIR] parser
            [DIR] core

              [FILE] UserSession.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/core/UserSession.java
                –†–∞–∑–º–µ—Ä: 9510 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T09:31:29.768832921Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.core;
                
                import com.parser.config.ParserSettings;
                import com.parser.model.UserSettings;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                
                import java.util.*;
                
                /**
                 * –ö–ª–∞—Å—Å, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π —Å–µ—Å—Å–∏—é –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                 */
                public class UserSession {
                    private static final Logger logger = LoggerFactory.getLogger(UserSession.class);
                
                    private final long userId;
                    private final List<String> queries;
                    private final UserSettings settings;
                
                    // –°–æ—Å—Ç–æ—è–Ω–∏–µ
                    private volatile boolean running;
                    private volatile boolean paused;
                    private String status;
                    private String lastError;
                
                    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    private int totalProductsFound;
                    private int requestsMade;
                    private int errorsCount;
                
                    // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
                    private Date startTime;
                    private Date endTime;
                    private Date lastIterationTime;
                    private Date lastProductFoundTime;
                
                    // –ò—Å—Ç–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 100)
                    private final List<Map<String, Object>> recentProducts;
                
                    public UserSession(long userId, List<String> queries, UserSettings settings) {
                        this.userId = userId;
                        this.queries = new ArrayList<>(queries);
                        this.settings = settings;
                        this.running = false;
                        this.paused = false;
                        this.status = ParserSettings.STATUS_STOPPED;
                        this.totalProductsFound = 0;
                        this.requestsMade = 0;
                        this.errorsCount = 0;
                        this.recentProducts = new LinkedList<>();
                    }
                
                    // –ì–µ—Ç—Ç–µ—Ä—ã
                    public long getUserId() {
                        return userId;
                    }
                
                    public List<String> getQueries() {
                        return new ArrayList<>(queries);
                    }
                
                    public UserSettings getSettings() {
                        return settings;
                    }
                
                    public boolean isRunning() {
                        return running;
                    }
                
                    public boolean isPaused() {
                        return paused;
                    }
                
                    public String getStatus() {
                        return status;
                    }
                
                    public String getLastError() {
                        return lastError;
                    }
                
                    public int getTotalProductsFound() {
                        return totalProductsFound;
                    }
                
                    public int getRequestsMade() {
                        return requestsMade;
                    }
                
                    public int getErrorsCount() {
                        return errorsCount;
                    }
                
                    public Date getStartTime() {
                        return startTime;
                    }
                
                    public Date getEndTime() {
                        return endTime;
                    }
                
                    public Date getLastIterationTime() {
                        return lastIterationTime;
                    }
                
                    public Date getLastProductFoundTime() {
                        return lastProductFoundTime;
                    }
                
                    public List<Map<String, Object>> getRecentProducts() {
                        return new ArrayList<>(recentProducts);
                    }
                
                    // –°–µ—Ç—Ç–µ—Ä—ã
                    public void setRunning(boolean running) {
                        this.running = running;
                        this.status = running ? ParserSettings.STATUS_RUNNING : ParserSettings.STATUS_STOPPED;
                        if (running) {
                            this.startTime = new Date();
                        } else {
                            this.endTime = new Date();
                        }
                    }
                
                    public void setPaused(boolean paused) {
                        this.paused = paused;
                        this.status = paused ? ParserSettings.STATUS_PAUSED :
                                (running ? ParserSettings.STATUS_RUNNING : ParserSettings.STATUS_STOPPED);
                    }
                
                    public void setStatus(String status) {
                        this.status = status;
                    }
                
                    public void setLastError(String lastError) {
                        this.lastError = lastError;
                    }
                
                    public void setStartTime(Date startTime) {
                        this.startTime = startTime;
                    }
                
                    public void setEndTime(Date endTime) {
                        this.endTime = endTime;
                    }
                
                    public void setLastIterationTime(Date lastIterationTime) {
                        this.lastIterationTime = lastIterationTime;
                    }
                
                    public void setLastProductFoundTime(Date lastProductFoundTime) {
                        this.lastProductFoundTime = lastProductFoundTime;
                    }
                
                    // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
                    public void addProductsFound(int count) {
                        this.totalProductsFound += count;
                        this.lastProductFoundTime = new Date();
                    }
                
                    public void incrementRequestsMade() {
                        this.requestsMade++;
                    }
                
                    public void incrementErrors() {
                        this.errorsCount++;
                    }
                
                    public void addRecentProduct(Map<String, Object> productInfo) {
                        synchronized (recentProducts) {
                            recentProducts.add(0, productInfo); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
                
                            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
                            if (recentProducts.size() > 100) {
                                recentProducts.remove(recentProducts.size() - 1);
                            }
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Å—Å–∏–∏
                     */
                    public Map<String, Object> getDetailedStatus() {
                        Map<String, Object> status = new HashMap<>();
                
                        status.put("userId", userId);
                        status.put("running", running);
                        status.put("paused", paused);
                        status.put("status", this.status);
                        status.put("queriesCount", queries.size());
                        status.put("totalProductsFound", totalProductsFound);
                        status.put("requestsMade", requestsMade);
                        status.put("errorsCount", errorsCount);
                        status.put("lastError", lastError);
                
                        // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
                        status.put("startTime", startTime != null ? startTime.getTime() : null);
                        status.put("endTime", endTime != null ? endTime.getTime() : null);
                        status.put("lastIterationTime", lastIterationTime != null ? lastIterationTime.getTime() : null);
                        status.put("lastProductFoundTime", lastProductFoundTime != null ? lastProductFoundTime.getTime() : null);
                
                        // Uptime
                        if (startTime != null) {
                            long uptime = System.currentTimeMillis() - startTime.getTime();
                            status.put("uptime", formatUptime(uptime));
                        }
                
                        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                        if (settings != null) {
                            Map<String, Object> settingsMap = new HashMap<>();
                            settingsMap.put("checkInterval", settings.getCheckInterval());
                            settingsMap.put("maxAgeMinutes", settings.getMaxAgeMinutes());
                            settingsMap.put("maxPages", settings.getMaxPages());
                            settingsMap.put("rowsPerPage", settings.getRowsPerPage());
                            settingsMap.put("priceCurrency", settings.getPriceCurrency());
                            settingsMap.put("notifyNewOnly", settings.isNotifyNewOnly());
                            status.put("settings", settingsMap);
                        }
                
                        // –ó–∞–ø—Ä–æ—Å—ã (–ø–µ—Ä–≤—ã–µ 5)
                        status.put("sampleQueries", queries.size() > 5 ?
                                queries.subList(0, 5) : queries);
                
                        return status;
                    }
                
                    /**
                     * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã
                     */
                    private String formatUptime(long millis) {
                        long seconds = millis / 1000;
                        long minutes = seconds / 60;
                        long hours = minutes / 60;
                        long days = hours / 24;
                
                        if (days > 0) {
                            return String.format("%d–¥ %d—á %d–º", days, hours % 24, minutes % 60);
                        } else if (hours > 0) {
                            return String.format("%d—á %d–º %d—Å", hours, minutes % 60, seconds % 60);
                        } else if (minutes > 0) {
                            return String.format("%d–º %d—Å", minutes, seconds % 60);
                        } else {
                            return String.format("%d—Å", seconds);
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                     */
                    public Map<String, Object> getEfficiencyStats() {
                        Map<String, Object> stats = new HashMap<>();
                
                        if (requestsMade > 0) {
                            double productsPerRequest = (double) totalProductsFound / requestsMade;
                            double errorRate = (double) errorsCount / requestsMade;
                
                            stats.put("productsPerRequest", Math.round(productsPerRequest * 100.0) / 100.0);
                            stats.put("errorRate", Math.round(errorRate * 10000.0) / 100.0); // –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
                            stats.put("successRate", Math.round((1 - errorRate) * 10000.0) / 100.0);
                        }
                
                        if (startTime != null && lastIterationTime != null) {
                            long avgIterationTime = (lastIterationTime.getTime() - startTime.getTime()) /
                                    Math.max(requestsMade, 1);
                            stats.put("avgIterationTimeMs", avgIterationTime);
                        }
                
                        return stats;
                    }
                
                    /**
                     * –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                     */
                    public void resetStatistics() {
                        totalProductsFound = 0;
                        requestsMade = 0;
                        errorsCount = 0;
                        recentProducts.clear();
                        lastError = null;
                        logger.info("Statistics reset for user {}", userId);
                    }
                
                    /**
                     * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
                     */
                    public boolean updateQueries(List<String> newQueries) {
                        if (newQueries == null || newQueries.isEmpty()) {
                            logger.warn("Attempted to set empty queries for user {}", userId);
                            return false;
                        }
                
                        this.queries.clear();
                        this.queries.addAll(newQueries);
                        logger.debug("Queries updated for user {}, now has {} queries",
                                userId, queries.size());
                        return true;
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞, –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ —Å–µ—Å—Å–∏—è
                     */
                    public boolean isActive() {
                        return running && !paused;
                    }
                
                    @Override
                    public String toString() {
                        return String.format("UserSession{userId=%d, running=%s, queries=%d, found=%d}",
                                userId, running, queries.size(), totalProductsFound);
                    }
                }
                ----------------------------------------

              [FILE] ThreadManager.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/core/ThreadManager.java
                –†–∞–∑–º–µ—Ä: 19024 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-02-02T18:58:35.828059332Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.core;
                
                import com.parser.config.Config;
                import com.parser.model.Product;
                import com.parser.model.UserSettings;
                import com.parser.parser.ParserFactory;
                import com.parser.parser.SiteParser;
                import com.parser.service.CookieService;
                import com.parser.storage.UserDataManager;
                import com.parser.storage.UserSentProductsManager;
                import com.parser.storage.WhitelistManager;
                import com.parser.telegram.TelegramNotificationService;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                
                import java.nio.charset.StandardCharsets;
                import java.util.*;
                import java.util.concurrent.*;
                
                /**
                 * –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                 */
                public class ThreadManager {
                    private static final Logger logger = LoggerFactory.getLogger(ThreadManager.class);
                
                    private final Map<Long, UserSession> userSessions = new ConcurrentHashMap<>();
                    private final ThreadPoolExecutor threadPool;
                    private final ScheduledExecutorService scheduler;
                
                    private int totalProductsFound = 0;
                    private int totalRequestsMade = 0;
                    private final Date startTime = new Date();
                
                    public ThreadManager() {
                        int coreSize = Config.getThreadPoolCoreSize();
                        int maxSize = Config.getThreadPoolMaxSize();
                        int keepAlive = Config.getInt("thread.pool.keepalive.seconds", 60);
                
                        BlockingQueue<Runnable> workQueue = new LinkedBlockingQueue<>(50);
                        threadPool = new ThreadPoolExecutor(coreSize, maxSize, keepAlive, TimeUnit.SECONDS,
                                workQueue, new ThreadPoolExecutor.CallerRunsPolicy());
                
                        scheduler = Executors.newScheduledThreadPool(1);
                
                        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
                        scheduler.scheduleAtFixedRate(this::logStatistics, 10, 10, TimeUnit.MINUTES);
                
                        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–∫ –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
                        if (Config.getCookieAutoUpdate()) {
                            int interval = Config.getCookieUpdateInterval();
                            scheduler.scheduleAtFixedRate(() -> {
                                try {
                                    if (Config.isDynamicCookiesEnabled()) {
                                        logger.info("Auto-updating cookies...");
                                        CookieService.refreshCookies("www.goofish.com");
                                    }
                                } catch (Exception e) {
                                    logger.error("Cookie auto-update failed: {}", e.getMessage());
                                }
                            }, interval, interval, TimeUnit.MINUTES);
                        }
                
                        logger.info("ThreadManager initialized: core={}, max={}", coreSize, maxSize);
                    }
                
                    public boolean startUserParser(long userId) {
                        logger.info("Starting parser for user {}", userId);
                
                        // üî¥ –ü–†–û–í–ï–†–ö–ê WHITELIST
                        if (!WhitelistManager.isUserAllowed(userId)) {
                            logger.warn("User {} not in whitelist", userId);
                            TelegramNotificationService.sendMessage(userId, "‚ùå You are not authorized to use this bot");
                            return false;
                        }
                
                        if (userSessions.containsKey(userId) && userSessions.get(userId).isRunning()) {
                            TelegramNotificationService.sendMessage(userId, "‚ö†Ô∏è Parser already running");
                            return false;
                        }
                
                        List<String> queries = UserDataManager.getUserQueries(userId);
                        if (queries.isEmpty()) {
                            TelegramNotificationService.sendMessage(userId, "üì≠ No search queries added. Use /addquery");
                            return false;
                        }
                
                        UserSettings settings = UserDataManager.getUserSettings(userId);
                        UserSession session = new UserSession(userId, queries, settings);
                        userSessions.put(userId, session);
                
                        threadPool.submit(() -> runUserParser(session));
                
                        logger.info("Parser started for user {}: {} queries", userId, queries.size());
                        TelegramNotificationService.sendMessage(userId,
                                "‚úÖ Parser started!\nQueries: " + queries.size() + "\nCheck interval: " + settings.getCheckInterval() + " sec");
                
                        return true;
                    }
                
                    private void runUserParser(UserSession session) {
                        long userId = session.getUserId();
                        session.setRunning(true);
                
                        logger.info("Parser loop started for user {}", userId);
                
                        try {
                            SiteParser parser = ParserFactory.createParser("goofish");
                
                            while (session.isRunning() && !Thread.currentThread().isInterrupted()) {
                                for (String query : session.getQueries()) {
                                    if (!session.isRunning()) break;
                
                                    try {
                                        List<Product> products = parser.search(
                                                query,
                                                session.getSettings().getMaxPages(),
                                                session.getSettings().getRowsPerPage(),
                                                session.getSettings().getMaxAgeMinutes()
                                        );
                
                                        totalRequestsMade++;
                                        session.incrementRequestsMade();
                
                                        if (!products.isEmpty()) {
                                            session.addProductsFound(products.size());
                                            totalProductsFound += products.size();
                
                                            // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–∞–º–∞ —Ä–µ—à–∞–µ—Ç, –µ—Å—Ç—å –ª–∏ —á—Ç–æ —Å–ª–∞—Ç—å (–∏ —á—Ç–æ —Å—á–∏—Ç–∞—Ç—å "–Ω–æ–≤—ã–º")
                                            sendProductNotifications(userId, products, query, session.getSettings());
                
                                            // –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∫–∞–∂–¥—ã–π —Ä–∞–∑: –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –∫ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º
                                            UserDataManager.addUserProducts(userId, products);
                                        }
                
                                        Thread.sleep(Config.getInt("api.goofish.delay.between.requests", 2000));
                
                                    } catch (Exception e) {
                                        logger.error("Error searching '{}' for user {}: {}", query, userId, e.getMessage());
                                        session.incrementErrors();
                                        session.setLastError("Search error: " + e.getMessage());
                
                                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                                        TelegramNotificationService.sendMessage(userId,
                                                "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ '" + query + "': " + e.getMessage());
                
                                        Thread.sleep(5000);
                                    }
                                }
                
                                // –û–±–Ω–æ–≤–ª—è–µ–º cookies –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
                                // –≠—Ç–æ –ù–ï –º–µ–Ω—è–µ—Ç user-agent/–∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å, –∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤.
                                if (session.isRunning() && Config.isDynamicCookiesEnabled()) {
                                    try {
                                        logger.info("üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies –ø–æ—Å–ª–µ —Ü–∏–∫–ª–∞ (user={})", userId);
                                        CookieService.refreshCookies("www.goofish.com");
                                    } catch (Exception e) {
                                        logger.warn("Cookie refresh after cycle failed (user={}): {}", userId, e.getMessage());
                                    }
                                }
                
                                int interval = session.getSettings().getCheckInterval();
                                for (int i = 0; i < interval && session.isRunning(); i++) {
                                    Thread.sleep(1000);
                                }
                
                                session.setLastIterationTime(new Date());
                            }
                
                        } catch (InterruptedException e) {
                            Thread.currentThread().interrupt();
                            logger.info("Parser thread interrupted for user {}", userId);
                        } catch (Exception e) {
                            logger.error("Parser error for user {}: {}", userId, e.getMessage(), e);
                            TelegramNotificationService.sendMessage(userId,
                                    "‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞: " + e.getMessage());
                        } finally {
                            session.setRunning(false);
                            userSessions.remove(userId);
                            String message = String.format("üõë Parser stopped\nTotal found: %d products\nErrors: %d",
                                    session.getTotalProductsFound(), session.getErrorsCount());
                            TelegramNotificationService.sendMessage(userId, message);
                        }
                    }
                
                    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...
                    private boolean shouldSendNotification(UserSession session, List<Product> products) {
                        if (products.isEmpty()) return false;
                
                        if (session.getSettings().isNotifyNewOnly()) {
                            // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ "–Ω–æ–≤–∏–∑–Ω–∞" —Å—á–∏—Ç–∞–ª–∞—Å—å –ø–æ UserDataManager.getUserProducts().
                            // –ù–æ —Å–µ–π—á–∞—Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π –∏ "–Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã" –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è
                            // –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ (UserSentProductsManager),
                            // –ø–æ—ç—Ç–æ–º—É –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞.
                            return true;
                        }
                        return true;
                    }
                
                
                    private void sendProductNotifications(long userId, List<Product> products, String query, UserSettings settings) {
                        if (products == null || products.isEmpty()) {
                            return;
                        }
                
                        logger.info("–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: {} —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {}", products.size(), userId);
                
                        // –°–æ–±–∏—Ä–∞–µ–º ID -> Product
                        Set<String> productIds = new HashSet<>();
                        Map<String, Product> productMap = new HashMap<>();
                
                        for (Product p : products) {
                            productIds.add(p.getId());
                            productMap.put(p.getId(), p);
                        }
                
                        // üî¥ –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –ü–û–í–¢–û–†–û–í: –∏—Å–ø–æ–ª—å–∑—É–µ–º UserSentProductsManager
                        Set<String> sentProductIds = UserSentProductsManager.getSentProductsForUser(userId);
                        Set<String> newProductIds = new HashSet<>();
                
                        for (String productId : productIds) {
                            if (!sentProductIds.contains(productId)) {
                                newProductIds.add(productId);
                            }
                        }
                
                        if (newProductIds.isEmpty()) {
                            logger.debug("–ù–µ—Ç –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {}", userId);
                            return;
                        }
                
                        // –°–æ–±–∏—Ä–∞–µ–º —Ç–æ–≤–∞—Ä—ã –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ
                        List<Product> productsToSend = new ArrayList<>();
                        for (String productId : newProductIds) {
                            Product p = productMap.get(productId);
                            if (p != null) {
                                productsToSend.add(p);
                            }
                        }
                
                        logger.info("–ë—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ {} –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {} (–≤—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ {})",
                                productsToSend.size(), userId, products.size());
                
                        // üî¥ –°–û–•–†–ê–ù–Ø–ï–ú –û–¢–ü–†–ê–í–õ–ï–ù–ù–´–ï –¢–û–í–ê–†–´ –í –ò–°–¢–û–†–ò–Æ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
                        UserSentProductsManager.markProductsAsSent(userId, newProductIds);
                
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        String summary = String.format("üîç –ù–∞–π–¥–µ–Ω–æ <b>%d –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</b> –ø–æ –∑–∞–ø—Ä–æ—Å—É: <i>%s</i>\n\n",
                                productsToSend.size(), escapeHtml(query));
                        TelegramNotificationService.sendHtmlMessage(userId, summary);
                
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ –æ–¥–Ω–æ–º—É
                        for (int i = 0; i < productsToSend.size(); i++) {
                            Product p = productsToSend.get(i);
                
                            try {
                                if (p.hasCoverImage()) {
                                    sendProductWithPhoto(userId, p, i + 1, productsToSend.size());
                                } else {
                                    sendProductAsText(userId, p, i + 1, productsToSend.size());
                                }
                
                                Thread.sleep(800);
                            } catch (InterruptedException e) {
                                Thread.currentThread().interrupt();
                                break;
                            } catch (Exception e) {
                                logger.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Ç–æ–≤–∞—Ä–∞ {}: {}", p.getId(), e.getMessage());
                            }
                        }
                    }
                
                    private void sendProductWithPhoto(long userId, Product p, int number, int total) {
                        try {
                            // –°–æ–∑–¥–∞–µ–º –ø–æ–¥–ø–∏—Å—å –ø–æ–¥ —Ñ–æ—Ç–æ
                            String caption = formatProductCaption(p, number, total);
                
                            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é
                            boolean sent = TelegramNotificationService.sendPhotoWithHtmlCaption(userId,
                                    p.getCoverImageUrl(), caption);
                
                            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
                            if (!sent) {
                                sendProductAsText(userId, p, number, total);
                            }
                        } catch (Exception e) {
                            logger.warn("Failed to send photo for product {}, sending as text: {}",
                                    p.getId(), e.getMessage());
                            sendProductAsText(userId, p, number, total);
                        }
                    }
                
                    private void sendProductAsText(long userId, Product p, int number, int total) {
                        try {
                            String message = formatProductCaption(p, number, total);
                            TelegramNotificationService.sendHtmlMessage(userId, message);
                        } catch (Exception e) {
                            logger.error("Failed to send product text for {}: {}", p.getId(), e.getMessage());
                        }
                    }
                
                
                    private String formatProductMessage(Product p, UserSettings settings) {
                        return String.format("üõçÔ∏è <a href=\"%s\">%s</a>\nüí∞ %s\nüìç %s\n‚è≥ %s",
                                p.getUrl(), escapeHtml(p.getTitle()), p.getPriceDisplay(),
                                escapeHtml(p.getLocation()), p.getAgeDisplay());
                    }
                
                    private String getNumberEmoji(int number) {
                        String[] emojis = {"1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£", "8Ô∏è‚É£", "9Ô∏è‚É£", "üîü"};
                        if (number > 0 && number <= emojis.length) {
                            return emojis[number - 1];
                        }
                        return number + ".";
                    }
                
                    private String formatProductCaption(Product p, int number, int total) {
                        // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                        String fullTitle = p.getTitle();
                        if (fullTitle == null || fullTitle.isEmpty() || "No title".equals(fullTitle)) {
                            fullTitle = "–¢–æ–≤–∞—Ä #" + p.getId();
                        }
                
                        // –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–∫ –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞ —Å –ø–æ–ª–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
                        String titleLink = String.format("<a href=\"%s\"><b>%s</b></a>",
                                escapeHtml(p.getUrl()),
                                escapeHtml(fullTitle));
                
                        // üî¥ –¶–ï–ù–ê: –≤ —é–∞–Ω—è—Ö + –ø—Ä–∏–º–µ—Ä–Ω–∞—è —Ü–µ–Ω–∞ –≤ —Ä—É–±–ª—è—Ö (–∫—É—Ä—Å 12)
                        double priceYuan = p.getPrice();
                        double priceRub = priceYuan * 12; // –ö—É—Ä—Å 12 —Ä—É–±–ª–µ–π –∑–∞ —é–∞–Ω—å
                        String price = String.format("üí∞ <b>%.0f ¬•</b> (‚âà%.0f —Ä—É–±.)",
                                priceYuan, priceRub);
                
                        // üî¥ –í–û–ó–†–ê–°–¢ –¢–û–í–ê–†–ê
                        String age = String.format("‚è≥ %s", p.getAgeDisplay());
                
                        // üî¥ –õ–û–ö–ê–¶–ò–Ø (–µ—Å–ª–∏ –µ—Å—Ç—å)
                        String location = "";
                        if (p.getLocation() != null && !p.getLocation().isEmpty() && !"–ù–µ —É–∫–∞–∑–∞–Ω–æ".equals(p.getLocation())) {
                            location = String.format("\nüìç %s", escapeHtml(p.getLocation()));
                        }
                
                        // –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                        return String.format("%s\n\n%s\n%s%s", titleLink, price, age, location);
                    }
                
                    private String escapeHtml(String text) {
                        if (text == null) return "";
                        return text.replace("&", "&amp;")
                                .replace("<", "&lt;")
                                .replace(">", "&gt;")
                                .replace("\"", "&quot;")
                                .replace("'", "&#39;")
                                .replace("\n", "<br/>"); // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                    }
                
                    public boolean stopUserParser(long userId) {
                        UserSession session = userSessions.get(userId);
                        if (session != null) {
                            session.setRunning(false);
                            userSessions.remove(userId);
                            logger.info("Parser stopped for user {}", userId);
                
                            return true;
                        }
                        return false;
                    }
                
                    public boolean pauseUserParser(long userId) {
                        UserSession session = userSessions.get(userId);
                        if (session != null && session.isRunning()) {
                            session.setPaused(true);
                            logger.info("Parser paused for user {}", userId);
                            return true;
                        }
                        return false;
                    }
                
                    public boolean resumeUserParser(long userId) {
                        UserSession session = userSessions.get(userId);
                        if (session != null && session.isPaused()) {
                            session.setPaused(false);
                            logger.info("Parser resumed for user {}", userId);
                            return true;
                        }
                        return false;
                    }
                
                    public Map<String, Object> getUserStatus(long userId) {
                        UserSession session = userSessions.get(userId);
                        return session != null ? session.getDetailedStatus() : null;
                    }
                
                    public Map<String, Object> getGlobalStatistics() {
                        Map<String, Object> stats = new HashMap<>();
                        stats.put("totalUsers", userSessions.size());
                        stats.put("totalProductsFound", totalProductsFound);
                        stats.put("totalRequestsMade", totalRequestsMade);
                        stats.put("uptime", System.currentTimeMillis() - startTime.getTime());
                        stats.put("activeThreads", threadPool.getActiveCount());
                        stats.put("poolSize", threadPool.getPoolSize());
                        stats.put("dynamicCookiesEnabled", Config.isDynamicCookiesEnabled());
                        return stats;
                    }
                
                    private void logStatistics() {
                        logger.info("Stats: users={}, products={}, requests={}, threads={}/{}",
                                userSessions.size(), totalProductsFound, totalRequestsMade,
                                threadPool.getActiveCount(), threadPool.getPoolSize());
                    }
                
                    public List<Long> getActiveUsers() {
                        return new ArrayList<>(userSessions.keySet());
                    }
                
                    public boolean isUserParserRunning(long userId) {
                        UserSession session = userSessions.get(userId);
                        return session != null && session.isRunning();
                    }
                
                    public void shutdown() {
                        logger.info("Shutting down ThreadManager...");
                
                        for (long userId : new ArrayList<>(userSessions.keySet())) {
                            stopUserParser(userId);
                        }
                
                        threadPool.shutdown();
                        scheduler.shutdown();
                
                        try {
                            if (!threadPool.awaitTermination(30, TimeUnit.SECONDS)) {
                                threadPool.shutdownNow();
                            }
                            if (!scheduler.awaitTermination(10, TimeUnit.SECONDS)) {
                                scheduler.shutdownNow();
                            }
                            logger.info("ThreadManager shutdown complete");
                        } catch (InterruptedException e) {
                            threadPool.shutdownNow();
                            scheduler.shutdownNow();
                            Thread.currentThread().interrupt();
                        }
                    }
                }
                ----------------------------------------
            [DIR] test

              [FILE] SimpleTest.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/test/SimpleTest.java
                –†–∞–∑–º–µ—Ä: 1033 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T23:09:01.610800597Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.test;
                
                import org.apache.http.client.methods.HttpGet;
                import org.apache.http.util.EntityUtils;
                
                public class SimpleTest {
                    public static void main(String[] args) throws Exception {
                        // –ü—Ä–æ—Å—Ç–æ–π GET –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–∞–π—Ç
                        String url = "https://www.goofish.com/search?q=stone%20island&spm=a21ybx.search.searchInput.0";
                
                        HttpGet request = new HttpGet(url);
                        request.setHeader("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36");
                
                        try (var response = org.apache.http.impl.client.HttpClients.createDefault().execute(request)) {
                            String body = EntityUtils.toString(response.getEntity());
                            System.out.println("–°—Ç–∞—Ç—É—Å: " + response.getStatusLine().getStatusCode());
                            System.out.println("–î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞: " + body.length());
                            System.out.println("–ü–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤:");
                            System.out.println(body.substring(0, Math.min(500, body.length())));
                        }
                    }
                }
                ----------------------------------------

              [FILE] ApiTester.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/test/ApiTester.java
                –†–∞–∑–º–µ—Ä: 25478 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T23:35:14.091230081Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.test;
                
                import com.parser.service.CookieService;
                import org.apache.http.client.methods.HttpPost;
                import org.apache.http.entity.StringEntity;
                import org.apache.http.impl.client.CloseableHttpClient;
                import org.apache.http.impl.client.HttpClients;
                import org.apache.http.util.EntityUtils;
                import org.json.JSONArray;
                import org.json.JSONObject;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                
                import java.io.ByteArrayInputStream;
                import java.io.ByteArrayOutputStream;
                import java.nio.charset.StandardCharsets;
                import java.security.MessageDigest;
                import java.util.Arrays;
                import java.util.HashMap;
                import java.util.LinkedHashMap;
                import java.util.Map;
                
                // –î–ª—è zstd –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ - –¥–≤–µ –æ–ø—Ü–∏–∏:
                // –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º Apache Commons Compress (—É–∂–µ –µ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö —á–µ—Ä–µ–∑ docker-java)
                import org.apache.commons.compress.compressors.zstandard.ZstdCompressorInputStream;
                // –ò–ª–∏ –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑—É–µ–º —á–∏—Å—Ç—É—é Java –±–∏–±–ª–∏–æ—Ç–µ–∫—É (–¥–æ–±–∞–≤–∏—Ç—å –≤ pom.xml)
                // import com.github.luben.zstd.ZstdInputStream;
                
                public class ApiTester {
                    private static final Logger logger = LoggerFactory.getLogger(ApiTester.class);
                    private static final String APP_KEY = "34839810";
                
                    public static void main(String[] args) {
                        try {
                            System.out.println("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API Goofish —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–æ–¥–ø–∏—Å—å—é...");
                
                            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫—É–∫–∏
                            CookieService.initialize();
                
                            // –ü–æ–ª—É—á–∞–µ–º —Å–≤–µ–∂–∏–µ –∫—É–∫–∏
                            String domain = "h5api.m.goofish.com";
                            String cookieHeader = CookieService.getCookieHeader(domain);
                            System.out.println("üç™ –ö—É–∫–∏ –ø–æ–ª—É—á–µ–Ω—ã (–¥–ª–∏–Ω–∞: " + cookieHeader.length() + " —Å–∏–º–≤–æ–ª–æ–≤)");
                
                            // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –∫—É–∫–∏ _m_h5_tk
                            String token = extractTokenFromCookies(cookieHeader);
                            if (token.isEmpty()) {
                                System.err.println("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —Ç–æ–∫–µ–Ω –∏–∑ –∫—É–∫–∏");
                                return;
                            }
                            System.out.println("üîë –¢–æ–∫–µ–Ω: " + (token.length() > 20 ? token.substring(0, 17) + "..." : token));
                
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
                            long timestamp = System.currentTimeMillis();
                            System.out.println("‚è∞ –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: " + timestamp);
                
                            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
                            String data = buildSearchData("stone island", 1, 30);
                            System.out.println("üìù –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞: " + data.substring(0, Math.min(100, data.length())) + "...");
                
                            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å—å
                            String sign = generateSignature(token, timestamp, data);
                            System.out.println("üîê –ü–æ–¥–ø–∏—Å—å: " + sign);
                
                            // –°—Ç—Ä–æ–∏–º URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                            String url = buildApiUrl(timestamp, sign);
                            System.out.println("üì§ URL –∑–∞–ø—Ä–æ—Å–∞: " + url);
                
                            // –°–æ–∑–¥–∞–µ–º POST –∑–∞–ø—Ä–æ—Å
                            HttpPost request = new HttpPost(url);
                
                            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
                            setBrowserHeaders(request);
                
                            // –î–æ–±–∞–≤–ª—è–µ–º –∫—É–∫–∏
                            if (cookieHeader != null && !cookieHeader.isEmpty()) {
                                request.setHeader("Cookie", cookieHeader);
                                System.out.println("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫—É–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫");
                            } else {
                                System.err.println("‚ö†Ô∏è –ö—É–∫–∏ –ø—É—Å—Ç—ã–µ!");
                            }
                
                            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (application/x-www-form-urlencoded)
                            String formData = "data=" + java.net.URLEncoder.encode(data, "UTF-8");
                            request.setEntity(new StringEntity(formData, StandardCharsets.UTF_8));
                
                            // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
                            try (CloseableHttpClient client = HttpClients.createDefault();
                                 var response = client.execute(request)) {
                
                                int statusCode = response.getStatusLine().getStatusCode();
                                String contentType = response.getFirstHeader("Content-Type") != null ?
                                        response.getFirstHeader("Content-Type").getValue() : "unknown";
                                String contentEncoding = response.getFirstHeader("Content-Encoding") != null ?
                                        response.getFirstHeader("Content-Encoding").getValue() : "unknown";
                
                                System.out.println("\nüì• –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:");
                                System.out.println("–°—Ç–∞—Ç—É—Å: " + statusCode);
                                System.out.println("Content-Type: " + contentType);
                                System.out.println("Content-Encoding: " + contentEncoding);
                
                                // –í—ã–≤–æ–¥–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞
                                System.out.println("\nüìã –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:");
                                for (org.apache.http.Header header : response.getAllHeaders()) {
                                    String headerName = header.getName();
                                    String headerValue = header.getValue();
                
                                    // –°–æ–∫—Ä–∞—â–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                                    if (headerValue.length() > 100) {
                                        headerValue = headerValue.substring(0, 97) + "...";
                                    }
                
                                    System.out.println("  " + headerName + ": " + headerValue);
                
                                    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–∫–∏
                                    if ("Set-Cookie".equalsIgnoreCase(headerName)) {
                                        System.out.println("  ‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–∏–ª –∫—É–∫–∏!");
                                    }
                                }
                
                                // –ü–æ–ª—É—á–∞–µ–º —Å—ã—Ä—ã–µ –±–∞–π—Ç—ã –æ—Ç–≤–µ—Ç–∞
                                byte[] responseBytes = EntityUtils.toByteArray(response.getEntity());
                                String responseBody;
                
                                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∂–∞—Ç–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Content-Encoding
                                if ("zstd".equalsIgnoreCase(contentEncoding)) {
                                    System.out.println("\nüîÑ –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º zstd —Å–∂–∞—Ç–∏–µ...");
                                    responseBody = decompressZstd(responseBytes);
                                } else if ("gzip".equalsIgnoreCase(contentEncoding) || "deflate".equalsIgnoreCase(contentEncoding)) {
                                    // HttpClient –æ–±—ã—á–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç gzip/deflate
                                    responseBody = new String(responseBytes, StandardCharsets.UTF_8);
                                } else {
                                    // –ë–µ–∑ —Å–∂–∞—Ç–∏—è
                                    responseBody = new String(responseBytes, StandardCharsets.UTF_8);
                                }
                
                                System.out.println("\nüìÑ –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞:");
                                if (responseBody.length() > 1000) {
                                    System.out.println(responseBody.substring(0, 1000) + "...");
                                    System.out.println("... (–ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç: " + responseBody.length() + " —Å–∏–º–≤–æ–ª–æ–≤)");
                                } else {
                                    System.out.println(responseBody);
                                }
                
                                // –ü–∞—Ä—Å–∏–º JSON –æ—Ç–≤–µ—Ç
                                if (responseBody.trim().startsWith("{") || responseBody.trim().startsWith("[")) {
                                    try {
                                        JSONObject json = new JSONObject(responseBody);
                                        System.out.println("\n‚úÖ JSON —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω");
                
                                        if (json.has("ret")) {
                                            Object ret = json.get("ret");
                                            System.out.println("ret: " + ret);
                
                                            if (ret instanceof org.json.JSONArray) {
                                                org.json.JSONArray retArray = (org.json.JSONArray) ret;
                                                for (int i = 0; i < retArray.length(); i++) {
                                                    String retItem = retArray.getString(i);
                                                    System.out.println("  ret[" + i + "]: " + retItem);
                
                                                    if (retItem.contains("FAIL_SYS_ILLEGAL_ACCESS")) {
                                                        System.err.println("‚ùå –û–®–ò–ë–ö–ê: –ù–ï–ó–ê–ö–û–ù–ù–´–ô –ó–ê–ü–†–û–°!");
                                                        System.err.println("   –ü—Ä–∏—á–∏–Ω–∞: –Ω–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã");
                                                    } else if (retItem.contains("Ë¢´Êå§ÁàÜÂï¶")) {
                                                        System.err.println("‚ùå –û–®–ò–ë–ö–ê: –°–ï–†–í–ï–† –ü–ï–†–ï–ì–†–£–ñ–ï–ù!");
                                                        System.err.println("   –°–æ–æ–±—â–µ–Ω–∏–µ: " + retItem);
                                                    }
                                                }
                                            }
                                        }
                
                                        if (json.has("data")) {
                                            Object dataObj = json.get("data");
                                            System.out.println("data —Ç–∏–ø: " + dataObj.getClass().getSimpleName());
                
                                            if (dataObj instanceof JSONObject) {
                                                JSONObject dataJson = (JSONObject) dataObj;
                
                                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
                                                if (dataJson.has("resultList")) {
                                                    System.out.println("‚úÖ –ù–∞–π–¥–µ–Ω—ã —Ç–æ–≤–∞—Ä—ã –≤ resultList!");
                                                    Object resultList = dataJson.get("resultList");
                                                    if (resultList instanceof JSONArray) {
                                                        JSONArray items = (JSONArray) resultList;
                                                        System.out.println("   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤: " + items.length());
                                                        for (int i = 0; i < Math.min(3, items.length()); i++) {
                                                            System.out.println("   –¢–æ–≤–∞—Ä " + (i+1) + ": " + items.get(i));
                                                        }
                                                    }
                                                } else if (dataJson.has("items")) {
                                                    System.out.println("‚úÖ –ù–∞–π–¥–µ–Ω—ã —Ç–æ–≤–∞—Ä—ã –≤ items!");
                                                } else if (dataJson.has("list")) {
                                                    System.out.println("‚úÖ –ù–∞–π–¥–µ–Ω—ã —Ç–æ–≤–∞—Ä—ã –≤ list!");
                                                } else {
                                                    System.out.println("üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ data: " + dataJson.toString(2));
                                                }
                                            } else if (dataObj instanceof String) {
                                                System.out.println("data (—Å—Ç—Ä–æ–∫–∞): " + dataObj);
                                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                                                String dataStr = (String) dataObj;
                                                if (dataStr.contains("http") || dataStr.contains("login")) {
                                                    System.err.println("‚ö†Ô∏è  –í–æ–∑–º–æ–∂–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!");
                                                }
                                            }
                                        } else {
                                            System.out.println("üìä –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON: " + json.toString(2));
                                        }
                
                                    } catch (Exception e) {
                                        System.err.println("‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: " + e.getMessage());
                                        e.printStackTrace();
                
                                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª–æ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                                        if (responseBody.length() > 200) {
                                            System.err.println("–ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç–≤–µ—Ç–∞: " + responseBody.substring(0, 200));
                                        }
                                    }
                                } else {
                                    System.err.println("‚ùå –û—Ç–≤–µ—Ç –Ω–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON");
                                    if (responseBody.contains("<html") || responseBody.contains("<!DOCTYPE")) {
                                        System.err.println("‚ö†Ô∏è –ü–æ–ª—É—á–µ–Ω–∞ HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–º–µ—Å—Ç–æ JSON. –í–æ–∑–º–æ–∂–Ω–æ, –∫—É–∫–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã.");
                                    } else if (responseBody.length() < 100) {
                                        System.err.println("–ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç: " + responseBody);
                                    }
                                }
                
                                // –ê–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞
                                analyzeResponse(statusCode, responseBody);
                
                            }
                
                        } catch (Exception e) {
                            System.err.println("‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: " + e.getMessage());
                            e.printStackTrace();
                        }
                    }
                
                    /**
                     * –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ zstd —Å–∂–∞—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                     */
                    /**
                     * –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ zstd —Å–∂–∞—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                     */
                    private static String decompressZstd(byte[] compressedData) {
                        try {
                            System.out.println("üì¶ –†–∞–∑–º–µ—Ä —Å–∂–∞—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö: " + compressedData.length + " –±–∞–π—Ç");
                
                            try (ByteArrayInputStream bais = new ByteArrayInputStream(compressedData);
                                 org.apache.commons.compress.compressors.zstandard.ZstdCompressorInputStream zstdIn =
                                         new org.apache.commons.compress.compressors.zstandard.ZstdCompressorInputStream(bais);
                                 ByteArrayOutputStream baos = new ByteArrayOutputStream()) {
                
                                byte[] buffer = new byte[8192];
                                int len;
                                while ((len = zstdIn.read(buffer)) > 0) {
                                    baos.write(buffer, 0, len);
                                }
                
                                String result = baos.toString("UTF-8");
                                System.out.println("‚úÖ Zstd —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω");
                                System.out.println("üìÑ –†–∞–∑–º–µ—Ä —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: " + result.length() + " —Å–∏–º–≤–æ–ª–æ–≤");
                                return result;
                            }
                
                        } catch (Exception e) {
                            System.err.println("‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ zstd: " + e.getMessage());
                            e.printStackTrace();
                
                            // –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω—É—é —Å—Ç—Ä–æ–∫—É (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ zstd)
                            try {
                                String fallback = new String(compressedData, StandardCharsets.UTF_8);
                                System.out.println("‚ö†Ô∏è  –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback —á—Ç–µ–Ω–∏–µ –∫–∞–∫ UTF-8");
                                return fallback;
                            } catch (Exception e2) {
                                return "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞: " + e.getMessage();
                            }
                        }
                    }
                
                    /**
                     * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏ –∫—É–∫–∏
                     */
                    private static String extractTokenFromCookies(String cookieHeader) {
                        if (cookieHeader == null || cookieHeader.isEmpty()) {
                            return "";
                        }
                
                        // –†–∞–∑–¥–µ–ª—è–µ–º –∫—É–∫–∏ –ø–æ —Ç–æ—á–∫–µ —Å –∑–∞–ø—è—Ç–æ–π
                        String[] cookiePairs = cookieHeader.split("; ");
                        for (String pair : cookiePairs) {
                            if (pair.startsWith("_m_h5_tk=")) {
                                String value = pair.substring(9); // –£–±–∏—Ä–∞–µ–º "_m_h5_tk="
                                // –¢–æ–∫–µ–Ω - —á–∞—Å—Ç—å –¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
                                int underscoreIndex = value.indexOf('_');
                                if (underscoreIndex != -1) {
                                    return value.substring(0, underscoreIndex);
                                }
                                return value;
                            }
                        }
                
                        return "";
                    }
                
                    /**
                     * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ MD5
                     */
                    private static String generateSignature(String token, long timestamp, String data) {
                        try {
                            String signString = token + "&" + timestamp + "&" + APP_KEY + "&" + data;
                
                            MessageDigest md = MessageDigest.getInstance("MD5");
                            byte[] hash = md.digest(signString.getBytes(StandardCharsets.UTF_8));
                
                            StringBuilder hex = new StringBuilder();
                            for (byte b : hash) {
                                String h = Integer.toHexString(0xff & b);
                                if (h.length() == 1) {
                                    hex.append('0');
                                }
                                hex.append(h);
                            }
                
                            return hex.toString();
                        } catch (Exception e) {
                            System.err.println("‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏: " + e.getMessage());
                            return "";
                        }
                    }
                
                    /**
                     * –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞
                     */
                    private static String buildSearchData(String query, int page, int rows) {
                        JSONObject data = new JSONObject();
                        data.put("pageNumber", page);
                        data.put("keyword", query);
                        data.put("fromFilter", false);
                        data.put("rowsPerPage", rows);
                        data.put("sortValue", "");
                        data.put("sortField", "");
                        data.put("customDistance", "");
                        data.put("gps", "");
                        data.put("propValueStr", new JSONObject());
                        data.put("customGps", "");
                        data.put("searchReqFromPage", "pcSearch");
                        data.put("extraFilterValue", "{}");
                        data.put("userPositionJson", "{}");
                
                        return data.toString();
                    }
                
                    /**
                     * –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ URL API —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                     */
                    private static String buildApiUrl(long timestamp, String sign) {
                        Map<String, String> params = new LinkedHashMap<>();
                        params.put("jsv", "2.7.2");
                        params.put("appKey", APP_KEY);
                        params.put("t", String.valueOf(timestamp));
                        params.put("sign", sign);
                        params.put("v", "1.0");
                        params.put("type", "originaljson");
                        params.put("accountSite", "xianyu");
                        params.put("dataType", "json");
                        params.put("timeout", "20000");
                        params.put("api", "mtop.taobao.idlemtopsearch.pc.search");
                        params.put("sessionOption", "AutoLoginOnly");
                        params.put("spm_cnt", "a21ybx.search.0.0");
                        params.put("spm_pre", "a21ybx.search.searchInput.0");
                
                        StringBuilder url = new StringBuilder("https://h5api.m.goofish.com/h5/mtop.taobao.idlemtopsearch.pc.search/1.0/?");
                
                        boolean first = true;
                        for (Map.Entry<String, String> entry : params.entrySet()) {
                            if (!first) {
                                url.append("&");
                            }
                            url.append(entry.getKey())
                                    .append("=")
                                    .append(java.net.URLEncoder.encode(entry.getValue(), StandardCharsets.UTF_8));
                            first = false;
                        }
                
                        return url.toString();
                    }
                
                    /**
                     * –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –±—Ä–∞—É–∑–µ—Ä–∞
                     */
                    private static void setBrowserHeaders(HttpPost request) {
                        request.setHeader("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 YaBrowser/25.10.0.0 Safari/537.36");
                        request.setHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
                        request.setHeader("Accept", "application/json");
                        request.setHeader("Accept-Encoding", "gzip, deflate, br, zstd");
                        request.setHeader("Accept-Language", "ru,en;q=0.9");
                        request.setHeader("Origin", "https://www.goofish.com");
                        request.setHeader("Referer", "https://www.goofish.com/");
                        request.setHeader("Sec-Fetch-Dest", "empty");
                        request.setHeader("Sec-Fetch-Mode", "cors");
                        request.setHeader("Sec-Fetch-Site", "same-site");
                        request.setHeader("sec-ch-ua", "\"Chromium\";v=\"140\", \"Not=A?Brand\";v=\"24\", \"YaBrowser\";v=\"25.10\", \"Yowser\";v=\"2.5\", \"YaBrowserCorp\";v=\"140\"");
                        request.setHeader("sec-ch-ua-mobile", "?0");
                        request.setHeader("sec-ch-ua-platform", "\"macOS\"");
                        request.setHeader("x-accept-terminal", "pc");
                        request.setHeader("Connection", "keep-alive");
                        request.setHeader("Pragma", "no-cache");
                        request.setHeader("Cache-Control", "no-cache");
                    }
                
                    /**
                     * –ê–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
                     */
                    private static void analyzeResponse(int statusCode, String responseBody) {
                        System.out.println("\nüîç –ê–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞:");
                
                        if (statusCode == 200) {
                            System.out.println("‚úÖ HTTP —Å—Ç–∞—Ç—É—Å: 200 OK");
                
                            if (responseBody.contains("FAIL_SYS_ILLEGAL_ACCESS")) {
                                System.err.println("‚ùå –°–æ–¥–µ—Ä–∂–∏–º–æ–µ: –ù–ï–ó–ê–ö–û–ù–ù–´–ô –ó–ê–ü–†–û–°");
                                System.err.println("   –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:");
                                System.err.println("   1. –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å (sign)");
                                System.err.println("   2. –£—Å—Ç–∞—Ä–µ–≤—à–∏–π timestamp (t)");
                                System.err.println("   3. –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–∑ –∫—É–∫–∏ _m_h5_tk");
                                System.err.println("   4. –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö (data)");
                            } else if (responseBody.contains("FAIL_SYS_SESSION_EXPIRED")) {
                                System.err.println("‚ùå –°–æ–¥–µ—Ä–∂–∏–º–æ–µ: –°–ï–°–°–ò–Ø –ò–°–¢–ï–ö–õ–ê");
                                System.err.println("   –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–∫–∏");
                            } else if (responseBody.contains("SUCCESS")) {
                                System.out.println("‚úÖ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ: –£–°–ü–ï–®–ù–´–ô –ó–ê–ü–†–û–°");
                            } else if (responseBody.contains("resultList") || responseBody.contains("\"data\":")) {
                                System.out.println("‚úÖ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ: –ù–ê–ô–î–ï–ù–´ –î–ê–ù–ù–´–ï");
                            } else if (responseBody.contains("\"ret\":") && responseBody.contains("SUCCESS")) {
                                System.out.println("‚úÖ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ: API –£–°–ü–ï–®–ù–û –í–´–ü–û–õ–ù–ï–ù–û");
                            } else {
                                System.out.println("‚ö†Ô∏è  –°–æ–¥–µ—Ä–∂–∏–º–æ–µ: –ù–ï–ò–ó–í–ï–°–¢–ù–´–ô –û–¢–í–ï–¢");
                                System.out.println("   –ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤: " +
                                        (responseBody.length() > 200 ? responseBody.substring(0, 200) + "..." : responseBody));
                            }
                        } else if (statusCode == 403) {
                            System.err.println("‚ùå HTTP —Å—Ç–∞—Ç—É—Å: 403 FORBIDDEN");
                            System.err.println("   –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –í–æ–∑–º–æ–∂–Ω–æ, –∫—É–∫–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã.");
                        } else if (statusCode == 429) {
                            System.err.println("‚ùå HTTP —Å—Ç–∞—Ç—É—Å: 429 TOO MANY REQUESTS");
                            System.err.println("   –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É.");
                        } else if (statusCode == 401) {
                            System.err.println("‚ùå HTTP —Å—Ç–∞—Ç—É—Å: 401 UNAUTHORIZED");
                            System.err.println("   –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. –ö—É–∫–∏ —É—Å—Ç–∞—Ä–µ–ª–∏.");
                        } else {
                            System.err.println("‚ùå HTTP —Å—Ç–∞—Ç—É—Å: " + statusCode);
                        }
                    }
                
                    /**
                     * –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∫—É–∫–∏
                     */
                    private static void debugCookies(String cookieHeader) {
                        System.out.println("\nüîç –û—Ç–ª–∞–¥–∫–∞ –∫—É–∫–∏:");
                
                        if (cookieHeader == null || cookieHeader.isEmpty()) {
                            System.err.println("‚ùå –ö—É–∫–∏ –ø—É—Å—Ç—ã–µ");
                            return;
                        }
                
                        String[] cookies = cookieHeader.split("; ");
                        System.out.println("üìä –í—Å–µ–≥–æ –∫—É–∫–∏: " + cookies.length);
                
                        // –í–∞–∂–Ω—ã–µ –∫—É–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                        String[] importantCookies = {"_m_h5_tk", "_m_h5_tk_enc", "_tb_token_", "cna", "cookie2", "t", "tfstk"};
                
                        for (String cookie : cookies) {
                            String[] parts = cookie.split("=", 2);
                            if (parts.length == 2) {
                                String name = parts[0];
                                String value = parts[1];
                
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∞–∂–Ω–∞—è –ª–∏ —ç—Ç–æ –∫—É–∫–∞
                                boolean isImportant = Arrays.asList(importantCookies).contains(name);
                
                                if (isImportant) {
                                    System.out.print("‚≠ê ");
                                } else {
                                    System.out.print("   ");
                                }
                
                                System.out.print(String.format("%-25s", name + ":"));
                
                                // –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                                if (value.length() > 50) {
                                    System.out.println(value.substring(0, 47) + "...");
                                } else {
                                    System.out.println(value);
                                }
                
                                // –û—Å–æ–±—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è _m_h5_tk
                                if ("_m_h5_tk".equals(name)) {
                                    if (value.contains("_")) {
                                        String[] tokenParts = value.split("_", 2);
                                        System.out.println("        –¢–æ–∫–µ–Ω: " + tokenParts[0]);
                                        System.out.println("        –í—Ä–µ–º—è: " + tokenParts[1]);
                                        System.out.println("        –°—Ç–∞—Ç—É—Å: " + (tokenParts[0].length() == 32 ? "‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π" : "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π"));
                                    } else {
                                        System.err.println("        ‚ö†Ô∏è –ù–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏ –≤ _m_h5_tk!");
                                    }
                                }
                            }
                        }
                    }
                }
                ----------------------------------------
            [DIR] util

              [FILE] HttpUtils.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/util/HttpUtils.java
                –†–∞–∑–º–µ—Ä: 20508 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T09:31:29.777394501Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.util;
                
                import com.parser.config.Config;
                import com.parser.config.CookieConfig;
                import com.parser.service.CookieService;
                import org.apache.http.HttpHeaders;
                import org.apache.http.HttpStatus;
                import org.apache.http.client.config.CookieSpecs;
                import org.apache.http.client.config.RequestConfig;
                import org.apache.http.client.methods.CloseableHttpResponse;
                import org.apache.http.client.methods.HttpGet;
                import org.apache.http.client.methods.HttpPost;
                import org.apache.http.entity.StringEntity;
                import org.apache.http.impl.client.CloseableHttpClient;
                import org.apache.http.impl.client.HttpClients;
                import org.apache.http.impl.client.LaxRedirectStrategy;
                import org.apache.http.util.EntityUtils;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                
                import java.net.URL;
                import java.nio.charset.StandardCharsets;
                import java.util.HashMap;
                import java.util.Map;
                import java.util.Random;
                
                /**
                 * –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å HTTP –∑–∞–ø—Ä–æ—Å–∞–º–∏
                 */
                public class HttpUtils {
                    private static final Logger logger = LoggerFactory.getLogger(HttpUtils.class);
                    private static final Random random = new Random();
                
                    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫—É–∫
                    private static final String HEADER_COOKIE = "Cookie";
                    private static final String HEADER_SET_COOKIE = "Set-Cookie";
                    private static final String HEADER_CONTENT_LENGTH = "Content-Length";
                
                    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HTTP –∫–ª–∏–µ–Ω—Ç–∞
                    private static final RequestConfig requestConfig = RequestConfig.custom()
                            .setConnectTimeout(Config.getHttpConnectTimeout())
                            .setSocketTimeout(Config.getHttpReadTimeout())
                            .setConnectionRequestTimeout(5000)
                            .setRedirectsEnabled(true)
                            .setCookieSpec(CookieSpecs.STANDARD)
                            .build();
                
                    // –ü—É–ª HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤
                    private static volatile CloseableHttpClient httpClient = null;
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ HTTP –∫–ª–∏–µ–Ω—Ç–∞
                     */
                    private static synchronized CloseableHttpClient getHttpClient() {
                        if (httpClient == null) {
                            httpClient = HttpClients.custom()
                                    .setDefaultRequestConfig(requestConfig)
                                    .setRedirectStrategy(new LaxRedirectStrategy())
                                    .setUserAgent(getRandomUserAgent())
                                    .setMaxConnTotal(100)
                                    .setMaxConnPerRoute(20)
                                    .disableCookieManagement() // –£–ø—Ä–∞–≤–ª—è–µ–º –∫—É–∫–∞–º–∏ –≤—Ä—É—á–Ω—É—é
                                    .build();
                            logger.debug("HTTP client initialized");
                        }
                        return httpClient;
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ GET –∑–∞–ø—Ä–æ—Å–∞
                     */
                    public static String sendGetRequest(String url) throws Exception {
                        return sendGetRequest(url, getDefaultUserAgent(), true);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ GET –∑–∞–ø—Ä–æ—Å–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º User-Agent
                     */
                    public static String sendGetRequest(String url, String userAgent) throws Exception {
                        return sendGetRequest(url, userAgent, true);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ GET –∑–∞–ø—Ä–æ—Å–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                     */
                    public static String sendGetRequest(String url, String userAgent, boolean useCookies) throws Exception {
                        if (url == null || url.isEmpty()) {
                            throw new IllegalArgumentException("URL cannot be empty");
                        }
                
                        logger.debug("Sending GET request to: {}", url);
                
                        HttpGet request = new HttpGet(url);
                        request.setHeader(HttpHeaders.USER_AGENT, userAgent != null ? userAgent : getDefaultUserAgent());
                        request.setHeader(HttpHeaders.ACCEPT, "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8");
                        request.setHeader(HttpHeaders.ACCEPT_LANGUAGE, "en-US,en;q=0.9,ru;q=0.8");
                        request.setHeader(HttpHeaders.ACCEPT_ENCODING, "gzip, deflate, br");
                        request.setHeader(HttpHeaders.CONNECTION, "keep-alive");
                        request.setHeader("Upgrade-Insecure-Requests", "1");
                
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫—É–∫–∏, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è
                        if (useCookies) {
                            String domain = extractDomain(url);
                            try {
                                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫—É–∫–∏ –∏–∑ CookieService
                                String cookieHeader = CookieService.getCookieHeader(domain);
                                if (cookieHeader != null && !cookieHeader.isEmpty()) {
                                    request.setHeader(HEADER_COOKIE, cookieHeader);
                                    logger.debug("Added dynamic cookies for domain {} ({} chars)",
                                            domain, cookieHeader.length());
                                } else {
                                    logger.warn("No dynamic cookies available for domain: {}", domain);
                                    // Fallback –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫—É–∫–∏
                                    String cookies = CookieConfig.getCookiesForDomain(domain);
                                    if (cookies != null && !cookies.isEmpty()) {
                                        request.setHeader(HEADER_COOKIE, cookies);
                                        logger.debug("Using static cookies for domain: {}", domain);
                                    }
                                }
                            } catch (Exception e) {
                                logger.warn("Failed to get dynamic cookies for {}, falling back to static: {}",
                                        domain, e.getMessage());
                                // Fallback –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫—É–∫–∏
                                String cookies = CookieConfig.getCookiesForDomain(domain);
                                if (cookies != null && !cookies.isEmpty()) {
                                    request.setHeader(HEADER_COOKIE, cookies);
                                    logger.debug("Using static cookies for domain: {}", domain);
                                }
                            }
                        }
                
                        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
                        addRandomHeaders(request);
                
                        try (CloseableHttpResponse response = getHttpClient().execute(request)) {
                            int statusCode = response.getStatusLine().getStatusCode();
                            logger.debug("Response status: {} for URL: {}", statusCode, url);
                
                            // –û–±–Ω–æ–≤–ª—è–µ–º –∫—É–∫–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è
                            if (Config.getCookieAutoUpdate() && useCookies) {
                                updateCookiesFromResponse(url, response);
                            }
                
                            if (statusCode == HttpStatus.SC_OK) {
                                String content = EntityUtils.toString(response.getEntity(), StandardCharsets.UTF_8);
                                logger.trace("Response content length: {} chars for URL: {}", content.length(), url);
                                return content;
                            } else if (statusCode == HttpStatus.SC_TOO_MANY_REQUESTS) {
                                logger.warn("Rate limit exceeded for URL: {}", url);
                                throw new Exception("Rate limit exceeded (429)");
                            } else if (statusCode == HttpStatus.SC_FORBIDDEN) {
                                logger.warn("Access forbidden for URL: {}", url);
                                throw new Exception("Access forbidden (403) - May need fresh cookies");
                            } else if (statusCode == HttpStatus.SC_NOT_FOUND) {
                                logger.warn("URL not found: {}", url);
                                throw new Exception("Page not found (404)");
                            } else if (statusCode == HttpStatus.SC_UNAUTHORIZED) {
                                logger.warn("Unauthorized for URL: {}", url);
                                throw new Exception("Unauthorized (401) - Check cookies");
                            } else {
                                logger.warn("HTTP error {} for URL: {}", statusCode, url);
                                throw new Exception("HTTP error: " + statusCode);
                            }
                        } catch (Exception e) {
                            logger.error("Error sending request to {}: {}", url, e.getMessage());
                            throw e;
                        }
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ POST –∑–∞–ø—Ä–æ—Å–∞
                     */
                    public static String sendPostRequest(String url, String jsonBody) throws Exception {
                        return sendPostRequest(url, jsonBody, getDefaultUserAgent(), true);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ POST –∑–∞–ø—Ä–æ—Å–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                     */
                    public static String sendPostRequest(String url, String jsonBody, String userAgent, boolean useCookies) throws Exception {
                        logger.debug("Sending POST request to: {}", url);
                
                        HttpPost request = new HttpPost(url);
                        request.setHeader(HttpHeaders.USER_AGENT, userAgent != null ? userAgent : getDefaultUserAgent());
                        request.setHeader(HttpHeaders.CONTENT_TYPE, "application/json");
                        request.setHeader(HttpHeaders.ACCEPT, "application/json");
                        request.setHeader(HttpHeaders.ACCEPT_ENCODING, "gzip, deflate, br");
                
                        if (jsonBody != null && !jsonBody.isEmpty()) {
                            request.setEntity(new StringEntity(jsonBody, StandardCharsets.UTF_8));
                        }
                
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫—É–∫–∏
                        if (useCookies) {
                            String domain = extractDomain(url);
                            String cookieHeader = CookieService.getCookieHeader(domain);
                            if (cookieHeader != null && !cookieHeader.isEmpty()) {
                                request.setHeader(HEADER_COOKIE, cookieHeader);
                            }
                        }
                
                        try (CloseableHttpResponse response = getHttpClient().execute(request)) {
                            int statusCode = response.getStatusLine().getStatusCode();
                            if (statusCode == HttpStatus.SC_OK) {
                                String content = EntityUtils.toString(response.getEntity(), StandardCharsets.UTF_8);
                                logger.debug("POST response length: {} chars", content.length());
                                return content;
                            } else {
                                throw new Exception("HTTP POST error: " + statusCode);
                            }
                        }
                    }
                
                    /**
                     * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞ –∏–∑ URL
                     */
                    public static String extractDomain(String url) {
                        try {
                            URL urlObj = new URL(url);
                            return urlObj.getHost();
                        } catch (Exception e) {
                            logger.warn("Failed to extract domain from URL: {}", url);
                            return "";
                        }
                    }
                
                    /**
                     * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–∫–∏ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –æ—Ç–≤–µ—Ç–∞
                     */
                    private static void updateCookiesFromResponse(String url, CloseableHttpResponse response) {
                        try {
                            String domain = extractDomain(url);
                            org.apache.http.Header[] setCookieHeaders = response.getHeaders(HEADER_SET_COOKIE);
                
                            if (setCookieHeaders.length > 0) {
                                logger.debug("Found {} Set-Cookie headers for domain: {}", setCookieHeaders.length, domain);
                                for (org.apache.http.Header header : setCookieHeaders) {
                                    CookieConfig.parseSetCookieHeader(domain, header.getValue());
                                }
                                CookieConfig.saveCookies();
                            }
                        } catch (Exception e) {
                            logger.warn("Failed to update cookies from response: {}", e.getMessage());
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ User-Agent
                     */
                    public static String getDefaultUserAgent() {
                        return Config.getHttpUserAgent();
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ User-Agent
                     */
                    public static String getRandomUserAgent() {
                        String[] userAgents = {
                                "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
                                "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/121.0",
                                "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
                                "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
                                "Mozilla/5.0 (iPhone; CPU iPhone OS 17_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Mobile/15E148 Safari/604.1",
                                "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 YaBrowser/25.10.0.0 Safari/537.36"
                        };
                
                        return userAgents[random.nextInt(userAgents.length)];
                    }
                
                    /**
                     * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
                     */
                    private static void addRandomHeaders(HttpGet request) {
                        if (random.nextBoolean()) {
                            request.setHeader("Sec-Fetch-Dest", "document");
                            request.setHeader("Sec-Fetch-Mode", "navigate");
                            request.setHeader("Sec-Fetch-Site", "none");
                            request.setHeader("Sec-Fetch-User", "?1");
                        }
                
                        if (random.nextBoolean()) {
                            request.setHeader(HttpHeaders.CACHE_CONTROL, "max-age=0");
                        }
                
                        // –°–ª—É—á–∞–π–Ω—ã–π Referer
                        String[] referers = {
                                "https://www.google.com/",
                                "https://www.bing.com/",
                                "https://www.yahoo.com/",
                                "https://www.baidu.com/",
                                "https://h5.m.goofish.com/",
                                "https://www.goofish.com/",
                                ""
                        };
                        String referer = referers[random.nextInt(referers.length)];
                        if (!referer.isEmpty()) {
                            request.setHeader(HttpHeaders.REFERER, referer);
                        }
                    }
                
                    /**
                     * –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                     */
                    public static String encodeUrl(String value) {
                        if (value == null) {
                            return "";
                        }
                        try {
                            return java.net.URLEncoder.encode(value, StandardCharsets.UTF_8.toString());
                        } catch (Exception e) {
                            logger.error("Error encoding URL value: {}", e.getMessage());
                            return value;
                        }
                    }
                
                    /**
                     * –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                     */
                    public static String decodeUrl(String value) {
                        if (value == null) {
                            return "";
                        }
                        try {
                            return java.net.URLDecoder.decode(value, StandardCharsets.UTF_8.toString());
                        } catch (Exception e) {
                            logger.error("Error decoding URL value: {}", e.getMessage());
                            return value;
                        }
                    }
                
                    /**
                     * –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
                     */
                    public static void randomDelay(int minMs, int maxMs) {
                        try {
                            int delay = minMs + random.nextInt(maxMs - minMs);
                            Thread.sleep(delay);
                        } catch (InterruptedException e) {
                            Thread.currentThread().interrupt();
                            logger.warn("Delay interrupted");
                        }
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ URL
                     */
                    public static boolean isUrlAccessible(String url) {
                        return isUrlAccessible(url, getDefaultUserAgent(), true);
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ URL —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—É–∫–∏
                     */
                    public static boolean isUrlAccessible(String url, String userAgent, boolean useCookies) {
                        try {
                            HttpGet request = new HttpGet(url);
                            request.setHeader(HttpHeaders.USER_AGENT, userAgent != null ? userAgent : getDefaultUserAgent());
                
                            if (useCookies) {
                                String domain = extractDomain(url);
                                String cookies = CookieConfig.getCookiesForDomain(domain);
                                if (cookies != null && !cookies.isEmpty()) {
                                    request.setHeader(HEADER_COOKIE, cookies);
                                }
                            }
                
                            try (CloseableHttpResponse response = getHttpClient().execute(request)) {
                                int statusCode = response.getStatusLine().getStatusCode();
                                return statusCode == HttpStatus.SC_OK;
                            }
                        } catch (Exception e) {
                            logger.debug("URL not accessible {}: {}", url, e.getMessage());
                            return false;
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–æ URL
                     */
                    public static long getContentLength(String url) throws Exception {
                        return getContentLength(url, getDefaultUserAgent(), true);
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–æ URL —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—É–∫–∏
                     */
                    public static long getContentLength(String url, String userAgent, boolean useCookies) throws Exception {
                        try {
                            HttpGet request = new HttpGet(url);
                            request.setHeader(HttpHeaders.USER_AGENT, userAgent != null ? userAgent : getDefaultUserAgent());
                
                            if (useCookies) {
                                String domain = extractDomain(url);
                                String cookies = CookieConfig.getCookiesForDomain(domain);
                                if (cookies != null && !cookies.isEmpty()) {
                                    request.setHeader(HEADER_COOKIE, cookies);
                                }
                            }
                
                            try (CloseableHttpResponse response = getHttpClient().execute(request)) {
                                if (response.getStatusLine().getStatusCode() == HttpStatus.SC_OK) {
                                    org.apache.http.Header[] headers = response.getHeaders(HEADER_CONTENT_LENGTH);
                                    if (headers.length > 0) {
                                        try {
                                            return Long.parseLong(headers[0].getValue());
                                        } catch (NumberFormatException e) {
                                            return -1;
                                        }
                                    }
                                }
                                return -1;
                            }
                        } catch (Exception e) {
                            logger.error("Error getting content length for {}: {}", url, e.getMessage());
                            throw e;
                        }
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –∫—É–∫–∏
                     */
                    public static boolean testCookies(String url) {
                        try {
                            logger.info("Testing cookies for URL: {}", url);
                            String response = sendGetRequest(url, getDefaultUserAgent(), true);
                
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ç–æ–≥–æ, —á—Ç–æ –º—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã
                            if (response.contains("ÁôªÂΩï") || response.contains("login") ||
                                    response.contains("Êú™ÁôªÂΩï") || response.contains("Êú™ÊéàÊùÉ") ||
                                    response.contains("ËØ∑ÁôªÂΩï") || response.contains("signin")) {
                                logger.warn("Cookies appear to be invalid or expired");
                                return false;
                            }
                
                            logger.info("Cookies test successful for: {}", url);
                            return true;
                        } catch (Exception e) {
                            logger.error("Cookies test failed for {}: {}", url, e.getMessage());
                            return false;
                        }
                    }
                
                    /**
                     * –ó–∞–∫—Ä—ã—Ç–∏–µ HTTP –∫–ª–∏–µ–Ω—Ç–∞
                     */
                    public static synchronized void closeHttpClient() {
                        if (httpClient != null) {
                            try {
                                httpClient.close();
                                httpClient = null;
                                logger.debug("HTTP client closed");
                            } catch (Exception e) {
                                logger.error("Error closing HTTP client: {}", e.getMessage());
                            }
                        }
                    }
                
                    /**
                     * –°–æ–∑–¥–∞–Ω–∏–µ URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                     */
                    public static String buildUrlWithParams(String baseUrl, Map<String, String> params) {
                        StringBuilder url = new StringBuilder(baseUrl);
                        if (params != null && !params.isEmpty()) {
                            url.append("?");
                            boolean first = true;
                            for (Map.Entry<String, String> entry : params.entrySet()) {
                                if (!first) {
                                    url.append("&");
                                }
                                url.append(encodeUrl(entry.getKey()))
                                        .append("=")
                                        .append(encodeUrl(entry.getValue()));
                                first = false;
                            }
                        }
                        return url.toString();
                    }
                
                    /**
                     * –°–æ–∑–¥–∞–Ω–∏–µ URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ –º–∞—Å—Å–∏–≤–∞
                     */
                    public static String buildUrlWithParams(String baseUrl, String[][] params) {
                        Map<String, String> paramMap = new HashMap<>();
                        if (params != null) {
                            for (String[] param : params) {
                                if (param.length >= 2) {
                                    paramMap.put(param[0], param[1]);
                                }
                            }
                        }
                        return buildUrlWithParams(baseUrl, paramMap);
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ HTTP –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                     */
                    public static CloseableHttpClient getHttpClientInstance() {
                        return getHttpClient();
                    }
                }
                ----------------------------------------
            [DIR] config

              [FILE] ParserSettings.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/config/ParserSettings.java
                –†–∞–∑–º–µ—Ä: 3366 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T09:31:29.768131546Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.config;
                
                /**
                 * –ö–ª–∞—Å—Å —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–∞—Ä—Å–µ—Ä–∞
                 */
                public class ParserSettings {
                    // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                
                    public static final int MIN_CHECK_INTERVAL = 20; // —Å–µ–∫—É–Ω–¥
                    public static final int MAX_CHECK_INTERVAL = 3600; // —Å–µ–∫—É–Ω–¥
                
                    public static final int MIN_MAX_AGE_MINUTES = 1;
                    public static final int MAX_MAX_AGE_MINUTES = 10080; // 7 –¥–Ω–µ–π
                
                    public static final int MIN_MAX_PAGES = 1;
                    public static final int MAX_MAX_PAGES = 50;
                
                    public static final int MIN_ROWS_PER_PAGE = 10;
                    public static final int MAX_ROWS_PER_PAGE = 1000;
                
                    // –ö–æ–¥—ã –≤–∞–ª—é—Ç
                    public static final String CURRENCY_YUAN = "yuan";
                    public static final String CURRENCY_RUBLES = "rubles";
                
                    // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–∞–π—Ç—ã
                    public static final String SITE_GOOFISH = "goofish";
                    public static final String SITE_TAOBAO = "taobao";
                    public static final String SITE_JD = "jd";
                
                    // –°—Ç–∞—Ç—É—Å—ã –ø–∞—Ä—Å–µ—Ä–∞
                    public static final String STATUS_RUNNING = "running";
                    public static final String STATUS_STOPPED = "stopped";
                    public static final String STATUS_PAUSED = "paused";
                    public static final String STATUS_ERROR = "error";
                
                    // –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                    public static final String NOTIFY_TELEGRAM = "telegram";
                    public static final String NOTIFY_EMAIL = "email";
                    public static final String NOTIFY_WEBHOOK = "webhook";
                
                    /**
                     * –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
                     */
                    public static boolean isValidCheckInterval(int interval) {
                        return interval >= MIN_CHECK_INTERVAL && interval <= MAX_CHECK_INTERVAL;
                    }
                
                    /**
                     * –í–∞–ª–∏–¥–∞—Ü–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ —Ç–æ–≤–∞—Ä–∞
                     */
                    public static boolean isValidMaxAge(int maxAge) {
                        return maxAge >= MIN_MAX_AGE_MINUTES && maxAge <= MAX_MAX_AGE_MINUTES;
                    }
                
                    /**
                     * –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
                     */
                    public static int normalizeCheckInterval(int interval) {
                        return Math.max(MIN_CHECK_INTERVAL, Math.min(interval, MAX_CHECK_INTERVAL));
                    }
                
                    /**
                     * –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞
                     */
                    public static int normalizeMaxAge(int maxAge) {
                        return Math.max(MIN_MAX_AGE_MINUTES, Math.min(maxAge, MAX_MAX_AGE_MINUTES));
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–∞–π—Ç–∞
                     */
                    public static boolean isSiteSupported(String site) {
                        return SITE_GOOFISH.equalsIgnoreCase(site) ||
                                SITE_TAOBAO.equalsIgnoreCase(site) ||
                                SITE_JD.equalsIgnoreCase(site);
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å)
                     */
                    public static double getCurrencyRate(String fromCurrency, String toCurrency) {
                        if (CURRENCY_YUAN.equals(fromCurrency) && CURRENCY_RUBLES.equals(toCurrency)) {
                            return 14.0; // –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫—É—Ä—Å —é–∞–Ω—è –∫ —Ä—É–±–ª—é (—è–Ω–≤–∞—Ä—å 2026)
                        } else if (CURRENCY_RUBLES.equals(fromCurrency) && CURRENCY_YUAN.equals(toCurrency)) {
                            return 1.0 / 14.0; // –û–±—Ä–∞—Ç–Ω—ã–π –∫—É—Ä—Å
                        }
                        return 1.0;
                    }
                }
                ----------------------------------------

              [FILE] Config.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/config/Config.java
                –†–∞–∑–º–µ—Ä: 7360 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-28T19:39:31.93253313Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.config;
                
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.io.*;
                import java.util.Properties;
                
                /**
                 * –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                 */
                public class Config {
                    private static final Logger logger = LoggerFactory.getLogger(Config.class);
                    private static final Properties properties = new Properties();
                    private static final String CONFIG_FILE = "config.properties";
                    private static volatile boolean isLoaded = false;
                
                    static {
                        synchronized (Config.class) {
                            if (!isLoaded) {
                                loadProperties();
                                isLoaded = true;
                            }
                        }
                    }
                
                    private static void loadProperties() {
                        File externalConfig = new File(CONFIG_FILE);
                        if (externalConfig.exists()) {
                            try (InputStream input = new FileInputStream(externalConfig)) {
                                properties.load(new InputStreamReader(input, "UTF-8"));
                                logger.info("Loaded configuration from: {}", CONFIG_FILE);
                                return;
                            } catch (IOException e) {
                                logger.warn("Failed to load external config: {}", e.getMessage());
                            }
                        }
                
                        try (InputStream input = Thread.currentThread().getContextClassLoader().getResourceAsStream(CONFIG_FILE)) {
                            if (input != null) {
                                properties.load(new InputStreamReader(input, "UTF-8"));
                                logger.info("Loaded configuration from resources");
                            } else {
                                setDefaults();
                                logger.warn("Config file not found, using defaults");
                            }
                        } catch (IOException e) {
                            setDefaults();
                            logger.error("Error loading config: {}", e.getMessage());
                        }
                    }
                
                    private static void setDefaults() {
                        properties.setProperty("telegram.bot.token", "");
                        properties.setProperty("telegram.bot.username", "");
                        properties.setProperty("telegram.admin.id", "0");
                        properties.setProperty("parser.default.check_interval", "300");
                        properties.setProperty("parser.default.max_age_minutes", "1440");
                        properties.setProperty("parser.default.max_pages", "3");
                        properties.setProperty("parser.default.rows_per_page", "100");
                        properties.setProperty("thread.pool.core.size", "3");
                        properties.setProperty("thread.pool.max.size", "10");
                        properties.setProperty("thread.pool.keepalive.seconds", "60");
                        properties.setProperty("storage.data.dir", "./data");
                        properties.setProperty("storage.backup.enabled", "true");
                        properties.setProperty("http.connect.timeout", "10000");
                        properties.setProperty("http.read.timeout", "15000");
                        properties.setProperty("http.user.agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36");
                        properties.setProperty("cookie.auto.update", "true");
                        properties.setProperty("cookie.update.interval.minutes", "120");
                        properties.setProperty("cookie.dynamic.enabled", "true");
                        properties.setProperty("cookie.cache.ttl.minutes", "30");
                        properties.setProperty("logging.level", "INFO");
                        properties.setProperty("api.goofish.delay.between.requests", "2000");
                    }
                
                    public static int getInt(String key, int defaultValue) {
                        try {
                            return Integer.parseInt(properties.getProperty(key, String.valueOf(defaultValue)).trim());
                        } catch (NumberFormatException e) {
                            logger.warn("Invalid integer for key '{}', using default: {}", key, defaultValue);
                            return defaultValue;
                        }
                    }
                
                    public static long getLong(String key, long defaultValue) {
                        try {
                            return Long.parseLong(properties.getProperty(key, String.valueOf(defaultValue)).trim());
                        } catch (NumberFormatException e) {
                            logger.warn("Invalid long for key '{}', using default: {}", key, defaultValue);
                            return defaultValue;
                        }
                    }
                
                    public static String getString(String key, String defaultValue) {
                        String value = properties.getProperty(key, defaultValue);
                        return value != null ? value.trim() : defaultValue;
                    }
                
                    public static boolean getBoolean(String key, boolean defaultValue) {
                        String value = properties.getProperty(key, String.valueOf(defaultValue));
                        return value != null && (value.trim().toLowerCase().matches("true|yes|1"));
                    }
                
                    public static double getDouble(String key, double defaultValue) {
                        try {
                            return Double.parseDouble(properties.getProperty(key, String.valueOf(defaultValue)).trim());
                        } catch (NumberFormatException e) {
                            logger.warn("Invalid double for key '{}', using default: {}", key, defaultValue);
                            return defaultValue;
                        }
                    }
                
                    public static void setProperty(String key, String value) {
                        properties.setProperty(key, value);
                    }
                
                    public static void saveConfig() {
                        try (OutputStream output = new FileOutputStream(CONFIG_FILE)) {
                            properties.store(output, "Product Parser Configuration");
                            logger.info("Configuration saved");
                        } catch (IOException e) {
                            logger.error("Failed to save configuration: {}", e.getMessage());
                        }
                    }
                
                    public static void reload() {
                        synchronized (Config.class) {
                            properties.clear();
                            loadProperties();
                            logger.info("Configuration reloaded");
                        }
                    }
                
                    // Convenience methods
                    public static String getTelegramBotToken() {
                        return getString("telegram.bot.token", "");
                    }
                
                    public static String getTelegramBotUsername() {
                        return getString("telegram.bot.username", "");
                    }
                
                    public static long getTelegramAdminId() {
                        return getLong("telegram.admin.id", 0);
                    }
                
                    public static int getThreadPoolCoreSize() {
                        return getInt("thread.pool.core.size", 3);
                    }
                
                    public static int getThreadPoolMaxSize() {
                        return getInt("thread.pool.max.size", 10);
                    }
                
                    public static int getHttpConnectTimeout() {
                        return getInt("http.connect.timeout", 10000);
                    }
                
                    public static int getHttpReadTimeout() {
                        return getInt("http.read.timeout", 15000);
                    }
                
                    public static String getHttpUserAgent() {
                        return getString("http.user.agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36");
                    }
                
                    public static boolean isDynamicCookiesEnabled() {
                        return getBoolean("cookie.dynamic.enabled", true);
                    }
                
                    public static boolean getCookieAutoUpdate() {
                        return getBoolean("cookie.auto.update", true);
                    }
                
                    public static int getCookieUpdateInterval() {
                        return getInt("cookie.update.interval.minutes", 120);
                    }
                
                    public static String getStorageDataDir() {
                        return getString("storage.data.dir", "./data");
                    }
                
                    public static int getDefaultCheckInterval() {
                        return getInt("parser.default.check_interval", 300);
                    }
                
                    public static int getDefaultMaxAgeMinutes() {
                        return getInt("parser.default.max_age_minutes", 1440);
                    }
                
                    public static int getDefaultMaxPages() {
                        return getInt("parser.default.max_pages", 20);
                    }
                
                    public static int getDefaultRowsPerPage() {
                        return getInt("parser.default.rows_per_page", 30);
                    }
                }
                ----------------------------------------

              [FILE] CookieConfig.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/config/CookieConfig.java
                –†–∞–∑–º–µ—Ä: 10300 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T09:31:29.76763413Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.config;
                
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.io.*;
                import java.util.Properties;
                
                /**
                 * –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É–∫–∏ —Ñ–∞–π–ª–∞–º–∏
                 */
                public class CookieConfig {
                    private static final Logger logger = LoggerFactory.getLogger(CookieConfig.class);
                    private static final Properties cookies = new Properties();
                    private static final String COOKIE_FILE = "cookies.properties";
                    private static volatile boolean isLoaded = false;
                
                    static {
                        synchronized (CookieConfig.class) {
                            if (!isLoaded) {
                                loadCookies();
                                isLoaded = true;
                            }
                        }
                    }
                
                    /**
                     * –ó–∞–≥—Ä—É–∑–∫–∞ –∫—É–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞
                     */
                    private static void loadCookies() {
                        // –ü–æ–ø—ã—Ç–∫–∞ 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Ñ–∞–π–ª–∞ –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                        File externalFile = new File(COOKIE_FILE);
                        if (externalFile.exists() && externalFile.isFile()) {
                            try (InputStream input = new FileInputStream(externalFile)) {
                                cookies.load(new InputStreamReader(input, "UTF-8"));
                                logger.info("Loaded cookies from external file: {}", COOKIE_FILE);
                                return;
                            } catch (IOException e) {
                                logger.warn("Failed to load external cookie file: {}", e.getMessage());
                            }
                        }
                
                        // –ü–æ–ø—ã—Ç–∫–∞ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Ä–µ—Å—É—Ä—Å–æ–≤
                        try (InputStream input = Thread.currentThread().getContextClassLoader().getResourceAsStream(COOKIE_FILE)) {
                            if (input != null) {
                                cookies.load(new InputStreamReader(input, "UTF-8"));
                                logger.info("Loaded cookies from resources: {}", COOKIE_FILE);
                            } else {
                                logger.warn("Cookie file not found");
                            }
                        } catch (IOException e) {
                            logger.error("Error loading cookies from resources: {}", e.getMessage(), e);
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É–∫–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
                     */
                    public static String getCookiesForDomain(String domain) {
                        if (domain == null || domain.trim().isEmpty()) {
                            return "";
                        }
                
                        String key = domain.toLowerCase().trim() + ".cookies";
                        String cookiesStr = cookies.getProperty(key, "");
                        return cookiesStr != null ? cookiesStr.trim() : "";
                    }
                
                    /**
                     * –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—É–∫–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
                     */
                    public static void setCookiesForDomain(String domain, String cookieString) {
                        if (domain == null || domain.trim().isEmpty()) {
                            return;
                        }
                
                        String key = domain.toLowerCase().trim() + ".cookies";
                        cookies.setProperty(key, cookieString != null ? cookieString.trim() : "");
                        saveCookies();
                        logger.info("Cookies updated for domain: {}", domain);
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫—É–∫–∏ –ø–æ –∏–º–µ–Ω–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
                     */
                    public static String getCookie(String domain, String cookieName) {
                        if (domain == null || domain.trim().isEmpty() || cookieName == null || cookieName.trim().isEmpty()) {
                            return "";
                        }
                
                        String allCookies = getCookiesForDomain(domain);
                        if (allCookies == null || allCookies.isEmpty()) {
                            return "";
                        }
                
                        String[] cookiePairs = allCookies.split("; ");
                        for (String pair : cookiePairs) {
                            String[] parts = pair.split("=", 2);
                            if (parts.length == 2 && parts[0].trim().equals(cookieName.trim())) {
                                return parts[1].trim();
                            }
                        }
                
                        return "";
                    }
                
                    /**
                     * –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫—É–∫–∏
                     */
                    public static void setCookie(String domain, String cookieName, String cookieValue) {
                        if (domain == null || domain.trim().isEmpty() || cookieName == null || cookieName.trim().isEmpty()) {
                            return;
                        }
                
                        String key = domain.toLowerCase().trim() + ".cookies";
                        String currentCookies = cookies.getProperty(key, "");
                
                        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –∫—É–∫–∏
                        StringBuilder newCookies = new StringBuilder();
                        boolean replaced = false;
                
                        if (currentCookies != null && !currentCookies.trim().isEmpty()) {
                            String[] cookiePairs = currentCookies.split("; ");
                            for (String pair : cookiePairs) {
                                String[] parts = pair.split("=", 2);
                                if (parts.length == 2) {
                                    if (parts[0].trim().equals(cookieName.trim())) {
                                        // –ó–∞–º–µ–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫—É–∫–∏
                                        newCookies.append(cookieName.trim()).append("=").append(cookieValue != null ? cookieValue.trim() : "").append("; ");
                                        replaced = true;
                                    } else {
                                        newCookies.append(pair).append("; ");
                                    }
                                }
                            }
                        }
                
                        // –ï—Å–ª–∏ –∫—É–∫–∏ –Ω–µ –±—ã–ª–æ, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π
                        if (!replaced) {
                            newCookies.append(cookieName.trim()).append("=").append(cookieValue != null ? cookieValue.trim() : "").append("; ");
                        }
                
                        // –£–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π
                        String result = newCookies.toString();
                        if (result.endsWith("; ")) {
                            result = result.substring(0, result.length() - 2);
                        }
                
                        cookies.setProperty(key, result);
                        saveCookies();
                        logger.debug("Cookie {} set for domain {}", cookieName, domain);
                    }
                
                    /**
                     * –£–¥–∞–ª–µ–Ω–∏–µ –∫—É–∫–∏
                     */
                    public static void removeCookie(String domain, String cookieName) {
                        if (domain == null || domain.trim().isEmpty() || cookieName == null || cookieName.trim().isEmpty()) {
                            return;
                        }
                
                        String key = domain.toLowerCase().trim() + ".cookies";
                        String currentCookies = cookies.getProperty(key, "");
                
                        if (currentCookies == null || currentCookies.trim().isEmpty()) {
                            return;
                        }
                
                        StringBuilder newCookies = new StringBuilder();
                        String[] cookiePairs = currentCookies.split("; ");
                
                        for (String pair : cookiePairs) {
                            String[] parts = pair.split("=", 2);
                            if (parts.length == 2 && !parts[0].trim().equals(cookieName.trim())) {
                                if (newCookies.length() > 0) {
                                    newCookies.append("; ");
                                }
                                newCookies.append(pair);
                            }
                        }
                
                        cookies.setProperty(key, newCookies.toString());
                        saveCookies();
                        logger.debug("Cookie {} removed from domain {}", cookieName, domain);
                    }
                
                    /**
                     * –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∫—É–∫–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
                     */
                    public static void clearCookiesForDomain(String domain) {
                        if (domain == null || domain.trim().isEmpty()) {
                            return;
                        }
                
                        String key = domain.toLowerCase().trim() + ".cookies";
                        cookies.remove(key);
                        saveCookies();
                        logger.info("All cookies cleared for domain: {}", domain);
                    }
                
                    /**
                     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—É–∫–∏ –≤ —Ñ–∞–π–ª
                     */
                    public static void saveCookies() {
                        File externalFile = new File(COOKIE_FILE);
                        try (OutputStream output = new FileOutputStream(externalFile)) {
                            cookies.store(output, "Cookies for HTTP requests\nAuto-generated file");
                            logger.debug("Cookies saved to: {}", COOKIE_FILE);
                        } catch (IOException e) {
                            logger.error("Failed to save cookies: {}", e.getMessage(), e);
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤ —Å –∫—É–∫–∏
                     */
                    public static String[] getCookieDomains() {
                        return cookies.stringPropertyNames().stream()
                                .filter(key -> key != null && key.endsWith(".cookies"))
                                .map(key -> key.substring(0, key.length() - 8))
                                .toArray(String[]::new);
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫—É–∫–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
                     */
                    public static boolean hasCookiesForDomain(String domain) {
                        if (domain == null || domain.trim().isEmpty()) {
                            return false;
                        }
                
                        String key = domain.toLowerCase().trim() + ".cookies";
                        String cookieString = cookies.getProperty(key, "");
                        return cookieString != null && !cookieString.trim().isEmpty();
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫—É–∫–∏ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞
                     */
                    public static String getAllCookiesAsString(String domain) {
                        return getCookiesForDomain(domain);
                    }
                
                    /**
                     * –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ –∫—É–∫–∏ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Set-Cookie
                     */
                    public static void parseSetCookieHeader(String domain, String setCookieHeader) {
                        if (domain == null || domain.trim().isEmpty() || setCookieHeader == null || setCookieHeader.trim().isEmpty()) {
                            return;
                        }
                
                        String[] cookiesArray = setCookieHeader.split(";\\s*");
                        for (String cookie : cookiesArray) {
                            String[] parts = cookie.split("=", 2);
                            if (parts.length == 2) {
                                String name = parts[0].trim();
                                String value = parts[1].trim();
                
                                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã
                                if (name.equalsIgnoreCase("path") ||
                                        name.equalsIgnoreCase("domain") ||
                                        name.equalsIgnoreCase("expires") ||
                                        name.equalsIgnoreCase("max-age") ||
                                        name.equalsIgnoreCase("secure") ||
                                        name.equalsIgnoreCase("httponly") ||
                                        name.equalsIgnoreCase("samesite")) {
                                    continue;
                                }
                
                                setCookie(domain, name, value);
                            }
                        }
                
                        logger.debug("Parsed Set-Cookie header for domain: {}", domain);
                    }
                
                    /**
                     * –†–µ–ª–æ–∞–¥ –∫—É–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞
                     */
                    public static void reload() {
                        synchronized (CookieConfig.class) {
                            cookies.clear();
                            loadCookies();
                            logger.info("Cookies reloaded");
                        }
                    }
                }
                ----------------------------------------
            [DIR] parser

              [FILE] GoofishParser.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/parser/GoofishParser.java
                –†–∞–∑–º–µ—Ä: 36266 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-02-02T18:57:14.488095511Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.parser;import com.parser.config.Config;import com.parser.model.Product;import com.parser.service.CookieService;import com.parser.util.HttpUtils;import org.apache.http.client.methods.HttpPost;import org.apache.http.entity.StringEntity;import org.apache.http.util.EntityUtils;import org.json.JSONArray;import org.json.JSONObject;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.nio.charset.StandardCharsets;import java.security.MessageDigest;import java.util.*;import java.util.regex.Matcher;import java.util.regex.Pattern;/** * –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è Goofish —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º POST –∑–∞–ø—Ä–æ—Å–æ–º –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π zstd */public class GoofishParser extends BaseParser {    private static final Logger logger = LoggerFactory.getLogger(GoofishParser.class);    private static final String SEARCH_ENDPOINT = "/h5/mtop.taobao.idlemtopsearch.pc.search/1.0/";    private static final String APP_KEY = "34839810";    private static final Pattern PUBLISHED_AGO_ZH = Pattern.compile("(\\d+)\\s*(ÂàÜÈíü|Â∞è?Êó∂|Â§©)ÂâçÂèëÂ∏É");    private static final Random random = new Random();    private static long lastRequestTime = 0;    public GoofishParser() {        super("goofish", "https://h5api.m.goofish.com");    }    @Override    protected String buildSearchUrl(String query, int page, int rows) {        // –î–ª—è POST –∑–∞–ø—Ä–æ—Å–∞ URL —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ data        return buildApiUrl(query, page, rows);    }    /**     * –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL API     */    private String buildApiUrl(String query, int page, int rows) {        try {            long timestamp = System.currentTimeMillis();            String token = getTokenFromCookies();            if (token.isEmpty()) {                logger.error("‚ùå Token is empty! Check cookies");                return "";            }            // –§–æ—Ä–º–∏—Ä—É–µ–º data –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –ø–æ–¥–ø–∏—Å–∏            String dataStr = buildSearchData(query, page, rows);            String sign = generateSignature(token, timestamp, dataStr);            // –°—Ç—Ä–æ–∏–º URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ            Map<String, String> params = new LinkedHashMap<>();            params.put("jsv", "2.7.2");            params.put("appKey", APP_KEY);            params.put("t", String.valueOf(timestamp));            params.put("sign", sign);            params.put("v", "1.0");            params.put("type", "originaljson");            params.put("accountSite", "xianyu");            params.put("dataType", "json");            params.put("timeout", "20000");            params.put("api", "mtop.taobao.idlemtopsearch.pc.search");            params.put("sessionOption", "AutoLoginOnly");            params.put("spm_cnt", "a21ybx.search.0.0");            params.put("spm_pre", "a21ybx.search.searchInput.0");            return HttpUtils.buildUrlWithParams(baseUrl + SEARCH_ENDPOINT, params);        } catch (Exception e) {            logger.error("Error building URL: {}", e.getMessage());            return "";        }    }    /**     * –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞     */    private String buildSearchData(String query, int page, int rows) {        JSONObject data = new JSONObject();        data.put("pageNumber", page);        data.put("keyword", query);        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø—Ä–æ—Å–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∞–º—ã–µ –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–µ—Ä–≤—ã–º–∏        data.put("fromFilter", true);        data.put("rowsPerPage", rows);        data.put("sortValue", "desc");        data.put("sortField", "create");        data.put("customDistance", "");        data.put("gps", "");        JSONObject propValueStr = new JSONObject();        propValueStr.put("searchFilter", "");        data.put("propValueStr", propValueStr);        data.put("customGps", "");        data.put("searchReqFromPage", "pcSearch");        data.put("extraFilterValue", "{}");        data.put("userPositionJson", "{}");        return data.toString();    }    /**     * –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è POST –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ zstd     */    @Override    protected String executeSearchRequest(String url, String query, int page, int rows) throws Exception {        // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞        String dataStr = buildSearchData(query, page, rows);        String formData = "data=" + java.net.URLEncoder.encode(dataStr, "UTF-8");        logger.info("üì§ POST –∑–∞–ø—Ä–æ—Å –∫: {}", url);        logger.debug("üìù –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞: {}", formData);        // –°–æ–∑–¥–∞–µ–º POST –∑–∞–ø—Ä–æ—Å        HttpPost request = new HttpPost(url);        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ        request.setHeader("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 YaBrowser/25.10.0.0 Safari/537.36");        request.setHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");        request.setHeader("Accept", "application/json");        request.setHeader("Accept-Encoding", "gzip, deflate, br, zstd");        request.setHeader("Accept-Language", "ru,en;q=0.9");        request.setHeader("Origin", "https://www.goofish.com");        request.setHeader("Referer", "https://www.goofish.com/");        request.setHeader("Sec-Fetch-Dest", "empty");        request.setHeader("Sec-Fetch-Mode", "cors");        request.setHeader("Sec-Fetch-Site", "same-site");        request.setHeader("sec-ch-ua", "\"Chromium\";v=\"140\", \"Not=A?Brand\";v=\"24\", \"YaBrowser\";v=\"25.10\", \"Yowser\";v=\"2.5\", \"YaBrowserCorp\";v=\"140\"");        request.setHeader("sec-ch-ua-mobile", "?0");        request.setHeader("sec-ch-ua-platform", "\"macOS\"");        request.setHeader("x-accept-terminal", "pc");        // –î–æ–±–∞–≤–ª—è–µ–º –∫—É–∫–∏        String domain = "h5api.m.goofish.com";        String cookieHeader = CookieService.getCookieHeader(domain);        if (cookieHeader != null && !cookieHeader.isEmpty()) {            request.setHeader("Cookie", cookieHeader);            logger.debug("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫—É–∫–∏: {} —Å–∏–º–≤–æ–ª–æ–≤", cookieHeader.length());        } else {            logger.warn("‚ö†Ô∏è –ö—É–∫–∏ –ø—É—Å—Ç—ã–µ!");        }        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞        request.setEntity(new StringEntity(formData, StandardCharsets.UTF_8));        // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å        try (var response = HttpUtils.getHttpClientInstance().execute(request)) {            int statusCode = response.getStatusLine().getStatusCode();            String contentType = response.getFirstHeader("Content-Type") != null ?                    response.getFirstHeader("Content-Type").getValue() : "unknown";            String contentEncoding = response.getFirstHeader("Content-Encoding") != null ?                    response.getFirstHeader("Content-Encoding").getValue() : "unknown";            logger.info("üì• –û—Ç–≤–µ—Ç: —Å—Ç–∞—Ç—É—Å={}, content-type={}, content-encoding={}",                    statusCode, contentType, contentEncoding);            // –ü–æ–ª—É—á–∞–µ–º —Å—ã—Ä—ã–µ –±–∞–π—Ç—ã –æ—Ç–≤–µ—Ç–∞            byte[] responseBytes = EntityUtils.toByteArray(response.getEntity());            String responseBody;            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∂–∞—Ç–∏–µ            if ("zstd".equalsIgnoreCase(contentEncoding)) {                logger.info("üîÑ –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º zstd —Å–∂–∞—Ç–∏–µ...");                responseBody = decompressZstd(responseBytes);            } else if ("gzip".equalsIgnoreCase(contentEncoding) || "deflate".equalsIgnoreCase(contentEncoding)) {                // HttpClient –æ–±—ã—á–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç gzip/deflate                responseBody = new String(responseBytes, StandardCharsets.UTF_8);            } else {                // –ë–µ–∑ —Å–∂–∞—Ç–∏—è                responseBody = new String(responseBytes, StandardCharsets.UTF_8);            }            // –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏            org.apache.http.Header[] headers = response.getAllHeaders();            logger.debug("üìã –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:");            for (org.apache.http.Header header : headers) {                if (header.getName().equalsIgnoreCase("Set-Cookie") ||                        header.getName().equalsIgnoreCase("Content-Type") ||                        header.getName().equalsIgnoreCase("Content-Encoding") ||                        header.getName().equalsIgnoreCase("X-EagleEye-Id")) {                    logger.debug("   {}: {}", header.getName(), header.getValue());                }            }            logger.debug("üìÑ –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤): {}",                    responseBody.length() > 500 ? responseBody.substring(0, 500) + "..." : responseBody);            if (statusCode == 200) {                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ JSON –∏–ª–∏ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ                if (responseBody.trim().startsWith("{") || responseBody.trim().startsWith("[")) {                    logger.info("‚úÖ –ü–æ–ª—É—á–µ–Ω JSON –æ—Ç–≤–µ—Ç, –¥–ª–∏–Ω–∞: {} —Å–∏–º–≤–æ–ª–æ–≤", responseBody.length());                    return responseBody;                } else {                    logger.error("‚ùå –û—Ç–≤–µ—Ç –Ω–µ JSON. –ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤: {}",                            responseBody.length() > 200 ? responseBody.substring(0, 200) : responseBody);                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –ª–∏ –º—ã HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –æ—à–∏–±–∫–æ–π                    if (responseBody.contains("<html") || responseBody.contains("<!DOCTYPE")) {                        logger.error("‚ö†Ô∏è –ü–æ–ª—É—á–µ–Ω–∞ HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–º–µ—Å—Ç–æ JSON. –í–æ–∑–º–æ–∂–Ω–æ, –∫—É–∫–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã.");                    } else if (responseBody.contains("Ë¢´Êå§ÁàÜÂï¶") || responseBody.contains("FAIL_SYS_ILLEGAL_ACCESS")) {                        logger.error("‚ö†Ô∏è API –≤–µ—Ä–Ω—É–ª–æ –æ—à–∏–±–∫—É: {}",                                responseBody.length() > 100 ? responseBody.substring(0, 100) : responseBody);                    }                    throw new Exception("–û—Ç–≤–µ—Ç –Ω–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON: " + contentType);                }            } else {                logger.error("‚ùå HTTP –æ—à–∏–±–∫–∞ {}: {}", statusCode,                        responseBody.length() > 200 ? responseBody.substring(0, 200) + "..." : responseBody);                throw new Exception("HTTP error: " + statusCode);            }        } catch (Exception e) {            logger.error("‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞: {}", e.getMessage());            throw e;        }    }    /**     * –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ zstd —Å–∂–∞—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö     */    private String decompressZstd(byte[] compressedData) {        try {            logger.debug("üì¶ –†–∞–∑–º–µ—Ä —Å–∂–∞—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {} –±–∞–π—Ç", compressedData.length);            // –ò—Å–ø–æ–ª—å–∑—É–µ–º zstd-jni –¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏            byte[] decompressed = com.github.luben.zstd.Zstd.decompress(compressedData, 10 * 1024 * 1024); // –ú–∞–∫—Å 10MB            String result = new String(decompressed, StandardCharsets.UTF_8);            logger.debug("‚úÖ Zstd —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω");            logger.debug("üìÑ –†–∞–∑–º–µ—Ä —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {} —Å–∏–º–≤–æ–ª–æ–≤", result.length());            return result;        } catch (Exception e) {            logger.error("‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ zstd: {}", e.getMessage());            // –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω—É—é —Å—Ç—Ä–æ–∫—É            try {                String fallback = new String(compressedData, StandardCharsets.UTF_8);                logger.warn("‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback —á—Ç–µ–Ω–∏–µ –∫–∞–∫ UTF-8");                return fallback;            } catch (Exception e2) {                return "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–≤–µ—Ç–∞: " + e.getMessage();            }        }    }    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π    @Override    protected List<Product> parseResponse(String response, String query) {        List<Product> products = new ArrayList<>();        if (response == null || response.isEmpty()) {            logger.warn("Empty response");            return products;        }        try {            JSONObject json = new JSONObject(response);            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ—à–∏–±–æ–∫            if (json.has("ret")) {                String ret = json.optString("ret", "");                if (ret.contains("Ë¢´Êå§ÁàÜÂï¶") || ret.contains("RGV587_ERROR") ||                        ret.contains("FAIL_SYS_ILLEGAL_ACCESS")) {                    logger.error("API error: {}", ret);                    return products;                }            }            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ            JSONObject data = json.optJSONObject("data");            if (data == null) {                logger.warn("No data in response");                return products;            }            // –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤            JSONArray resultList = data.optJSONArray("resultList");            if (resultList == null || resultList.length() == 0) {                logger.debug("No items found in response");                return products;            }            logger.info("Found {} items", resultList.length());            for (int i = 0; i < resultList.length(); i++) {                try {                    JSONObject item = resultList.getJSONObject(i);                    Product product = parseProductItem(item, query);                    if (product != null && isValidProduct(product)) {                        products.add(product);                    }                } catch (Exception e) {                    logger.debug("Error parsing item {}: {}", i, e.getMessage());                }            }            logger.info("Successfully parsed {} products", products.size());        } catch (Exception e) {            logger.error("Error parsing response: {}", e.getMessage());            logger.debug("Response content (first 500 chars): {}",                    response.length() > 500 ? response.substring(0, 500) + "..." : response);        }        return products;    }    private Product parseProductItem(JSONObject item, String query) {        try {            JSONObject data = item.optJSONObject("data");            if (data == null) return null;            JSONObject itemObj = data.optJSONObject("item");            if (itemObj == null) return null;            JSONObject mainObj = itemObj.optJSONObject("main");            if (mainObj == null) return null;            JSONObject itemData = data.optJSONObject("itemData");            JSONObject exContent = mainObj.optJSONObject("exContent");            // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ ID —Ç–æ–≤–∞—Ä–∞            String itemId = null;            if (itemData != null) itemId = itemData.optString("itemId", "");            if ((itemId == null || itemId.isEmpty()) && exContent != null) {                itemId = exContent.optString("itemId", "");            }            if (itemId == null || itemId.isEmpty()) return null;            Product product = new Product();            product.setId(itemId);            product.setSite("goofish");            product.setQuery(query);            // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–ê–†–°–ò–ù–ì –ù–ê–ó–í–ê–ù–ò–Ø - —Ç–æ–ª—å–∫–æ –∏–∑ title –ø–æ–ª–µ–π            String title = "";            // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: data.itemData.title            if (itemData != null) {                title = itemData.optString("title", "");            }            // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: main.exContent.title (–µ—Å–ª–∏ –Ω–µ—Ç –≤ itemData)            if ((title == null || title.isEmpty()) && exContent != null) {                title = exContent.optString("title", "");            }            // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: main.clickParam.args.subject            if ((title == null || title.isEmpty()) && mainObj != null) {                JSONObject clickParam = mainObj.optJSONObject("clickParam");                if (clickParam != null) {                    JSONObject args = clickParam.optJSONObject("args");                    if (args != null) {                        title = args.optString("subject", "");                    }                }            }            // üî¥ –§–ò–õ–¨–¢–†: –£–±–∏—Ä–∞–µ–º —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è (–≤–µ—Ä–æ—è—Ç–Ω–æ –æ–ø–∏—Å–∞–Ω–∏—è)            if (title != null && title.length() > 150) {                title = title.substring(0, 147) + "...";            }            // –ï—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—É—Å—Ç–æ–µ, —Å–æ–∑–¥–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ            if (title == null || title.isEmpty() || "No title".equals(title) || "null".equals(title)) {                title = "–¢–æ–≤–∞—Ä #" + itemId + " (" + query + ")";            }            product.setTitle(title);            // –¶–µ–Ω–∞ –≤ —é–∞–Ω—è—Ö            double price = extractPrice(itemData, exContent);            product.setPrice(price);            // –í–æ–∑—Ä–∞—Å—Ç —Ç–æ–≤–∞—Ä–∞            long publishTime = extractPublishTime(mainObj, itemData, exContent);            int ageMinutes = calculateAge(publishTime);            Integer ageFromTags = extractAgeMinutesFromTags(exContent, mainObj);            if (ageFromTags != null) {                if (publishTime <= 0 || ageMinutes <= 0 || ageMinutes > 10080) {                    ageMinutes = ageFromTags;                } else {                    if (Math.abs(ageMinutes - ageFromTags) > 60) {                        ageMinutes = ageFromTags;                    }                }            }            product.setAgeMinutes(ageMinutes);            // –õ–æ–∫–∞—Ü–∏—è            String location = itemData != null ? itemData.optString("area", "") : "";            product.setLocation(location.isEmpty() ? "–ù–µ —É–∫–∞–∑–∞–Ω–æ" : location);            // URL            product.setUrl("https://www.goofish.com/item?id=" + itemId);            // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è            List<String> images = extractImages(mainObj, itemObj, data);            product.setImages(images);            logger.debug("Parsed: {} ({}¬•, {}min, {} images)",                    product.getShortTitle(), price, ageMinutes, images.size());            return product;        } catch (Exception e) {            logger.error("Error parsing product item: {}", e.getMessage());            return null;        }    }    private double extractPrice(JSONObject itemData, JSONObject exContent) {        if (itemData != null) {            Object priceObj = itemData.opt("price");            if (priceObj != null) return parsePrice(priceObj);        }        if (exContent != null) {            Object priceObj = exContent.opt("price");            if (priceObj != null) return parsePrice(priceObj);        }        return 0.0;    }    private double parsePrice(Object priceObj) {        if (priceObj instanceof String) {            return extractPrice((String) priceObj);        }        if (priceObj instanceof Number) {            return ((Number) priceObj).doubleValue();        }        if (priceObj instanceof JSONArray) {            JSONArray arr = (JSONArray) priceObj;            StringBuilder sb = new StringBuilder();            for (int i = 0; i < arr.length(); i++) {                JSONObject part = arr.optJSONObject(i);                if (part != null && "integer".equals(part.optString("type"))) {                    sb.append(part.optString("text"));                }            }            return extractPrice(sb.toString());        }        return 0.0;    }    public double extractPrice(String priceStr) {        if (priceStr == null || priceStr.isEmpty()) return 0.0;        try {            String clean = priceStr.replaceAll("[^\\d.,]", "").replace(',', '.');            return Double.parseDouble(clean);        } catch (NumberFormatException e) {            return 0.0;        }    }    private long extractPublishTime(JSONObject main, JSONObject itemData, JSONObject exContent) {        // –ü—É—Ç—å 1: args.publishTime        if (main != null) {            JSONObject clickParam = main.optJSONObject("clickParam");            if (clickParam != null) {                JSONObject args = clickParam.optJSONObject("args");                if (args != null && args.has("publishTime")) {                    Object time = args.opt("publishTime");                    if (time instanceof String) return Long.parseLong((String) time);                    if (time instanceof Number) return ((Number) time).longValue();                }            }        }        // –ü—É—Ç—å 2: itemData.publishTime        if (itemData != null && itemData.has("publishTime")) {            Object time = itemData.opt("publishTime");            if (time instanceof String) return Long.parseLong((String) time);            if (time instanceof Number) return ((Number) time).longValue();        }        return 0;    }    /**     * –ü—ã—Ç–∞–µ—Ç—Å—è –∏–∑–≤–ª–µ—á—å "–≤–æ–∑—Ä–∞—Å—Ç" –∏–∑ UI-–º–µ—Ç–æ–∫ –≤ –æ—Ç–≤–µ—Ç–µ (—á–∞—Å—Ç–æ —Ç–∞–º –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞ "6Â∞èÊó∂ÂâçÂèëÂ∏É").     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç –≤ –º–∏–Ω—É—Ç–∞—Ö –∏–ª–∏ null, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å.     */    private Integer extractAgeMinutesFromTags(JSONObject exContent, JSONObject mainObj) {        try {            // –ü—É—Ç—å 1: mainObj.clickParam.args.serviceUtParams (—Å—Ç—Ä–æ–∫–∞ JSON —Å content)            if (mainObj != null) {                JSONObject clickParam = mainObj.optJSONObject("clickParam");                if (clickParam != null) {                    JSONObject args = clickParam.optJSONObject("args");                    if (args != null) {                        String serviceUtParams = args.optString("serviceUtParams", "");                        Integer parsed = parseAgeMinutesFromText(serviceUtParams);                        if (parsed != null) return parsed;                    }                }            }            // –ü—É—Ç—å 2: exContent.fishTags.r2.tagList[*].data.content            if (exContent != null) {                JSONObject fishTags = exContent.optJSONObject("fishTags");                if (fishTags != null) {                    JSONObject r2 = fishTags.optJSONObject("r2");                    if (r2 != null) {                        JSONArray tagList = r2.optJSONArray("tagList");                        if (tagList != null) {                            for (int i = 0; i < Math.min(5, tagList.length()); i++) {                                JSONObject tag = tagList.optJSONObject(i);                                if (tag == null) continue;                                JSONObject data = tag.optJSONObject("data");                                if (data == null) continue;                                String content = data.optString("content", "");                                Integer parsed = parseAgeMinutesFromText(content);                                if (parsed != null) return parsed;                            }                        }                    }                }            }        } catch (Exception ignored) {        }        return null;    }    private Integer parseAgeMinutesFromText(String text) {        if (text == null || text.isEmpty()) return null;        Matcher m = PUBLISHED_AGO_ZH.matcher(text);        if (!m.find()) return null;        int value;        try {            value = Integer.parseInt(m.group(1));        } catch (NumberFormatException e) {            return null;        }        String unit = m.group(2);        if (unit.contains("ÂàÜÈíü")) return Math.max(1, value);        if (unit.contains("Êó∂")) return Math.max(1, value * 60);        if (unit.contains("Â§©")) return Math.max(1, value * 24 * 60);        return null;    }    private int calculateAge(long publishTime) {        if (publishTime <= 0) return 0;        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ (—Å–µ–∫—É–Ω–¥—ã –∏–ª–∏ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)        if (publishTime < 10000000000L) {            publishTime = publishTime * 1000;        }        long ageMs = System.currentTimeMillis() - publishTime;        int ageMinutes = (int) (ageMs / (1000 * 60));        return Math.max(1, Math.min(ageMinutes, 10080)); // 1 –¥–æ 7 –¥–Ω–µ–π    }    private List<String> extractImages(JSONObject main, JSONObject itemObj, JSONObject data) {        List<String> images = new ArrayList<>();        // –ü—É—Ç—å 1: data.picUrl (–≥–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ)        if (data != null && data.has("picUrl")) {            String picUrl = data.optString("picUrl", "");            if (isValidImageUrl(picUrl)) {                images.add(picUrl);                logger.debug("‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ñ–æ—Ç–æ –≤ data.picUrl");            }        }        // –ü—É—Ç—å 2: data.pics (–º–∞—Å—Å–∏–≤ —Ñ–æ—Ç–æ)        if (data != null && data.has("pics")) {            JSONArray pics = data.optJSONArray("pics");            if (pics != null) {                for (int i = 0; i < Math.min(5, pics.length()); i++) {                    try {                        JSONObject pic = pics.optJSONObject(i);                        if (pic != null) {                            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—è                            String url = pic.optString("picUrl", "");                            if (url.isEmpty()) {                                url = pic.optString("pic_url", "");                            }                            if (url.isEmpty()) {                                url = pic.optString("url", "");                            }                            if (isValidImageUrl(url) && !images.contains(url)) {                                images.add(url);                                logger.debug("‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ñ–æ—Ç–æ –≤ data.pics[{}]", i);                            }                        }                    } catch (Exception e) {                        logger.debug("Error parsing pic at index {}: {}", i, e.getMessage());                    }                }            }        }        // –ü—É—Ç—å 3: itemObj.extra.picUrl (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ)        if (itemObj != null) {            JSONObject extra = itemObj.optJSONObject("extra");            if (extra != null) {                String picUrl = extra.optString("picUrl", "");                if (picUrl.isEmpty()) {                    picUrl = extra.optString("pic_url", "");                }                if (isValidImageUrl(picUrl) && !images.contains(picUrl)) {                    images.add(picUrl);                    logger.debug("‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ñ–æ—Ç–æ –≤ itemObj.extra.picUrl");                }            }        }        // –ü—É—Ç—å 4: main.exContent.picUrl (–∏—Å—Ö–æ–¥–Ω–æ–µ —Ñ–æ—Ç–æ)        if (main != null) {            JSONObject exContent = main.optJSONObject("exContent");            if (exContent != null) {                String picUrl = exContent.optString("picUrl", "");                if (picUrl.isEmpty()) {                    picUrl = exContent.optString("pic_url", "");                }                if (isValidImageUrl(picUrl) && !images.contains(picUrl)) {                    images.add(picUrl);                    logger.debug("‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ñ–æ—Ç–æ –≤ main.exContent.picUrl");                }            }        }        // –ü—É—Ç—å 5: –ü—Ä—è–º—ã–µ –ø–æ–ª—è –æ–±—ä–µ–∫—Ç–∞ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ø—Ä–æ—â–µ–Ω–∞)        if (data != null) {            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä—è–º—ã–µ –ø–æ–ª—è –≤ data            String directPic = data.optString("image", "");            if (directPic.isEmpty()) {                directPic = data.optString("img", "");            }            if (isValidImageUrl(directPic) && !images.contains(directPic)) {                images.add(directPic);                logger.debug("‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ñ–æ—Ç–æ –≤ data.image");            }        }        if (images.isEmpty()) {            logger.debug("‚ö†Ô∏è –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è —Ç–æ–≤–∞—Ä–∞");        } else {            logger.debug("üì∑ –ù–∞–π–¥–µ–Ω–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π: {}", images.size());        }        return images;    }    private boolean isValidImageUrl(String url) {        if (url == null || url.isEmpty()) {            return false;        }        // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å HTTPS –∏–ª–∏ HTTP        if (!url.startsWith("http://") && !url.startsWith("https://")) {            return false;        }        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞        String lowerUrl = url.toLowerCase();        String[] validExtensions = {".jpg", ".jpeg", ".png", ".gif", ".webp", ".heic"};        boolean hasValidExtension = false;        for (String ext : validExtensions) {            if (lowerUrl.contains(ext)) {                hasValidExtension = true;                break;            }        }        // –ï—Å–ª–∏ –Ω–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è - –º–æ–∂–µ—Ç –±—ã—Ç—å OK (CDN —Å query parameters)        if (!hasValidExtension && (lowerUrl.contains("alicdn") || lowerUrl.contains("taobaocdn"))) {            return true;        }        return hasValidExtension;    }    private boolean isValidProduct(Product product) {        return product.getId() != null && !product.getId().isEmpty() &&                product.getTitle() != null && !product.getTitle().isEmpty() &&                product.getUrl() != null && !product.getUrl().isEmpty();    }    private String getTokenFromCookies() {        try {            String cookies = CookieService.getCookieHeader("h5api.m.goofish.com");            if (cookies == null || cookies.isEmpty()) return "";            String[] pairs = cookies.split("; ");            for (String pair : pairs) {                if (pair.startsWith("_m_h5_tk=")) {                    String mh5tk = pair.substring(9);                    if (mh5tk.contains("_")) {                        return mh5tk.split("_")[0];                    }                }            }        } catch (Exception e) {            logger.warn("Error getting token: {}", e.getMessage());        }        return "";    }    private String generateSignature(String token, long timestamp, String data) {        try {            String signString = token + "&" + timestamp + "&" + APP_KEY + "&" + data;            MessageDigest md = MessageDigest.getInstance("MD5");            byte[] hash = md.digest(signString.getBytes(StandardCharsets.UTF_8));            StringBuilder hex = new StringBuilder();            for (byte b : hash) {                String h = Integer.toHexString(0xff & b);                if (h.length() == 1) hex.append('0');                hex.append(h);            }            return hex.toString();        } catch (Exception e) {            logger.error("Error generating signature: {}", e.getMessage());            return "";        }    }    /**     * –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–æ–¥ search –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è POST –∑–∞–ø—Ä–æ—Å–æ–≤     */    @Override    public List<Product> search(String query, int maxPages, int rowsPerPage, int maxAgeMinutes) {        List<Product> allProducts = new ArrayList<>();        logger.info("Starting search: site={}, query='{}', pages={}, rows={}, maxAge={}min",                siteName, query, maxPages, rowsPerPage, maxAgeMinutes);        for (int page = 1; page <= maxPages; page++) {            if (Thread.currentThread().isInterrupted()) break;            try {                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è API                String url = buildSearchUrl(query, page, rowsPerPage);                if (url.isEmpty()) {                    logger.error("Failed to build URL for page {}", page);                    break;                }                // –í—ã–ø–æ–ª–Ω—è–µ–º POST –∑–∞–ø—Ä–æ—Å                String response = executeSearchRequest(url, query, page, rowsPerPage);                totalRequests++;                // –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç                List<Product> products = parseResponse(response, query);                if (products.isEmpty()) {                    logger.debug("No products on page {}", page);                    break;                }                // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É                List<Product> filtered = new ArrayList<>();                for (Product p : products) {                    if (p.getAgeMinutes() <= maxAgeMinutes) {                        filtered.add(p);                    }                }                allProducts.addAll(filtered);                logger.info("Page {}: found {} products ({} after age filter)",                        page, products.size(), filtered.size());                // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: –µ—Å–ª–∏ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä —Ä–µ–∂–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤ (INFO),                // —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ, –ø–æ—á–µ–º—É ‚Äú–Ω–∞ —Å–∞–π—Ç–µ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ, –∞ —É –Ω–∞—Å –∏—Ö –º–∞–ª–æ‚Äù.                if (products.size() > 0 && filtered.size() < products.size()) {                    int removed = products.size() - filtered.size();                    if (filtered.isEmpty() || removed >= Math.max(5, products.size() / 2)) {                        StringBuilder dbg = new StringBuilder();                        dbg.append("Age filter removed ").append(removed)                                .append(" of ").append(products.size())                                .append(" (maxAgeMinutes=").append(maxAgeMinutes).append("). Examples: ");                        int shown = 0;                        for (Product p : products) {                            if (p.getAgeMinutes() > maxAgeMinutes) {                                dbg.append(p.getId()).append("(age=").append(p.getAgeMinutes()).append("m)");                                shown++;                                if (shown >= 5) break;                                dbg.append(", ");                            }                        }                        logger.info(dbg.toString());                    }                }                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ API —Ä–µ–∞–ª—å–Ω–æ –≤–µ—Ä–Ω—É–ª–æ –º–µ–Ω—å—à–µ rowsPerPage.                // –ò–Ω–∞—á–µ –º–æ–∂–µ–º –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏–∑-–∑–∞ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ –∏ –Ω–µ –¥–æ–±—Ä–∞—Ç—å —Ç–æ–≤–∞—Ä—ã.                if (products.size() < rowsPerPage) break;                // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏                int delay = getRequestDelay();                if (delay > 0 && page < maxPages) {                    Thread.sleep(delay);                }            } catch (Exception e) {                failedRequests++;                logger.error("Error on page {}: {}", page, e.getMessage());                if (shouldStopOnError(e)) break;                try {                    Thread.sleep(3000);                } catch (InterruptedException ie) {                    Thread.currentThread().interrupt();                    break;                }            }        }        logger.info("Search completed: found {} products in {} requests",                allProducts.size(), totalRequests);        return allProducts;    }}
                ----------------------------------------

              [FILE] ParserFactory.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/parser/ParserFactory.java
                –†–∞–∑–º–µ—Ä: 2244 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T22:14:58.626726844Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.parser;
                
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.util.HashMap;
                import java.util.Map;
                
                /**
                 * –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Ä—Å–µ—Ä–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–∞–π—Ç–æ–≤
                 * –£–ø—Ä–æ—â–µ–Ω–∞ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–∞–π—Ç–æ–≤
                 */
                public class ParserFactory {
                    private static final Logger logger = LoggerFactory.getLogger(ParserFactory.class);
                    private static final Map<String, Class<? extends SiteParser>> parsers = new HashMap<>();
                    private static final Map<String, SiteParser> instances = new HashMap<>();
                
                    static {
                        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞—Ä—Å–µ—Ä—ã
                        registerParser("goofish", GoofishParser.class);
                        // –ó–¥–µ—Å—å –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–∞—Ä—Å–µ—Ä—ã:
                        // registerParser("taobao", TaobaoParser.class);
                        // registerParser("jd", JdParser.class);
                    }
                
                    public static void registerParser(String siteName, Class<? extends SiteParser> parserClass) {
                        String key = siteName.toLowerCase();
                        parsers.put(key, parserClass);
                        logger.info("Registered parser for: {}", siteName);
                    }
                
                    public static SiteParser createParser(String siteName) {
                        String key = siteName.toLowerCase();
                
                        if (!parsers.containsKey(key)) {
                            throw new IllegalArgumentException("Unsupported site: " + siteName);
                        }
                
                        if (!instances.containsKey(key)) {
                            try {
                                SiteParser parser = parsers.get(key).getDeclaredConstructor().newInstance();
                                instances.put(key, parser);
                                logger.debug("Created parser instance for: {}", siteName);
                            } catch (Exception e) {
                                throw new RuntimeException("Failed to create parser for: " + siteName, e);
                            }
                        }
                
                        return instances.get(key);
                    }
                
                    public static boolean hasParser(String siteName) {
                        return parsers.containsKey(siteName.toLowerCase());
                    }
                
                    public static String[] getSupportedSites() {
                        return parsers.keySet().toArray(new String[0]);
                    }
                
                    public static void clearCache() {
                        instances.clear();
                        logger.info("Parser cache cleared");
                    }
                }
                ----------------------------------------

              [FILE] BaseParser.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/parser/BaseParser.java
                –†–∞–∑–º–µ—Ä: 5947 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T23:44:07.572926724Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.parser;
                
                import com.parser.config.Config;
                import com.parser.model.Product;
                import com.parser.util.HttpUtils;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.util.ArrayList;
                import java.util.List;
                
                /**
                 * –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤
                 */
                public abstract class BaseParser implements SiteParser {
                    protected static final Logger logger = LoggerFactory.getLogger(BaseParser.class);
                
                    protected String siteName;
                    protected String baseUrl;
                    protected String userAgent;
                
                    protected int totalRequests = 0;
                    protected int failedRequests = 0;
                    protected long totalParseTime = 0;
                
                    public BaseParser(String siteName, String baseUrl) {
                        this.siteName = siteName;
                        this.baseUrl = baseUrl;
                        this.userAgent = HttpUtils.getDefaultUserAgent();
                    }
                
                    @Override
                    public String getSiteName() {
                        return siteName;
                    }
                
                    protected abstract List<Product> parseResponse(String response, String query);
                    protected abstract String buildSearchUrl(String query, int page, int rows);
                
                    @Override
                    public List<Product> search(String query, int maxPages, int rowsPerPage, int maxAgeMinutes) {
                        List<Product> allProducts = new ArrayList<>();
                
                        logger.info("Starting search: site={}, query='{}', pages={}, rows={}, maxAge={}min",
                                siteName, query, maxPages, rowsPerPage, maxAgeMinutes);
                
                        for (int page = 1; page <= maxPages; page++) {
                            if (Thread.currentThread().isInterrupted()) break;
                
                            try {
                                String url = buildSearchUrl(query, page, rowsPerPage);
                                long requestStart = System.currentTimeMillis();
                                String response = HttpUtils.sendGetRequest(url, userAgent);
                                totalRequests++;
                
                                long parseStart = System.currentTimeMillis();
                                List<Product> products = parseResponse(response, query);
                                totalParseTime += System.currentTimeMillis() - parseStart;
                
                                if (products.isEmpty()) {
                                    logger.debug("No products on page {}", page);
                                    break;
                                }
                
                                // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É
                                List<Product> filtered = new ArrayList<>();
                                for (Product p : products) {
                                    if (p.getAgeMinutes() <= maxAgeMinutes) {
                                        filtered.add(p);
                                    }
                                }
                
                                allProducts.addAll(filtered);
                                logger.info("Page {}: found {} products ({} after age filter)", page, products.size(), filtered.size());
                
                                if (filtered.size() < rowsPerPage) break;
                
                                int delay = getRequestDelay();
                                if (delay > 0 && page < maxPages) {
                                    Thread.sleep(delay);
                                }
                
                            } catch (Exception e) {
                                failedRequests++;
                                logger.error("Error on page {}: {}", page, e.getMessage());
                
                                if (shouldStopOnError(e)) break;
                
                                try {
                                    Thread.sleep(3000);
                                } catch (InterruptedException ie) {
                                    Thread.currentThread().interrupt();
                                    break;
                                }
                            }
                        }
                
                        logger.info("Search completed: found {} products in {} requests", allProducts.size(), totalRequests);
                        return allProducts;
                    }
                
                    @Override
                    public List<Product> search(String query) {
                        return search(query, 3, 100, 1440);
                    }
                
                    /**
                     * –ú–µ—Ç–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –¥–ª—è POST)
                     */
                    protected String executeSearchRequest(String url, String query, int page, int rows) throws Exception {
                        return HttpUtils.sendGetRequest(url, userAgent);
                    }
                
                    protected int getRequestDelay() {
                        return Config.getInt("api.goofish.delay.between.requests", 2000);
                    }
                
                    protected boolean shouldStopOnError(Exception e) {
                        String msg = e.getMessage();
                        return msg != null && (msg.contains("403") || msg.contains("429") || msg.contains("blocked") ||
                                msg.contains("Ë¢´Êå§ÁàÜÂï¶") || msg.contains("FAIL_SYS_ILLEGAL_ACCESS"));
                    }
                
                    protected String cleanString(String str) {
                        if (str == null) return "";
                        return str.trim().replaceAll("\\s+", " ").replaceAll("[\\p{C}]", "");
                    }
                
                    protected double extractPrice(String priceStr) {
                        if (priceStr == null || priceStr.isEmpty()) return 0.0;
                        try {
                            String clean = priceStr.replaceAll("[^\\d.,]", "").replace(',', '.');
                            return Double.parseDouble(clean);
                        } catch (NumberFormatException e) {
                            return 0.0;
                        }
                    }
                
                    public ParserStats getStats() {
                        return new ParserStats(siteName, totalRequests, failedRequests,
                                totalRequests > 0 ? (double) (totalRequests - failedRequests) / totalRequests * 100 : 0,
                                totalRequests > 0 ? totalParseTime / totalRequests : 0);
                    }
                
                    public static class ParserStats {
                        public String siteName;
                        public int totalRequests;
                        public int failedRequests;
                        public double successRate;
                        public long avgParseTime;
                
                        public ParserStats(String siteName, int totalRequests, int failedRequests, double successRate, long avgParseTime) {
                            this.siteName = siteName;
                            this.totalRequests = totalRequests;
                            this.failedRequests = failedRequests;
                            this.successRate = successRate;
                            this.avgParseTime = avgParseTime;
                        }
                
                        @Override
                        public String toString() {
                            return String.format("ParserStats{site=%s, req=%d, failed=%d, success=%.1f%%, avgTime=%dms}",
                                    siteName, totalRequests, failedRequests, successRate, avgParseTime);
                        }
                    }
                }
                ----------------------------------------

              [FILE] SiteParser.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/parser/SiteParser.java
                –†–∞–∑–º–µ—Ä: 1482 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T09:31:29.771270378Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.parser;
                
                import com.parser.model.Product;
                import java.util.List;
                
                /**
                 * –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤ —Å–∞–π—Ç–æ–≤
                 */
                public interface SiteParser {
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–∞–π—Ç–∞
                     */
                    String getSiteName();
                
                    /**
                     * –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É
                     *
                     * @param query –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
                     * @param maxPages –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
                     * @param rowsPerPage –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                     * @param maxAgeMinutes –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ –º–∏–Ω—É—Ç–∞—Ö
                     * @return —Å–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                     */
                    List<Product> search(String query, int maxPages, int rowsPerPage, int maxAgeMinutes);
                
                    /**
                     * –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                     */
                    default List<Product> search(String query) {
                        return search(query, 3, 100, 1440);
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞
                     */
                    default boolean isSiteAvailable() {
                        return true; // –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞—Ä—Å–µ—Ä–µ
                     */
                    default String getParserInfo() {
                        return "SiteParser for " + getSiteName();
                    }
                }
                ----------------------------------------
            [DIR] storage

              [FILE] WhitelistManager.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/storage/WhitelistManager.java
                –†–∞–∑–º–µ—Ä: 5796 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-28T18:53:30.285175611Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.storage;
                
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.util.*;
                import java.util.concurrent.ConcurrentHashMap;
                
                /**
                 * –ú–µ–Ω–µ–¥–∂–µ—Ä –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô
                 */
                public class WhitelistManager {
                    private static final Logger logger = LoggerFactory.getLogger(WhitelistManager.class);
                    /**
                     * –í–ê–ñ–ù–û:
                     * FileStorage —Å–∞–º –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å storage.data.dir (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ./data).
                     * –ü–æ—ç—Ç–æ–º—É –∑–¥–µ—Å—å –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "data/..." –∏–Ω–∞—á–µ –ø–æ–ª—É—á–∏—Ç—Å—è ./data/data/...
                     *
                     * –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –ø—É—Ç—å.
                     */
                    private static final String WHITELIST_FILE = "whitelist.txt";
                    private static final String LEGACY_WHITELIST_FILE = "data/whitelist.txt";
                    private static final Set<Long> whitelist = Collections.synchronizedSet(new HashSet<>());
                    private static volatile boolean isInitialized = false;
                
                    static {
                        synchronized (WhitelistManager.class) {
                            if (!isInitialized) {
                                loadWhitelist();
                                isInitialized = true;
                            }
                        }
                    }
                
                    /**
                     * –ó–∞–≥—Ä—É–∑–∫–∞ –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∏–∑ —Ñ–∞–π–ª–∞
                     */
                    private static void loadWhitelist() {
                        List<String> lines = FileStorage.readLines(WHITELIST_FILE);
                        boolean loadedFromLegacy = false;
                
                        // –ï—Å–ª–∏ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–µ—Ç/–ø—É—Å—Ç–æ–π, –Ω–æ –µ—Å—Ç—å legacy ‚Äî —á–∏—Ç–∞–µ–º legacy
                        if ((lines == null || lines.isEmpty()) && FileStorage.fileExists(LEGACY_WHITELIST_FILE)) {
                            lines = FileStorage.readLines(LEGACY_WHITELIST_FILE);
                            loadedFromLegacy = true;
                        }
                
                        logger.info("Loading whitelist from {}. Found {} lines",
                                loadedFromLegacy ? LEGACY_WHITELIST_FILE : WHITELIST_FILE,
                                lines != null ? lines.size() : 0);
                
                        for (String line : lines) {
                            try {
                                line = line.trim();
                                if (line.isEmpty() || line.startsWith("#")) {
                                    continue;
                                }
                
                                long userId = Long.parseLong(line);
                                if (userId > 0) {
                                    whitelist.add(userId);
                                } else {
                                    logger.warn("Invalid user ID in whitelist (must be > 0): {}", userId);
                                }
                            } catch (NumberFormatException e) {
                                logger.warn("Invalid user ID format in whitelist: '{}'. Error: {}", line, e.getMessage());
                            }
                        }
                
                        logger.info("‚úÖ Loaded {} users from whitelist", whitelist.size());
                
                        // –ú—è–≥–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è: –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∏–ª–∏ –∏–∑ legacy –∏ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –Ω–æ–≤—ã–π –ø—É—Ç—å
                        if (loadedFromLegacy && !FileStorage.fileExists(WHITELIST_FILE) && !whitelist.isEmpty()) {
                            logger.info("Migrating whitelist from legacy path to {}", WHITELIST_FILE);
                            saveWhitelist();
                        }
                    }
                
                    /**
                     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞ –≤ —Ñ–∞–π–ª
                     */
                    private static void saveWhitelist() {
                        List<String> lines = new ArrayList<>();
                        lines.add("# Whitelist - authorized users");
                        lines.add("# Format: one user ID per line");
                        lines.add("# Created: " + new Date());
                        lines.add("");
                
                        List<Long> sortedUsers = new ArrayList<>(whitelist);
                        Collections.sort(sortedUsers);
                
                        for (Long userId : sortedUsers) {
                            lines.add(String.valueOf(userId));
                        }
                
                        try {
                            FileStorage.writeLines(WHITELIST_FILE, lines);
                            logger.info("‚úÖ Whitelist saved: {} users", whitelist.size());
                        } catch (Exception e) {
                            logger.error("‚ùå Failed to save whitelist: {}", e.getMessage());
                        }
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static boolean isUserAllowed(long userId) {
                        boolean allowed = whitelist.contains(userId);
                        if (!allowed) {
                            logger.warn("Unauthorized access attempt from user {}", userId);
                        }
                        return allowed;
                    }
                
                    /**
                     * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static boolean addUser(long userId) {
                        if (userId <= 0) {
                            logger.warn("Invalid user ID: {}", userId);
                            return false;
                        }
                
                        if (whitelist.add(userId)) {
                            saveWhitelist();
                            logger.info("‚úÖ User {} added to whitelist", userId);
                            return true;
                        }
                
                        return false;
                    }
                
                    /**
                     * –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static boolean removeUser(long userId) {
                        if (whitelist.remove(userId)) {
                            saveWhitelist();
                            logger.info("‚úÖ User {} removed from whitelist", userId);
                            return true;
                        }
                        return false;
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                     */
                    public static List<Long> getAllUsers() {
                        return new ArrayList<>(whitelist);
                    }
                
                    /**
                     * –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                     */
                    public static long getUserCount() {
                        return whitelist.size();
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static boolean userExists(long userId) {
                        return whitelist.contains(userId);
                    }
                
                    /**
                     * –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
                     */
                    public static void reload() {
                        whitelist.clear();
                        loadWhitelist();
                        logger.info("Whitelist reloaded");
                    }
                }
                ----------------------------------------

              [FILE] ProductDuplicateFilter.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/storage/ProductDuplicateFilter.java
                –†–∞–∑–º–µ—Ä: 3798 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-28T18:56:14.357382489Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.storage;
                
                import com.parser.model.Product;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.util.*;
                import java.util.concurrent.ConcurrentHashMap;
                
                /**
                 * –§–∏–ª—å—Ç—Ä –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤
                 *
                 * NOTE:
                 * –í –∞–∫—Ç—É–∞–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `UserSentProductsManager`
                 * (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤).
                 * –≠—Ç–æ—Ç –∫–ª–∞—Å—Å –æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ
                 * –∫–∞–∫ in-memory –∫—ç—à ‚Äú—É–≤–∏–¥–µ–Ω–Ω—ã—Ö‚Äù —Ç–æ–≤–∞—Ä–æ–≤ (–±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏).
                 */
                public class ProductDuplicateFilter {
                    private static final Logger logger = LoggerFactory.getLogger(ProductDuplicateFilter.class);
                
                    // –ö—ç—à: userId -> Set<productId> (–Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                    private static final Map<Long, Set<String>> userFoundProducts = new ConcurrentHashMap<>();
                
                    /**
                     * –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    private static Set<String> loadUserProducts(long userId) {
                        List<Product> products = UserDataManager.getUserProducts(userId);
                        Set<String> ids = new HashSet<>();
                
                        for (Product p : products) {
                            ids.add(p.getId());
                        }
                
                        userFoundProducts.put(userId, ids);
                        logger.debug("Loaded {} products for user {}", ids.size(), userId);
                        return ids;
                    }
                
                    /**
                     * –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã (–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ)
                     */
                    public static List<Product> filterNew(long userId, List<Product> products) {
                        if (products == null || products.isEmpty()) {
                            return new ArrayList<>();
                        }
                
                        Set<String> found = userFoundProducts.computeIfAbsent(userId,
                                k -> loadUserProducts(userId));
                
                        List<Product> newProducts = new ArrayList<>();
                
                        for (Product p : products) {
                            if (!found.contains(p.getId())) {
                                newProducts.add(p);
                                found.add(p.getId()); // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ä–∞–∑—É, —á—Ç–æ–±—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–≤–∞–∂–¥—ã
                            }
                        }
                
                        logger.info("Filter: {} total, {} new for user {}",
                                products.size(), newProducts.size(), userId);
                
                        return newProducts;
                    }
                
                    /**
                     * –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –∫—ç—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static void addProductsToCache(long userId, List<Product> products) {
                        Set<String> found = userFoundProducts.computeIfAbsent(userId,
                                k -> loadUserProducts(userId));
                
                        for (Product p : products) {
                            found.add(p.getId());
                        }
                
                        logger.debug("Added {} products to cache for user {}", products.size(), userId);
                    }
                
                    /**
                     * –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤)
                     */
                    public static void clearUserCache(long userId) {
                        userFoundProducts.remove(userId);
                        logger.info("Cache cleared for user {}", userId);
                    }
                
                    /**
                     * –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à
                     */
                    public static void clearAllCache() {
                        userFoundProducts.clear();
                        logger.info("All cache cleared");
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –±—ã–ª –ª–∏ —Ç–æ–≤–∞—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                     */
                    public static boolean isProductSent(long userId, String productId) {
                        Set<String> found = userFoundProducts.computeIfAbsent(userId,
                                k -> loadUserProducts(userId));
                        return found.contains(productId);
                    }
                }
                ----------------------------------------

              [FILE] UserDataManager.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/storage/UserDataManager.java
                –†–∞–∑–º–µ—Ä: 12980 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T09:31:29.775386168Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.storage;
                
                import com.parser.model.Product;
                import com.parser.model.UserSettings;
                import com.fasterxml.jackson.databind.ObjectMapper;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.util.*;
                
                /**
                 * –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                 */
                public class UserDataManager {
                    private static final Logger logger = LoggerFactory.getLogger(UserDataManager.class);
                    private static final ObjectMapper objectMapper = new ObjectMapper();
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static List<String> getUserQueries(long userId) {
                        String filename = "user_" + userId + "_queries.txt";
                        return FileStorage.readLines(filename);
                    }
                
                    /**
                     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static void saveUserQueries(long userId, List<String> queries) {
                        String filename = "user_" + userId + "_queries.txt";
                        FileStorage.writeLines(filename, queries);
                        logger.debug("Saved {} queries for user {}", queries.size(), userId);
                    }
                
                    /**
                     * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                     */
                    public static boolean addUserQuery(long userId, String query) {
                        if (query == null || query.trim().isEmpty()) {
                            logger.warn("Attempted to add empty query for user {}", userId);
                            return false;
                        }
                
                        String trimmedQuery = query.trim();
                        List<String> queries = getUserQueries(userId);
                
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
                        for (String existingQuery : queries) {
                            if (existingQuery.equalsIgnoreCase(trimmedQuery)) {
                                logger.debug("Query already exists for user {}: {}", userId, trimmedQuery);
                                return false;
                            }
                        }
                
                        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
                        if (queries.size() >= 50) {
                            logger.warn("User {} reached query limit (50)", userId);
                            return false;
                        }
                
                        queries.add(trimmedQuery);
                        saveUserQueries(userId, queries);
                        logger.info("Query added for user {}: {}", userId, trimmedQuery);
                        return true;
                    }
                
                    /**
                     * –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                     */
                    public static boolean removeUserQuery(long userId, String query) {
                        List<String> queries = getUserQueries(userId);
                        boolean removed = queries.remove(query);
                
                        if (removed) {
                            saveUserQueries(userId, queries);
                            logger.info("Query removed for user {}: {}", userId, query);
                        } else {
                            logger.debug("Query not found for user {}: {}", userId, query);
                        }
                
                        return removed;
                    }
                
                    /**
                     * –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static void clearUserQueries(long userId) {
                        saveUserQueries(userId, new ArrayList<>());
                        logger.info("All queries cleared for user {}", userId);
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static UserSettings getUserSettings(long userId) {
                        String filename = "user_settings/" + userId + ".json";
                        String json = FileStorage.readJson(filename);
                
                        try {
                            if (json == null || json.isEmpty() || json.equals("{}")) {
                                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                                UserSettings defaultSettings = new UserSettings();
                                saveUserSettings(userId, defaultSettings);
                                return defaultSettings;
                            }
                
                            return objectMapper.readValue(json, UserSettings.class);
                
                        } catch (Exception e) {
                            logger.error("Error parsing settings for user {}: {}", userId, e.getMessage());
                            return new UserSettings(); // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–µ
                        }
                    }
                
                    /**
                     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static void saveUserSettings(long userId, UserSettings settings) {
                        String filename = "user_settings/" + userId + ".json";
                
                        try {
                            String json = objectMapper.writeValueAsString(settings);
                            FileStorage.writeJson(filename, json);
                            logger.debug("Settings saved for user {}", userId);
                
                        } catch (Exception e) {
                            logger.error("Error saving settings for user {}: {}", userId, e.getMessage());
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static List<Product> getUserProducts(long userId) {
                        String filename = "user_products/" + userId + ".json";
                        String json = FileStorage.readJson(filename);
                
                        if (json == null || json.isEmpty() || json.equals("{}")) {
                            return new ArrayList<>();
                        }
                
                        try {
                            Product[] products = objectMapper.readValue(json, Product[].class);
                            return new ArrayList<>(Arrays.asList(products));
                
                        } catch (Exception e) {
                            logger.error("Error parsing products for user {}: {}", userId, e.getMessage());
                            return new ArrayList<>();
                        }
                    }
                
                    /**
                     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static void saveUserProducts(long userId, List<Product> products) {
                        String filename = "user_products/" + userId + ".json";
                
                        try {
                            String json = objectMapper.writeValueAsString(products);
                            FileStorage.writeJson(filename, json);
                            logger.debug("Saved {} products for user {}", products.size(), userId);
                
                        } catch (Exception e) {
                            logger.error("Error saving products for user {}: {}", userId, e.getMessage());
                        }
                    }
                
                    /**
                     * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º
                     */
                    public static void addUserProducts(long userId, List<Product> newProducts) {
                        if (newProducts == null || newProducts.isEmpty()) {
                            return;
                        }
                
                        List<Product> existingProducts = getUserProducts(userId);
                        Set<String> existingIds = new HashSet<>();
                
                        // –°–æ–±–∏—Ä–∞–µ–º ID —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
                        for (Product product : existingProducts) {
                            existingIds.add(product.getId());
                        }
                
                        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
                        for (Product product : newProducts) {
                            if (!existingIds.contains(product.getId())) {
                                existingProducts.add(product);
                                existingIds.add(product.getId());
                            }
                        }
                
                        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—Ä–∞–Ω–∏–º—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                        if (existingProducts.size() > 1000) {
                            existingProducts = existingProducts.subList(
                                    existingProducts.size() - 1000, existingProducts.size());
                        }
                
                        saveUserProducts(userId, existingProducts);
                    }
                
                    /**
                     * –û—á–∏—Å—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static void clearUserProducts(long userId) {
                        String filename = "user_products/" + userId + ".json";
                        FileStorage.writeJson(filename, "[]");
                        logger.info("Products cleared for user {}", userId);
                    }
                
                    /**
                     * –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                     */
                    public static List<Product> filterNewProducts(long userId, List<Product> products) {
                        if (products == null || products.isEmpty()) {
                            return new ArrayList<>();
                        }
                
                        List<Product> existingProducts = getUserProducts(userId);
                        Set<String> existingIds = new HashSet<>();
                
                        for (Product product : existingProducts) {
                            existingIds.add(product.getId());
                        }
                
                        List<Product> newProducts = new ArrayList<>();
                        for (Product product : products) {
                            if (!existingIds.contains(product.getId())) {
                                newProducts.add(product);
                            }
                        }
                
                        return newProducts;
                    }
                
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static Map<String, Object> getUserStats(long userId) {
                        Map<String, Object> stats = new HashMap<>();
                
                        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
                        List<String> queries = getUserQueries(userId);
                        stats.put("queryCount", queries.size());
                
                        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
                        List<Product> products = getUserProducts(userId);
                        stats.put("productCount", products.size());
                
                        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                        UserSettings settings = getUserSettings(userId);
                        stats.put("settings", settings.getSummary());
                
                        // –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        String queriesFile = "user_" + userId + "_queries.txt";
                        String productsFile = "user_products/" + userId + ".json";
                        String settingsFile = "user_settings/" + userId + ".json";
                
                        stats.put("queriesLastModified", FileStorage.getLastModified(queriesFile));
                        stats.put("productsLastModified", FileStorage.getLastModified(productsFile));
                        stats.put("settingsLastModified", FileStorage.getLastModified(settingsFile));
                
                        return stats;
                    }
                
                    /**
                     * –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static boolean deleteUserData(long userId) {
                        try {
                            String queriesFile = "user_" + userId + "_queries.txt";
                            String productsFile = "user_products/" + userId + ".json";
                            String settingsFile = "user_settings/" + userId + ".json";
                
                            boolean deleted = true;
                            deleted &= FileStorage.deleteFile(queriesFile);
                            deleted &= FileStorage.deleteFile(productsFile);
                            deleted &= FileStorage.deleteFile(settingsFile);
                
                            if (deleted) {
                                logger.info("All data deleted for user {}", userId);
                            } else {
                                logger.warn("Some files could not be deleted for user {}", userId);
                            }
                
                            return deleted;
                
                        } catch (Exception e) {
                            logger.error("Error deleting data for user {}: {}", userId, e.getMessage());
                            return false;
                        }
                    }
                
                    /**
                     * –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                     */
                    public static boolean exportUserData(long userId, String exportFilename) {
                        try {
                            Map<String, Object> exportData = new HashMap<>();
                
                            exportData.put("userId", userId);
                            exportData.put("exportDate", new Date());
                
                            // –ó–∞–ø—Ä–æ—Å—ã
                            exportData.put("queries", getUserQueries(userId));
                
                            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                            UserSettings settings = getUserSettings(userId);
                            exportData.put("settings", objectMapper.convertValue(settings, Map.class));
                
                            // –¢–æ–≤–∞—Ä—ã (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100)
                            List<Product> products = getUserProducts(userId);
                            int startIndex = Math.max(0, products.size() - 100);
                            exportData.put("recentProducts", products.subList(startIndex, products.size()));
                
                            // –ó–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
                            String json = objectMapper.writeValueAsString(exportData);
                            FileStorage.writeJson(exportFilename, json);
                
                            logger.info("Data exported for user {} to {}", userId, exportFilename);
                            return true;
                
                        } catch (Exception e) {
                            logger.error("Error exporting data for user {}: {}", userId, e.getMessage());
                            return false;
                        }
                    }
                
                    /**
                     * –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                     */
                    public static List<Product> searchUserProducts(long userId, String searchTerm,
                                                                   double minPrice, double maxPrice) {
                        List<Product> allProducts = getUserProducts(userId);
                        List<Product> results = new ArrayList<>();
                
                        String searchLower = searchTerm.toLowerCase();
                
                        for (Product product : allProducts) {
                            boolean matches = true;
                
                            // –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
                            if (searchTerm != null && !searchTerm.isEmpty()) {
                                String title = product.getTitle().toLowerCase();
                                String query = product.getQuery().toLowerCase();
                                matches = title.contains(searchLower) || query.contains(searchLower);
                            }
                
                            // –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ
                            if (matches && minPrice > 0) {
                                matches = product.getPrice() >= minPrice;
                            }
                
                            if (matches && maxPrice > 0) {
                                matches = product.getPrice() <= maxPrice;
                            }
                
                            if (matches) {
                                results.add(product);
                            }
                        }
                
                        return results;
                    }
                }
                ----------------------------------------

              [FILE] AccessRequestManager.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/storage/AccessRequestManager.java
                –†–∞–∑–º–µ—Ä: 2703 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-28T18:58:26.507979648Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.storage;
                
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                
                import java.text.SimpleDateFormat;
                import java.util.*;
                
                /**
                 * –•—Ä–∞–Ω–∏—Ç –∑–∞—è–≤–∫–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ whitelist –ø—ã—Ç–∞–µ—Ç—Å—è –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º).
                 * –°–¥–µ–ª–∞–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ: –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª –≤ data-dir —á–µ—Ä–µ–∑ FileStorage.
                 */
                public class AccessRequestManager {
                    private static final Logger logger = LoggerFactory.getLogger(AccessRequestManager.class);
                
                    private static final String REQUESTS_FILE = "access_requests.txt";
                    private static final SimpleDateFormat TS = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                
                    /**
                     * –ó–∞–ø–∏—Å–∞—Ç—å –∑–∞—è–≤–∫—É (–µ—Å–ª–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—â—ë –Ω–µ—Ç –∑–∞–ø–∏—Å–∏).
                     */
                    public static void recordAccessRequest(long userId, String reason) {
                        if (userId <= 0) return;
                
                        try {
                            List<String> lines = FileStorage.readLines(REQUESTS_FILE);
                            for (String line : lines) {
                                if (line.startsWith(userId + "|")) {
                                    return; // —É–∂–µ –µ—Å—Ç—å –∑–∞—è–≤–∫–∞
                                }
                            }
                
                            String safeReason = reason == null ? "" : reason.replace("|", "/").trim();
                            String entry = userId + "|" + TS.format(new Date()) + "|" + safeReason;
                            lines.add(entry);
                            FileStorage.writeLines(REQUESTS_FILE, lines);
                            logger.info("Access request recorded for user {}", userId);
                        } catch (Exception e) {
                            logger.warn("Failed to record access request for {}: {}", userId, e.getMessage());
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ (—Å—ã—Ä—å—ë–º).
                     */
                    public static List<String> getRequests() {
                        return FileStorage.readLines(REQUESTS_FILE);
                    }
                
                    /**
                     * –£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
                     */
                    public static void removeRequest(long userId) {
                        try {
                            List<String> lines = FileStorage.readLines(REQUESTS_FILE);
                            List<String> updated = new ArrayList<>();
                            for (String line : lines) {
                                if (!line.startsWith(userId + "|")) {
                                    updated.add(line);
                                }
                            }
                            FileStorage.writeLines(REQUESTS_FILE, updated);
                        } catch (Exception e) {
                            logger.warn("Failed to remove access request for {}: {}", userId, e.getMessage());
                        }
                    }
                
                    /**
                     * –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏.
                     */
                    public static void clearAll() {
                        FileStorage.writeLines(REQUESTS_FILE, List.of());
                    }
                }
                ----------------------------------------

              [FILE] UserSentProductsManager.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/storage/UserSentProductsManager.java
                –†–∞–∑–º–µ—Ä: 2296 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-02-02T18:59:15.82722707Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.storage;
                
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.util.*;
                import java.util.concurrent.ConcurrentHashMap;
                
                public class UserSentProductsManager {
                    private static final Logger logger = LoggerFactory.getLogger(UserSentProductsManager.class);
                
                    private static final Map<Long, Set<String>> userSentProducts = new ConcurrentHashMap<>();
                    private static final String SENT_PRODUCTS_DIR = "data/sent_products";
                
                    static {
                        FileStorage.createDirectory(SENT_PRODUCTS_DIR);
                    }
                
                    public static Set<String> getSentProductsForUser(long userId) {
                        return userSentProducts.computeIfAbsent(userId, k -> loadUserSentProducts(userId));
                    }
                
                    public static void markProductsAsSent(long userId, Set<String> productIds) {
                        Set<String> sentProducts = getSentProductsForUser(userId);
                        sentProducts.addAll(productIds);
                        saveUserSentProducts(userId, sentProducts);
                        logger.info("–î–æ–±–∞–≤–ª–µ–Ω–æ {} —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∏—Å—Ç–æ—Ä–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {}",
                                productIds.size(), userId);
                    }
                
                    public static void clearUserHistory(long userId) {
                        userSentProducts.remove(userId);
                        FileStorage.deleteFile(SENT_PRODUCTS_DIR + "/user_" + userId + ".txt");
                        logger.info("–ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –æ—á–∏—â–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {}", userId);
                    }
                
                    private static Set<String> loadUserSentProducts(long userId) {
                        Set<String> products = new HashSet<>();
                        String filename = SENT_PRODUCTS_DIR + "/user_" + userId + ".txt";
                
                        for (String line : FileStorage.readLines(filename)) {
                            line = line.trim();
                            if (!line.isEmpty()) {
                                products.add(line);
                            }
                        }
                
                        logger.debug("–ó–∞–≥—Ä—É–∂–µ–Ω–æ {} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {}",
                                products.size(), userId);
                        return products;
                    }
                
                    private static void saveUserSentProducts(long userId, Set<String> products) {
                        String filename = SENT_PRODUCTS_DIR + "/user_" + userId + ".txt";
                        List<String> lines = new ArrayList<>(products);
                        FileStorage.writeLines(filename, lines);
                    }
                }
                ----------------------------------------

              [FILE] FileStorage.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/storage/FileStorage.java
                –†–∞–∑–º–µ—Ä: 18437 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-28T19:06:12.423355901Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.storage;
                
                import com.parser.config.Config;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.io.*;
                import java.nio.charset.StandardCharsets;
                import java.nio.file.*;
                import java.util.*;
                import java.util.concurrent.locks.ReentrantLock;
                import java.util.zip.GZIPOutputStream;
                
                /**
                 * –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
                 */
                public class FileStorage {
                    private static final Logger logger = LoggerFactory.getLogger(FileStorage.class);
                
                    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
                    private static final Map<String, ReentrantLock> fileLocks = new HashMap<>();
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Ñ–∞–π–ª–∞
                     */
                    private static synchronized ReentrantLock getFileLock(String filename) {
                        return fileLocks.computeIfAbsent(filename, k -> new ReentrantLock());
                    }
                
                    /**
                     * –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                     */
                    public static void ensureDataDir() {
                        String dataDir = Config.getString("storage.data.dir", "./data");
                        File dir = new File(dataDir);
                
                        if (!dir.exists()) {
                            logger.info("–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö: {}", dataDir);
                            if (dir.mkdirs()) {
                                logger.info("‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞: {}", dataDir);
                
                                // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
                                createSubdirectory(dataDir, "user_settings");
                                createSubdirectory(dataDir, "user_products");
                                createSubdirectory(dataDir, "sent_products");
                                createSubdirectory(dataDir, "backups");
                                createSubdirectory(dataDir, "logs");
                
                            } else {
                                logger.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–∞–Ω–Ω—ã—Ö: {}", dataDir);
                                throw new RuntimeException("Failed to create data directory: " + dataDir);
                            }
                        } else {
                            logger.debug("–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {}", dataDir);
                            // –ù–∞ —Å–ª—É—á–∞–π –∞–ø–≥—Ä–µ–π–¥–∞/—Å—Ç–∞—Ä—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫
                            createSubdirectory(dataDir, "user_settings");
                            createSubdirectory(dataDir, "user_products");
                            createSubdirectory(dataDir, "sent_products");
                            createSubdirectory(dataDir, "backups");
                            createSubdirectory(dataDir, "logs");
                        }
                    }
                
                    /**
                     * –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                     */
                    private static void createSubdirectory(String parentDir, String subdirName) {
                        File subdir = new File(parentDir + "/" + subdirName);
                        if (!subdir.exists()) {
                            if (subdir.mkdirs()) {
                                logger.debug("‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {}", subdir.getAbsolutePath());
                            } else {
                                logger.warn("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: {}", subdir.getAbsolutePath());
                            }
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É
                     */
                    public static String getFilePath(String filename) {
                        String dataDir = Config.getString("storage.data.dir", "./data");
                        return dataDir + "/" + filename;
                    }
                
                    /**
                     * –ß—Ç–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –∏–∑ —Ñ–∞–π–ª–∞
                     */
                    public static List<String> readLines(String filename) {
                        ReentrantLock lock = getFileLock(filename);
                        lock.lock();
                
                        try {
                            File file = new File(getFilePath(filename));
                            if (!file.exists()) {
                                logger.debug("–§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {}", filename);
                                return new ArrayList<>();
                            }
                
                            List<String> lines = new ArrayList<>();
                            try (BufferedReader reader = new BufferedReader(
                                    new InputStreamReader(new FileInputStream(file), StandardCharsets.UTF_8))) {
                
                                String line;
                                int lineNumber = 0;
                                while ((line = reader.readLine()) != null) {
                                    lineNumber++;
                                    line = line.trim();
                                    if (!line.isEmpty()) {
                                        lines.add(line);
                                    }
                                }
                
                                logger.debug("–ü—Ä–æ—á–∏—Ç–∞–Ω–æ {} —Å—Ç—Ä–æ–∫ –∏–∑ {}", lines.size(), filename);
                                return lines;
                
                            } catch (IOException e) {
                                logger.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ {}: {}", filename, e.getMessage());
                                return new ArrayList<>();
                            }
                
                        } finally {
                            lock.unlock();
                        }
                    }
                
                    /**
                     * –ó–∞–ø–∏—Å—å —Å—Ç—Ä–æ–∫ –≤ —Ñ–∞–π–ª
                     */
                    public static void writeLines(String filename, List<String> lines) {
                        ReentrantLock lock = getFileLock(filename);
                        lock.lock();
                
                        try {
                            ensureDataDir();
                            File file = new File(getFilePath(filename));
                
                            // –í –ø—Ä–æ–¥–µ —ç—Ç–∏ –ª–æ–≥–∏ —Å–ª–∏—à–∫–æ–º —à—É–º–Ω—ã–µ ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤ DEBUG.
                            if (logger.isDebugEnabled()) {
                                logger.debug("üìù –ó–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª: {} (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å: {})",
                                        filename, file.getAbsolutePath());
                                logger.debug("   –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é: {}", file.exists());
                                logger.debug("   –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {}", file.getParent());
                                logger.debug("   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –¥–ª—è –∑–∞–ø–∏—Å–∏: {}", lines.size());
                            }
                
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
                            File parentDir = file.getParentFile();
                            if (parentDir != null && !parentDir.exists()) {
                                logger.debug("   –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: {}", parentDir.getAbsolutePath());
                                if (!parentDir.mkdirs()) {
                                    logger.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é");
                                    throw new RuntimeException("Cannot create parent directory: " + parentDir.getAbsolutePath());
                                }
                            }
                
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
                            if (file.exists() && !file.canWrite()) {
                                logger.error("‚ùå –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª: {}", file.getAbsolutePath());
                                throw new RuntimeException("No write permission for file: " + file.getAbsolutePath());
                            }
                
                            // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏, –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                            if (file.exists()) {
                                logger.debug("   –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏...");
                                createBackup(filename);
                            }
                
                            try (BufferedWriter writer = new BufferedWriter(
                                    new OutputStreamWriter(new FileOutputStream(file), StandardCharsets.UTF_8))) {
                
                                for (String line : lines) {
                                    writer.write(line);
                                    writer.newLine();
                                }
                
                                writer.flush();
                
                                if (logger.isDebugEnabled()) {
                                    logger.debug("‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–æ {} —Å—Ç—Ä–æ–∫ –≤ {}", lines.size(), filename);
                                    logger.debug("   –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏: {}", file.exists());
                                    logger.debug("   –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏: {} –±–∞–π—Ç", file.length());
                                }
                
                            } catch (IOException e) {
                                logger.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞ {}: {}", filename, e.getMessage(), e);
                                throw new RuntimeException("Failed to write file: " + filename, e);
                            }
                
                        } catch (Exception e) {
                            logger.error("‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ writeLines –¥–ª—è {}: {}", filename, e.getMessage(), e);
                            // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–∞–ª—å—à–µ
                            if (e instanceof RuntimeException) {
                                throw (RuntimeException) e;
                            } else {
                                throw new RuntimeException("Error in writeLines for " + filename, e);
                            }
                        } finally {
                            lock.unlock();
                        }
                    }
                
                    /**
                     * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞
                     */
                    public static void appendLine(String filename, String line) {
                        ReentrantLock lock = getFileLock(filename);
                        lock.lock();
                
                        try {
                            ensureDataDir();
                            File file = new File(getFilePath(filename));
                
                            try (BufferedWriter writer = new BufferedWriter(
                                    new OutputStreamWriter(new FileOutputStream(file, true), StandardCharsets.UTF_8))) {
                
                                writer.write(line);
                                writer.newLine();
                
                                logger.debug("Appended line to {}", filename);
                
                            } catch (IOException e) {
                                logger.error("Error appending to file {}: {}", filename, e.getMessage());
                                throw new RuntimeException("Failed to append to file: " + filename, e);
                            }
                
                        } finally {
                            lock.unlock();
                        }
                    }
                
                    /**
                     * –ß—Ç–µ–Ω–∏–µ JSON –æ–±—ä–µ–∫—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞
                     */
                    public static String readJson(String filename) {
                        ReentrantLock lock = getFileLock(filename);
                        lock.lock();
                
                        try {
                            File file = new File(getFilePath(filename));
                            if (!file.exists()) {
                                return "{}";
                            }
                
                            StringBuilder content = new StringBuilder();
                            try (BufferedReader reader = new BufferedReader(
                                    new InputStreamReader(new FileInputStream(file), StandardCharsets.UTF_8))) {
                
                                String line;
                                while ((line = reader.readLine()) != null) {
                                    content.append(line);
                                }
                
                                return content.toString();
                
                            } catch (IOException e) {
                                logger.error("Error reading JSON file {}: {}", filename, e.getMessage());
                                return "{}";
                            }
                
                        } finally {
                            lock.unlock();
                        }
                    }
                
                    /**
                     * –ó–∞–ø–∏—Å—å JSON –æ–±—ä–µ–∫—Ç–∞ –≤ —Ñ–∞–π–ª
                     */
                    public static void writeJson(String filename, String json) {
                        writeLines(filename, List.of(json));
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
                     */
                    public static boolean fileExists(String filename) {
                        File file = new File(getFilePath(filename));
                        return file.exists();
                    }
                
                    /**
                     * –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
                     */
                    public static boolean deleteFile(String filename) {
                        ReentrantLock lock = getFileLock(filename);
                        lock.lock();
                
                        try {
                            File file = new File(getFilePath(filename));
                            boolean deleted = file.delete();
                
                            if (deleted) {
                                logger.debug("Deleted file: {}", filename);
                            } else {
                                logger.warn("Failed to delete file: {}", filename);
                            }
                
                            return deleted;
                
                        } finally {
                            lock.unlock();
                        }
                    }
                
                    /**
                     * –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
                     */
                    public static boolean copyFile(String sourceFilename, String destFilename) {
                        ReentrantLock sourceLock = getFileLock(sourceFilename);
                        ReentrantLock destLock = getFileLock(destFilename);
                
                        sourceLock.lock();
                        destLock.lock();
                
                        try {
                            Path source = Paths.get(getFilePath(sourceFilename));
                            Path destination = Paths.get(getFilePath(destFilename));
                
                            Files.copy(source, destination, StandardCopyOption.REPLACE_EXISTING);
                            logger.debug("Copied {} to {}", sourceFilename, destFilename);
                            return true;
                
                        } catch (IOException e) {
                            logger.error("Error copying file {} to {}: {}",
                                    sourceFilename, destFilename, e.getMessage());
                            return false;
                        } finally {
                            destLock.unlock();
                            sourceLock.unlock();
                        }
                    }
                
                    /**
                     * –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —Ñ–∞–π–ª–∞
                     */
                    public static void createBackup(String filename) {
                        if (!Config.getBoolean("storage.backup.enabled", true)) {
                            return;
                        }
                
                        try {
                            String backupDir = "backups";
                            String timestamp = new java.text.SimpleDateFormat("yyyyMMdd_HHmmss")
                                    .format(new java.util.Date());
                
                            String backupFilename = String.format("%s/%s_%s.backup",
                                    backupDir, filename.replace("/", "_"), timestamp);
                
                            copyFile(filename, backupFilename);
                
                            // –°–∂–∞—Ç–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
                            compressFile(backupFilename);
                
                            // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
                            cleanupOldBackups(filename);
                
                        } catch (Exception e) {
                            logger.error("Error creating backup for {}: {}", filename, e.getMessage());
                        }
                    }
                
                    /**
                     * –°–∂–∞—Ç–∏–µ —Ñ–∞–π–ª–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GZIP
                     */
                    private static void compressFile(String filename) {
                        try {
                            File inputFile = new File(getFilePath(filename));
                            File outputFile = new File(getFilePath(filename + ".gz"));
                
                            try (FileInputStream fis = new FileInputStream(inputFile);
                                 FileOutputStream fos = new FileOutputStream(outputFile);
                                 GZIPOutputStream gzipOS = new GZIPOutputStream(fos)) {
                
                                byte[] buffer = new byte[1024];
                                int len;
                                while ((len = fis.read(buffer)) != -1) {
                                    gzipOS.write(buffer, 0, len);
                                }
                            }
                
                            // –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ—Å–∂–∞—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
                            inputFile.delete();
                            logger.debug("Compressed backup file: {}", outputFile.getName());
                
                        } catch (IOException e) {
                            logger.error("Error compressing file {}: {}", filename, e.getMessage());
                        }
                    }
                
                    /**
                     * –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
                     */
                    private static void cleanupOldBackups(String originalFilename) {
                        try {
                            String backupDir = getFilePath("backups");
                            File dir = new File(backupDir);
                
                            if (!dir.exists()) {
                                return;
                            }
                
                            String baseName = originalFilename.replace("/", "_");
                            File[] backupFiles = dir.listFiles((d, name) ->
                                    name.startsWith(baseName + "_") && name.endsWith(".backup.gz"));
                
                            if (backupFiles == null || backupFiles.length <= 10) {
                                return; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∫–æ–ø–∏–π
                            }
                
                            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ –ø–µ—Ä–≤—ã–º–∏)
                            Arrays.sort(backupFiles, Comparator.comparingLong(File::lastModified));
                
                            // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∫–æ–ø–∏–π
                            for (int i = 0; i < backupFiles.length - 10; i++) {
                                backupFiles[i].delete();
                                logger.debug("Deleted old backup: {}", backupFiles[i].getName());
                            }
                
                        } catch (Exception e) {
                            logger.error("Error cleaning up old backups: {}", e.getMessage());
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                     */
                    public static List<String> listFiles(String directory) {
                        String dirPath = getFilePath(directory);
                        File dir = new File(dirPath);
                
                        if (!dir.exists() || !dir.isDirectory()) {
                            return new ArrayList<>();
                        }
                
                        File[] files = dir.listFiles();
                        if (files == null) {
                            return new ArrayList<>();
                        }
                
                        List<String> fileList = new ArrayList<>();
                        for (File file : files) {
                            if (file.isFile()) {
                                fileList.add(file.getName());
                            }
                        }
                
                        return fileList;
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö
                     */
                    public static long getFileSize(String filename) {
                        File file = new File(getFilePath(filename));
                        return file.exists() ? file.length() : 0;
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞
                     */
                    public static long getLastModified(String filename) {
                        File file = new File(getFilePath(filename));
                        return file.exists() ? file.lastModified() : 0;
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–∞–π–ª –ø—É—Å—Ç—ã–º
                     */
                    public static boolean isEmpty(String filename) {
                        File file = new File(getFilePath(filename));
                        return !file.exists() || file.length() == 0;
                    }
                
                    /**
                     * –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                     */
                    public static boolean createDirectory(String directory) {
                        String dirPath = getFilePath(directory);
                        File dir = new File(dirPath);
                        return dir.mkdirs();
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                     */
                    public static Map<String, Object> getStorageStats() {
                        Map<String, Object> stats = new HashMap<>();
                
                        String dataDir = Config.getString("storage.data.dir", "./data");
                        File dir = new File(dataDir);
                
                        if (!dir.exists()) {
                            stats.put("status", "directory_not_exists");
                            return stats;
                        }
                
                        stats.put("directory", dataDir);
                        stats.put("exists", true);
                        stats.put("totalSpace", dir.getTotalSpace());
                        stats.put("freeSpace", dir.getFreeSpace());
                        stats.put("usableSpace", dir.getUsableSpace());
                
                        // –ü–æ–¥—Å—á–µ—Ç —Ñ–∞–π–ª–æ–≤
                        File[] files = dir.listFiles();
                        if (files != null) {
                            stats.put("totalFiles", files.length);
                
                            long totalSize = 0;
                            for (File file : files) {
                                totalSize += file.length();
                            }
                            stats.put("totalSizeBytes", totalSize);
                            stats.put("totalSizeMB", totalSize / (1024 * 1024));
                        }
                
                        return stats;
                    }
                }
                ----------------------------------------
            [DIR] telegram

              [FILE] TelegramNotificationService.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/telegram/TelegramNotificationService.java
                –†–∞–∑–º–µ—Ä: 9465 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-20T09:55:35.22051932Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.telegram;
                
                import com.parser.config.Config;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import org.telegram.telegrambots.meta.api.methods.send.SendMessage;
                import org.telegram.telegrambots.meta.api.methods.send.SendPhoto;
                import org.telegram.telegrambots.meta.api.objects.InputFile;
                import org.telegram.telegrambots.meta.exceptions.TelegramApiException;
                
                import java.net.URL;
                import java.util.Date;
                
                /**
                 * –°–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ Telegram
                 */
                public class TelegramNotificationService {
                    private static final Logger logger = LoggerFactory.getLogger(TelegramNotificationService.class);
                
                    private static TelegramBotService botInstance;
                
                    /**
                     * –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –±–æ—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                     */
                    public static void setBotInstance(TelegramBotService bot) {
                        botInstance = bot;
                        logger.info("TelegramNotificationService initialized with bot instance");
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                     */
                    public static boolean sendMessage(long userId, String text) {
                        return sendMessage(userId, text, false);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
                     */
                    public static boolean sendHtmlMessage(long userId, String htmlText) {
                        return sendMessage(userId, htmlText, true);
                    }
                
                    /**
                     * –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
                     */
                    private static boolean sendMessage(long userId, String text, boolean useHtml) {
                        if (botInstance == null) {
                            logger.error("Bot instance not set for TelegramNotificationService");
                            return false;
                        }
                
                        if (text == null || text.trim().isEmpty()) {
                            logger.warn("Attempted to send empty message to user {}", userId);
                            return false;
                        }
                
                        try {
                            SendMessage message = new SendMessage();
                            message.setChatId(String.valueOf(userId));
                
                            if (useHtml) {
                                message.setText(text);
                                message.setParseMode("HTML");
                                message.disableWebPagePreview();
                            } else {
                                message.setText(text);
                            }
                
                            botInstance.execute(message);
                            logger.debug("Message sent to user {}", userId);
                            return true;
                
                        } catch (TelegramApiException e) {
                            logger.error("Error sending message to user {}: {}", userId, e.getMessage());
                
                            if (useHtml) {
                                logger.info("Retrying without HTML formatting...");
                                String plainText = stripHtml(text);
                                return sendMessage(userId, plainText, false);
                            }
                            return false;
                        }
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é (HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
                     */
                    public static boolean sendPhotoWithHtmlCaption(long userId, String photoUrl, String htmlCaption) {
                        if (botInstance == null) {
                            logger.error("Bot instance not set for TelegramNotificationService");
                            return false;
                        }
                
                        if (photoUrl == null || photoUrl.isEmpty()) {
                            logger.warn("Empty photo URL for user {}", userId);
                            return false;
                        }
                
                        try {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ URL –≤–∞–ª–∏–¥–Ω—ã–º
                            if (!isValidUrl(photoUrl)) {
                                logger.warn("Invalid photo URL: {}", photoUrl);
                                return sendHtmlMessage(userId, htmlCaption);
                            }
                
                            SendPhoto photo = new SendPhoto();
                            photo.setChatId(String.valueOf(userId));
                
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º URL –Ω–∞–ø—Ä—è–º—É—é
                            photo.setPhoto(new InputFile(photoUrl));
                
                            if (htmlCaption != null && !htmlCaption.isEmpty()) {
                                // –û–±—Ä–µ–∑–∞–µ–º –ø–æ–¥–ø–∏—Å—å –µ—Å–ª–∏ –æ–Ω–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–∞—è (–º–∞–∫—Å 1024 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è Telegram)
                                if (htmlCaption.length() > 1024) {
                                    htmlCaption = htmlCaption.substring(0, 1020) + "...";
                                }
                                photo.setCaption(htmlCaption);
                                photo.setParseMode("HTML");
                            }
                
                            botInstance.execute(photo);
                            logger.debug("Photo with caption sent to user {}", userId);
                            return true;
                
                        } catch (TelegramApiException e) {
                            logger.error("Error sending photo to user {}: {}", userId, e.getMessage());
                
                            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                            if (htmlCaption != null && !htmlCaption.isEmpty()) {
                                String textMessage = "üì∏ " + stripHtml(htmlCaption);
                                return sendMessage(userId, textMessage);
                            }
                            return false;
                        } catch (Exception e) {
                            logger.error("Unexpected error sending photo to user {}: {}", userId, e.getMessage());
                            return sendHtmlMessage(userId, htmlCaption);
                        }
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ URL
                     */
                    private static boolean isValidUrl(String url) {
                        try {
                            new URL(url).toURI();
                            return true;
                        } catch (Exception e) {
                            return false;
                        }
                    }
                
                    /**
                     * –£–¥–∞–ª–µ–Ω–∏–µ HTML —Ç–µ–≥–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞
                     */
                    private static String stripHtml(String html) {
                        if (html == null) return "";
                        return html.replaceAll("<[^>]*>", "")
                                .replace("&amp;", "&")
                                .replace("&lt;", "<")
                                .replace("&gt;", ">")
                                .replace("&quot;", "\"")
                                .replace("&#39;", "'");
                    }
                
                    /**
                     * –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è HTML
                     */
                    public static String escapeHtml(String text) {
                        if (text == null) return "";
                
                        return text.replace("&", "&amp;")
                                .replace("<", "&lt;")
                                .replace(">", "&gt;")
                                .replace("\"", "&quot;")
                                .replace("'", "&#39;");
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                     */
                    public static boolean sendTestNotification(long userId) {
                        logger.info("Sending test notification to user {}", userId);
                
                        String message = "<b>‚úÖ Test notification</b>\n\n" +
                                "Parser is working correctly!\n" +
                                "This is a test message to confirm that the notification system is functioning.\n\n" +
                                "<i>Time: " + new Date() + "</i>";
                
                        return sendHtmlMessage(userId, message);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö
                     */
                    public static boolean sendProductsNotification(long userId, int count, String query) {
                        String message = String.format("<b>üõçÔ∏è Found products!</b>\n\n" +
                                "Query: %s\n" +
                                "Products found: %d\n\n" +
                                "<i>Sending details...</i>", escapeHtml(query), count);
                
                        return sendHtmlMessage(userId, message);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
                     */
                    public static boolean sendErrorNotification(long userId, String errorMessage) {
                        String message = String.format("<b>‚ùå Parser error</b>\n\n" +
                                        "An error occurred:\n" +
                                        "<code>%s</code>\n\n" +
                                        "<i>The parser will be restarted automatically.</i>",
                                escapeHtml(errorMessage));
                
                        return sendHtmlMessage(userId, message);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–∞—Ä—Å–µ—Ä–∞
                     */
                    public static boolean sendStatusNotification(long userId, String status, String details) {
                        String emoji = "üü¢";
                        if (status.contains("stopped")) emoji = "üî¥";
                        if (status.contains("paused")) emoji = "‚è∏Ô∏è";
                        if (status.contains("error")) emoji = "‚ùå";
                
                        String message = String.format("%s <b>Parser status changed</b>\n\n" +
                                "New status: %s\n\n" +
                                "%s", emoji, status, escapeHtml(details));
                
                        return sendHtmlMessage(userId, message);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
                     */
                    public static boolean sendAdminNotification(String message) {
                        long adminId = Config.getTelegramAdminId();
                        if (adminId == 0) {
                            logger.warn("Admin ID not configured");
                            return false;
                        }
                
                        String adminMessage = String.format("<b>üëë Admin notification</b>\n\n" +
                                        "%s\n\n" +
                                        "<i>Time: %s</i>",
                                escapeHtml(message),
                                new Date());
                
                        return sendHtmlMessage(adminId, adminMessage);
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞
                     */
                    public static boolean isBotAvailable() {
                        return botInstance != null;
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é (—É–¥–æ–±–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–ª–∞—Å—Å–æ–≤)
                     */
                    public static boolean sendPhotoWithCaption(long userId, String photoUrl, String caption) {
                        return sendPhotoWithHtmlCaption(userId, photoUrl, caption);
                    }
                }
                ----------------------------------------

              [FILE] TelegramBotService.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/telegram/TelegramBotService.java
                –†–∞–∑–º–µ—Ä: 25999 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-28T19:07:03.454460295Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.telegram;
                
                import com.parser.config.Config;
                import com.parser.core.ThreadManager;
                import com.parser.model.UserSettings;
                import com.parser.service.CookieService;
                import com.parser.storage.AccessRequestManager;
                import com.parser.storage.UserSentProductsManager;
                import com.parser.storage.WhitelistManager;
                import com.parser.storage.UserDataManager;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import org.telegram.telegrambots.bots.TelegramLongPollingBot;
                import org.telegram.telegrambots.meta.api.methods.commands.SetMyCommands;
                import org.telegram.telegrambots.meta.api.methods.send.SendMessage;
                import org.telegram.telegrambots.meta.api.objects.commands.BotCommand;
                import org.telegram.telegrambots.meta.api.objects.commands.scope.BotCommandScopeChat;
                import org.telegram.telegrambots.meta.api.objects.commands.scope.BotCommandScopeDefault;
                import org.telegram.telegrambots.meta.api.objects.Update;
                import org.telegram.telegrambots.meta.exceptions.TelegramApiException;
                
                import java.util.*;
                
                /**
                 * Telegram –±–æ—Ç —Å–µ—Ä–≤–∏—Å - —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
                 */
                public class TelegramBotService extends TelegramLongPollingBot {
                    private static final Logger logger = LoggerFactory.getLogger(TelegramBotService.class);
                
                    private final ThreadManager threadManager;
                    private final long adminId;
                    private final Map<Long, String> userStates = new java.util.concurrent.ConcurrentHashMap<>();
                    private final Map<Long, Map<String, String>> userData = new java.util.concurrent.ConcurrentHashMap<>();
                
                    public TelegramBotService(String token, ThreadManager threadManager) {
                        super(token);
                        this.threadManager = threadManager;
                        this.adminId = Config.getTelegramAdminId();
                        logger.info("TelegramBotService initialized");
                    }
                
                    /**
                     * –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –º–µ–Ω—é –∫–æ–º–∞–Ω–¥ (–∫–Ω–æ–ø–∫–∞ —Å–ª–µ–≤–∞ –æ—Ç –ø–æ–ª—è –≤–≤–æ–¥–∞).
                     * –í—ã–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –±–æ—Ç–∞.
                     */
                    public void configureCommandMenu() {
                        try {
                            List<BotCommand> userCommands = List.of(
                                    new BotCommand("/start", "–ó–∞–ø—É—Å–∫ / –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞"),
                                    new BotCommand("/help", "–°–ø—Ä–∞–≤–∫–∞"),
                                    new BotCommand("/getid", "–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–π ID"),
                                    new BotCommand("/addquery", "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å"),
                                    new BotCommand("/listqueries", "–°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤"),
                                    new BotCommand("/removequery", "–£–¥–∞–ª–∏—Ç—å –∑–∞–ø—Ä–æ—Å"),
                                    new BotCommand("/clearqueries", "–û—á–∏—Å—Ç–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã"),
                                    new BotCommand("/settings", "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"),
                                    new BotCommand("/start_parser", "–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–µ—Ä"),
                                    new BotCommand("/stop_parser", "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä—Å–µ—Ä"),
                                    new BotCommand("/status", "–°—Ç–∞—Ç—É—Å"),
                                    new BotCommand("/stats", "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"),
                                    new BotCommand("/clearhistory", "–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö")
                            );
                
                            execute(new SetMyCommands(userCommands, new BotCommandScopeDefault(), "ru"));
                            logger.info("‚úÖ User command menu configured");
                
                            if (adminId != 0) {
                                List<BotCommand> adminCommands = new ArrayList<>(userCommands);
                                adminCommands.add(new BotCommand("/admin", "–ê–¥–º–∏–Ω-–º–µ–Ω—é"));
                                adminCommands.add(new BotCommand("/cookies", "Cookies"));
                                adminCommands.add(new BotCommand("/help", "–°–ø—Ä–∞–≤–∫–∞ (–∏—Å–ø–æ–ª—å–∑—É–π: /help admin)"));
                
                                execute(new SetMyCommands(adminCommands, new BotCommandScopeChat(String.valueOf(adminId)), "ru"));
                                logger.info("‚úÖ Admin command menu configured for {}", adminId);
                            }
                        } catch (Exception e) {
                            logger.warn("Failed to configure command menu: {}", e.getMessage());
                        }
                    }
                
                    @Override
                    public void onUpdateReceived(Update update) {
                        try {
                            if (update.hasMessage() && update.getMessage().hasText()) {
                                handleMessage(update.getMessage());
                            } else if (update.hasCallbackQuery()) {
                                handleCallback(update.getCallbackQuery());
                            }
                        } catch (Exception e) {
                            logger.error("Error processing update: {}", e.getMessage());
                        }
                    }
                
                    private void handleMessage(org.telegram.telegrambots.meta.api.objects.Message msg) {
                        long userId = msg.getChatId();
                        String text = msg.getText();
                
                        logger.debug("Message from {}: {}", userId, text);
                
                        if (text.startsWith("/")) {
                            handleCommand(userId, text);
                        } else {
                            handleTextResponse(userId, text);
                        }
                    }
                
                    private void handleCommand(long userId, String command) {
                        String[] parts = command.split(" ", 2);
                        String cmd = parts[0].toLowerCase();
                        String args = parts.length > 1 ? parts[1] : "";
                
                        switch (cmd) {
                            case "/start":
                                handleStart(userId);
                                break;
                            case "/help":
                                handleHelpCommand(userId, args);
                                break;
                            case "/status":
                                if (requireAuthorized(userId)) {
                                    sendStatus(userId);
                                }
                                break;
                            case "/addquery":
                                handleAddQuery(userId, args);
                                break;
                            case "/listqueries":
                                handleListQueries(userId);
                                break;
                            case "/removequery":
                                handleRemoveQuery(userId, args);
                                break;
                            case "/settings":
                                handleSettingsCommand(userId, args);
                                break;
                            case "/clearqueries":
                                if (requireAuthorized(userId)) {
                                    UserDataManager.clearUserQueries(userId);
                                    sendMessage(userId, "‚úÖ –ó–∞–ø—Ä–æ—Å—ã –æ—á–∏—â–µ–Ω—ã. –î–æ–±–∞–≤–∏—Ç—å: /addquery");
                                }
                                break;
                            case "/clearhistory":
                                if (requireAuthorized(userId)) {
                                    UserSentProductsManager.clearUserHistory(userId);
                                    sendMessage(userId, "‚úÖ –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –æ—á–∏—â–µ–Ω–∞.");
                                }
                                break;
                            case "/start_parser":
                                if (requireAuthorized(userId)) {
                                    threadManager.startUserParser(userId);
                                }
                                break;
                            case "/stop_parser":
                                if (requireAuthorized(userId)) {
                                    threadManager.stopUserParser(userId);
                                }
                                break;
                            case "/stats":
                                if (requireAuthorized(userId)) {
                                    sendStats(userId);
                                }
                                break;
                            case "/cookies":
                                handleCookiesCommand(userId, args);
                                break;
                            case "/admin":
                                handleAdminCommand(userId, args);
                                break;
                            case "/getid":
                                sendMessage(userId, "–í–∞—à ID: " + userId);
                                break;
                            default:
                                sendMessage(userId, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π /help");
                        }
                    }
                
                    private void handleTextResponse(long userId, String text) {
                        String state = userStates.get(userId);
                        if (state == null) {
                            sendMessage(userId, "–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—ã. /help ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥");
                            return;
                        }
                
                        switch (state) {
                            case "AWAITING_QUERY":
                                if (!requireAuthorized(userId)) {
                                    userStates.remove(userId);
                                    userData.remove(userId);
                                    return;
                                }
                                if (UserDataManager.addUserQuery(userId, text.trim())) {
                                    sendMessage(userId, "‚úÖ Query added: " + text);
                                } else {
                                    sendMessage(userId, "‚ö†Ô∏è Query already exists");
                                }
                                userStates.remove(userId);
                                break;
                            case "AWAITING_SETTING_VALUE":
                                handleSettingUpdate(userId, text);
                                break;
                        }
                    }
                
                    private void handleCallback(org.telegram.telegrambots.meta.api.objects.CallbackQuery callback) {
                        long userId = callback.getMessage().getChatId();
                        String data = callback.getData();
                
                        logger.debug("Callback from {}: {}", userId, data);
                
                        try {
                            execute(new org.telegram.telegrambots.meta.api.methods.AnswerCallbackQuery(callback.getId()));
                        } catch (TelegramApiException e) {
                            logger.warn("Failed to answer callback: {}", e.getMessage());
                        }
                    }
                
                    private void handleStart(long userId) {
                        // ‚ùóÔ∏è–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ whitelist –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∞ (—Å–º. /admin adduser)
                        if (!WhitelistManager.isUserAllowed(userId)) {
                            AccessRequestManager.recordAccessRequest(userId, "/start");
                            String msg = "üëã –ü—Ä–∏–≤–µ—Ç!\n\n" +
                                    "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±–æ—Ç—É.\n" +
                                    "–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –≤–∞—à ID: " + userId + "\n\n" +
                                    "–ö–æ–º–∞–Ω–¥–∞: /getid";
                            sendMessage(userId, msg);
                            return;
                        }
                
                        sendMessage(userId, "üëã –ü—Ä–∏–≤–µ—Ç! –ò—Å–ø–æ–ª—å–∑—É–π /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.");
                    }
                
                    private void handleAddQuery(long userId, String query) {
                        if (!requireAuthorized(userId)) return;
                
                        if (query.trim().isEmpty()) {
                            userStates.put(userId, "AWAITING_QUERY");
                            sendMessage(userId, "Enter search query:");
                            return;
                        }
                
                        if (UserDataManager.addUserQuery(userId, query.trim())) {
                            sendMessage(userId, "‚úÖ Query added: " + query);
                        } else {
                            sendMessage(userId, "‚ö†Ô∏è Query already exists or limit reached");
                        }
                    }
                
                    private void handleListQueries(long userId) {
                        if (!requireAuthorized(userId)) return;
                
                        List<String> queries = UserDataManager.getUserQueries(userId);
                        if (queries.isEmpty()) {
                            sendMessage(userId, "üì≠ –ó–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç. –î–æ–±–∞–≤—å: /addquery");
                            return;
                        }
                
                        StringBuilder sb = new StringBuilder("üìã –í–∞—à–∏ –∑–∞–ø—Ä–æ—Å—ã:\n\n");
                        for (int i = 0; i < queries.size(); i++) {
                            sb.append(String.format("%d. %s\n", i + 1, queries.get(i)));
                        }
                
                        sendMessage(userId, sb.toString());
                    }
                
                    private void handleRemoveQuery(long userId, String arg) {
                        if (!requireAuthorized(userId)) return;
                
                        try {
                            if (arg.trim().isEmpty()) {
                                sendMessage(userId, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /removequery [–Ω–æ–º–µ—Ä]");
                                return;
                            }
                
                            int idx = Integer.parseInt(arg.trim()) - 1;
                            List<String> queries = UserDataManager.getUserQueries(userId);
                
                            if (idx < 0 || idx >= queries.size()) {
                                sendMessage(userId, "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä");
                                return;
                            }
                
                            UserDataManager.removeUserQuery(userId, queries.get(idx));
                            sendMessage(userId, "‚úÖ –ó–∞–ø—Ä–æ—Å —É–¥–∞–ª—ë–Ω");
                        } catch (NumberFormatException e) {
                            sendMessage(userId, "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /removequery [–Ω–æ–º–µ—Ä]");
                        }
                    }
                
                
                    private void handleSettingUpdate(long userId, String value) {
                        try {
                            int intVal = Integer.parseInt(value.trim());
                            UserSettings settings = UserDataManager.getUserSettings(userId);
                            Map<String, String> data = userData.get(userId);
                
                            if (data != null && data.containsKey("setting_key")) {
                                String key = data.get("setting_key");
                                switch (key) {
                                    case "check_interval":
                                        settings.setCheckInterval(intVal);
                                        break;
                                    case "max_age":
                                        settings.setMaxAgeMinutes(intVal);
                                        break;
                                    case "max_pages":
                                        settings.setMaxPages(intVal);
                                        break;
                                    case "rows_per_page":
                                        settings.setRowsPerPage(intVal);
                                        break;
                                }
                                UserDataManager.saveUserSettings(userId, settings);
                                sendMessage(userId, "‚úÖ Setting saved");
                            }
                        } catch (NumberFormatException e) {
                            sendMessage(userId, "‚ùå Invalid number");
                        } finally {
                            userStates.remove(userId);
                            userData.remove(userId);
                        }
                    }
                
                    private void handleHelpCommand(long userId, String args) {
                        String a = args == null ? "" : args.trim().toLowerCase(Locale.ROOT);
                        if ("admin".equals(a)) {
                            if (userId != adminId) {
                                sendMessage(userId, "‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞");
                                return;
                            }
                            sendAdminHelpMessage(userId);
                            return;
                        }
                        sendUserHelpMessage(userId);
                    }
                
                    private void sendUserHelpMessage(long userId) {
                        String help = """
                                üìö –ö–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
                
                                ‚ÑπÔ∏è –î–æ—Å—Ç—É–ø:
                                /start - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
                                /getid - –ø–æ–∫–∞–∑–∞—Ç—å –≤–∞—à ID (—á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω—É)
                
                                üéØ –ó–∞–ø—Ä–æ—Å—ã:
                                /addquery [—Ç–µ–∫—Å—Ç] - –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å
                                /listqueries - —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
                                /removequery [–Ω–æ–º–µ—Ä] - —É–¥–∞–ª–∏—Ç—å –∑–∞–ø—Ä–æ—Å
                                /clearqueries - –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã
                
                                ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
                                /settings - –ø–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                                /settings check_interval <—Å–µ–∫>
                                /settings max_age <–º–∏–Ω>
                                /settings max_pages <—á–∏—Å–ª–æ>
                                /settings rows_per_page <—á–∏—Å–ª–æ>
                
                                ‚ñ∂Ô∏è –ü–∞—Ä—Å–µ—Ä:
                                /start_parser - –∑–∞–ø—É—Å—Ç–∏—Ç—å
                                /stop_parser - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                                /status - —Å—Ç–∞—Ç—É—Å
                                /stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                
                                üßπ –ò—Å—Ç–æ—Ä–∏—è:
                                /clearhistory - –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                
                                üëë –ê–¥–º–∏–Ω:
                                /help admin - –∫–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∞
                                """;
                        sendMessage(userId, help);
                    }
                
                    private void sendAdminHelpMessage(long userId) {
                        String help = """
                                üëë –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∞:
                
                                ‚úÖ –î–æ—Å—Ç—É–ø:
                                /admin users - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π whitelist
                                /admin adduser <id> - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                                /admin removeuser <id> - —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                                /admin pending - –∑–∞—è–≤–∫–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø
                
                                üç™ Cookies:
                                /cookies - –º–µ–Ω—é
                                /cookies status - —Å—Ç–∞—Ç—É—Å
                                /cookies refresh - –æ–±–Ω–æ–≤–∏—Ç—å
                                /cookies dynamic - –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ
                
                                ‚ÑπÔ∏è –°–ø—Ä–∞–≤–∫–∞:
                                /help - –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                                """;
                        sendMessage(userId, help);
                    }
                
                    private void sendSettingsMenu(long userId) {
                        UserSettings s = UserDataManager.getUserSettings(userId);
                        String msg = String.format("""
                                ‚öôÔ∏è Settings:
                                ‚Ä¢ Interval: %d sec
                                ‚Ä¢ Max age: %d min
                                ‚Ä¢ Pages: %d
                                ‚Ä¢ Rows/page: %d
                                ‚Ä¢ Currency: %s
                                
                                Update with:
                                /settings check_interval <seconds>
                                /settings max_age <minutes>
                                /settings max_pages <number>
                                /settings rows_per_page <number>
                                """, s.getCheckInterval(), s.getMaxAgeMinutes(), s.getMaxPages(),
                                s.getRowsPerPage(), s.getPriceCurrency());
                        sendMessage(userId, msg);
                    }
                
                    private void handleSettingsCommand(long userId, String args) {
                        if (!requireAuthorized(userId)) {
                            return;
                        }
                
                        if (args == null || args.trim().isEmpty()) {
                            sendSettingsMenu(userId);
                            return;
                        }
                
                        String[] parts = args.trim().split("\\s+");
                        if (parts.length < 2) {
                            sendMessage(userId, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /settings <–ø–∞—Ä–∞–º–µ—Ç—Ä> <–∑–Ω–∞—á–µ–Ω–∏–µ>\n–ü—Ä–∏–º–µ—Ä: /settings check_interval 300");
                            return;
                        }
                
                        String key = parts[0].toLowerCase(Locale.ROOT);
                        String value = parts[1];
                
                        UserSettings settings = UserDataManager.getUserSettings(userId);
                        try {
                            int intVal = Integer.parseInt(value.trim());
                            switch (key) {
                                case "check_interval":
                                    settings.setCheckInterval(intVal);
                                    break;
                                case "max_age":
                                    settings.setMaxAgeMinutes(intVal);
                                    break;
                                case "max_pages":
                                    settings.setMaxPages(intVal);
                                    break;
                                case "rows_per_page":
                                    settings.setRowsPerPage(intVal);
                                    break;
                                default:
                                    sendMessage(userId, "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞: " + key + "\n–û—Ç–∫—Ä–æ–π –º–µ–Ω—é: /settings");
                                    return;
                            }
                
                            UserDataManager.saveUserSettings(userId, settings);
                            sendMessage(userId, "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞.\n" + settings.getSummary());
                        } catch (NumberFormatException e) {
                            sendMessage(userId, "‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ —á–∏—Å–ª–æ: " + value);
                        }
                    }
                
                    private void sendStatus(long userId) {
                        Map<String, Object> status = threadManager.getUserStatus(userId);
                        if (status == null) {
                            sendMessage(userId, "üî¥ –ü–∞—Ä—Å–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω");
                            return;
                        }
                
                        String msg = String.format(
                                "üìä Parser Status:\n\n" +
                                        "Status: %s\n" +
                                        "Products found: %d\n" +
                                        "Requests made: %d\n" +
                                        "Errors: %d\n" +
                                        "Uptime: %s",
                                status.get("status"),
                                status.get("totalProductsFound"),
                                status.get("requestsMade"),
                                status.get("errorsCount"),
                                status.getOrDefault("uptime", "N/A")
                        );
                
                        sendMessage(userId, msg);
                    }
                
                    private void sendStats(long userId) {
                        Map<String, Object> global = threadManager.getGlobalStatistics();
                        Map<String, Object> user = threadManager.getUserStatus(userId);
                
                        String msg = String.format("""
                                üìä Statistics:
                                
                                Global:
                                ‚Ä¢ Users: %d
                                ‚Ä¢ Products: %d
                                ‚Ä¢ Requests: %d
                                ‚Ä¢ Threads: %d
                                
                                Your parser: %s
                                """, global.get("totalUsers"), global.get("totalProductsFound"),
                                global.get("totalRequestsMade"), global.get("activeThreads"),
                                user == null ? "Not running" : "Running");
                        sendMessage(userId, msg);
                    }
                
                    private void handleCookiesCommand(long userId, String args) {
                        if (userId != adminId) {
                            sendMessage(userId, "‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞");
                            return;
                        }
                
                        if (args.isEmpty()) {
                            String msg = """
                                    üç™ Cookie Management:
                                    /cookies refresh - update cookies
                                    /cookies status - cookie status
                                    /cookies dynamic - toggle dynamic cookies
                                    """;
                            sendMessage(userId, msg);
                            return;
                        }
                
                        if (args.equals("refresh")) {
                            sendMessage(userId, "üîÑ Updating cookies...");
                            try {
                                CookieService.refreshCookies("h5api.m.goofish.com");
                                sendMessage(userId, "‚úÖ Cookies updated");
                            } catch (Exception e) {
                                sendMessage(userId, "‚ùå Error: " + e.getMessage());
                            }
                        } else if (args.equals("status")) {
                            Map<String, Object> stats = CookieService.getCacheStats();
                            String msg = "üç™ Cookie status:\n\n" +
                                    "Dynamic: " + Config.isDynamicCookiesEnabled() + "\n" +
                                    "Cached domains: " + stats.getOrDefault("cachedDomains", "N/A") + "\n" +
                                    "Last refresh: " + stats.getOrDefault("lastRefreshTime", "N/A") + "\n" +
                                    "TTL (min): " + stats.getOrDefault("cacheTTLMinutes", "N/A") + "\n";
                            sendMessage(userId, msg);
                        } else if (args.equals("dynamic")) {
                            boolean current = Config.isDynamicCookiesEnabled();
                            Config.setProperty("cookie.dynamic.enabled", String.valueOf(!current));
                            Config.saveConfig();
                            sendMessage(userId, "‚úÖ Dynamic cookies: " + (!current ? "ON" : "OFF"));
                        } else {
                            sendMessage(userId, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ cookies. –ò—Å–ø–æ–ª—å–∑—É–π /cookies");
                        }
                    }
                
                    private void handleAdminCommand(long userId, String args) {
                        if (userId != adminId) {
                            sendMessage(userId, "‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞");
                            return;
                        }
                
                        if (args.isEmpty()) {
                            String menu = """
                                    üëë Admin:
                                    /admin stats - statistics
                                    /admin users - user list
                                    /admin adduser [id] - add user
                                    /admin removeuser [id] - remove user
                                    """;
                            sendMessage(userId, menu);
                            return;
                        }
                
                        String[] parts = args.split(" ", 2);
                        switch (parts[0]) {
                            case "stats":
                                sendStats(userId);
                                break;
                            case "users":
                                List<Long> users = WhitelistManager.getAllUsers();
                                Collections.sort(users);
                                StringBuilder sb = new StringBuilder("üë• Whitelist users: " + users.size() + "\n\n");
                                for (Long u : users) sb.append(u).append("\n");
                                sendMessage(userId, sb.toString());
                                break;
                            case "pending":
                                List<String> reqs = AccessRequestManager.getRequests();
                                if (reqs.isEmpty()) {
                                    sendMessage(userId, "üì≠ –ó–∞—è–≤–æ–∫ –Ω–µ—Ç");
                                    break;
                                }
                                StringBuilder rsb = new StringBuilder("üì® –ó–∞—è–≤–∫–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø:\n\n");
                                for (String line : reqs) {
                                    rsb.append(line).append("\n");
                                }
                                rsb.append("\n–î–æ–±–∞–≤–∏—Ç—å: /admin adduser <id>");
                                sendMessage(userId, rsb.toString());
                                break;
                            case "adduser":
                                if (parts.length > 1) {
                                    try {
                                        long uid = Long.parseLong(parts[1]);
                                        WhitelistManager.addUser(uid);
                                        AccessRequestManager.removeRequest(uid);
                                        sendMessage(userId, "‚úÖ User added");
                                    } catch (NumberFormatException e) {
                                        sendMessage(userId, "‚ùå Invalid ID");
                                    }
                                } else {
                                    sendMessage(userId, "Use: /admin adduser [id]");
                                }
                                break;
                            case "removeuser":
                                if (parts.length > 1) {
                                    try {
                                        long uid = Long.parseLong(parts[1]);
                                        WhitelistManager.removeUser(uid);
                                        threadManager.stopUserParser(uid);
                                        sendMessage(userId, "‚úÖ User removed");
                                    } catch (NumberFormatException e) {
                                        sendMessage(userId, "‚ùå Invalid ID");
                                    }
                                } else {
                                    sendMessage(userId, "Use: /admin removeuser [id]");
                                }
                                break;
                        }
                    }
                
                    private boolean requireAuthorized(long userId) {
                        if (!WhitelistManager.isUserAllowed(userId)) {
                            AccessRequestManager.recordAccessRequest(userId, "unauthorized_command");
                            sendMessage(userId, "‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞. –û—Ç–ø—Ä–∞–≤—å /getid –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.");
                            return false;
                        }
                        return true;
                    }
                
                    protected void sendMessage(long userId, String text) {
                        SendMessage msg = new SendMessage(String.valueOf(userId), text);
                        // –í–ê–ñ–ù–û: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º Markdown, —á—Ç–æ–±—ã –∫–æ–º–∞–Ω–¥—ã –≤–∏–¥–∞ /start_parser –Ω–µ –ª–æ–º–∞–ª–∏ entities.
                        msg.disableWebPagePreview();
                        try {
                            execute(msg);
                        } catch (TelegramApiException e) {
                            logger.error("Failed to send message: {}", e.getMessage());
                        }
                    }
                
                    @Override
                    public String getBotUsername() {
                        return Config.getTelegramBotUsername();
                    }
                }
                ----------------------------------------

            [FILE] Main.java
              –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/Main.java
              –†–∞–∑–º–µ—Ä: 6041 –±–∞–π—Ç
              –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-28T19:07:07.299156736Z
              –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
              ----------------------------------------
              package com.parser;
              
              import com.parser.config.Config;
              import com.parser.core.ThreadManager;
              import com.parser.service.CookieService;
              import com.parser.storage.FileStorage;
              import com.parser.storage.WhitelistManager;
              import com.parser.telegram.TelegramBotService;
              import com.parser.telegram.TelegramNotificationService;
              import org.slf4j.Logger;
              import org.slf4j.LoggerFactory;
              import org.telegram.telegrambots.meta.TelegramBotsApi;
              import org.telegram.telegrambots.meta.exceptions.TelegramApiException;
              import org.telegram.telegrambots.updatesreceivers.DefaultBotSession;
              
              /**
               * –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
               */
              public class Main {
                  private static final Logger logger = LoggerFactory.getLogger(Main.class);
                  private static ThreadManager threadManager;
                  private static TelegramBotService botService;
              
                  public static void main(String[] args) {
                      try {
                          logger.info("=".repeat(60));
                          logger.info("Product Parser with Real-Time Cookies");
                          logger.info("=".repeat(60));
              
                          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                          String botToken = Config.getTelegramBotToken();
                          String botUsername = Config.getTelegramBotUsername();
              
                          if (botToken.isEmpty() || botToken.equals("–í–ê–®_–¢–û–ö–ï–ù_–ë–û–¢–ê")) {
                              logger.error("‚ùå Bot token not configured!");
                              System.exit(1);
                          }
              
                          logger.info("‚úÖ Configuration:");
                          logger.info("   Token: {}...", botToken.substring(0, 10));
                          logger.info("   Username: @{}", botUsername);
                          logger.info("   Admin ID: {}", Config.getTelegramAdminId());
              
                          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                          FileStorage.ensureDataDir();
                          logger.info("‚úÖ Data directory ready");
              
                          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã cookies
                          logger.info("üç™ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã cookies...");
                          CookieService.initialize();
              
                          // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ cookies
                          logger.info("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ cookies...");
                          if (!CookieService.testCookies()) {
                              logger.warn("‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: cookies –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã");
                          } else {
                              logger.info("‚úÖ Cookies —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ");
                          }
              
                          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–æ—Ç–æ–∫–æ–≤
                          threadManager = new ThreadManager();
                          logger.info("‚úÖ ThreadManager initialized");
              
                          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram –±–æ—Ç–∞
                          initializeTelegramBot(botToken);
              
                          logger.info("=".repeat(60));
                          logger.info("‚úÖ Application started successfully!");
                          logger.info("üëë Admin ID: {}", Config.getTelegramAdminId());
                          logger.info("üç™ Dynamic cookies: {}", Config.isDynamicCookiesEnabled());
                          logger.info("üìã Users: {}", WhitelistManager.getUserCount());
                          logger.info("=".repeat(60));
              
                          // –î–æ–±–∞–≤–ª—è–µ–º shutdown hook
                          Runtime.getRuntime().addShutdownHook(new Thread(() -> {
                              logger.info("üõë –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è...");
                              shutdown();
                          }));
              
                          keepApplicationRunning();
              
                      } catch (Exception e) {
                          logger.error("‚ùå Startup error: {}", e.getMessage(), e);
                          shutdown();
                          System.exit(1);
                      }
                  }
              
                  private static void initializeTelegramBot(String botToken) throws TelegramApiException {
                      logger.info("ü§ñ Initializing Telegram bot...");
              
                      botService = new TelegramBotService(botToken, threadManager);
                      TelegramNotificationService.setBotInstance(botService);
              
                      TelegramBotsApi botsApi = new TelegramBotsApi(DefaultBotSession.class);
                      botsApi.registerBot(botService);
              
                      // –ú–µ–Ω—é –∫–æ–º–∞–Ω–¥ (–∫–Ω–æ–ø–∫–∞ —Å–ª–µ–≤–∞ –æ—Ç –≤–≤–æ–¥–∞ –≤ Telegram)
                      botService.configureCommandMenu();
              
                      logger.info("‚úÖ Telegram bot registered and running");
                  }
              
                  private static void keepApplicationRunning() {
                      try {
                          logger.info("‚è≥ Application is running...");
              
                          long lastStatusLog = System.currentTimeMillis();
                          long lastCookieCheck = System.currentTimeMillis();
              
                          while (true) {
                              Thread.sleep(30000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
              
                              long now = System.currentTimeMillis();
              
                              // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
                              if (now - lastStatusLog > 5 * 60 * 1000) {
                                  if (threadManager.getActiveUsers().size() > 0) {
                                      logger.info("üìä Active users: {}", threadManager.getActiveUsers().size());
                                  }
                                  lastStatusLog = now;
                              }
              
                              // –ü—Ä–æ–≤–µ—Ä–∫–∞ cookies –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
                              if (now - lastCookieCheck > 30 * 60 * 1000) {
                                  logger.info("üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è cookies...");
                                  if (!CookieService.hasValidCookies()) {
                                      logger.warn("‚ö†Ô∏è Cookies –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...");
                                      CookieService.refreshCookies("www.goofish.com");
                                  }
                                  lastCookieCheck = now;
                              }
                          }
                      } catch (InterruptedException e) {
                          Thread.currentThread().interrupt();
                          logger.info("Application interrupted");
                      }
                  }
              
                  private static void shutdown() {
                      logger.info("üõë Shutting down...");
              
                      if (threadManager != null) {
                          threadManager.shutdown();
                      }
              
                      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º CookieService
                      CookieService.shutdown();
              
                      logger.info("‚úÖ Shutdown complete");
                  }
              }
              ----------------------------------------
            [DIR] model

              [FILE] Product.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/model/Product.java
                –†–∞–∑–º–µ—Ä: 7450 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-28T21:02:25.22849093Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.model;
                
                import com.fasterxml.jackson.annotation.JsonIgnore;
                import com.fasterxml.jackson.annotation.JsonProperty;
                import com.parser.config.ParserSettings;
                import java.util.ArrayList;
                import java.util.List;
                
                /**
                 * –ö–ª–∞—Å—Å, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π —Ç–æ–≤–∞—Ä
                 */
                public class Product {
                    private String id;
                    private String title;
                    private double price;
                    private String url;
                    private String site;
                    private String location;
                    private int ageMinutes;
                    private String query;
                    private List<String> images;
                    private String seller;
                    private String sellerRating;
                    private String category;
                    private boolean isNew;
                    private long foundTimestamp;
                
                    public Product() {
                        this.images = new ArrayList<>();
                        this.isNew = true;
                        this.foundTimestamp = System.currentTimeMillis();
                    }
                
                    public Product(String id, String title, double price, String url, String site,
                                   String location, int ageMinutes, String query) {
                        this();
                        this.id = id;
                        this.title = title;
                        this.price = price;
                        this.url = url;
                        this.site = site;
                        this.location = location;
                        this.ageMinutes = ageMinutes;
                        this.query = query;
                    }
                
                    // –ì–µ—Ç—Ç–µ—Ä—ã –∏ —Å–µ—Ç—Ç–µ—Ä—ã
                
                    @JsonProperty("id")
                    public String getId() {
                        return id;
                    }
                
                    public void setId(String id) {
                        this.id = id;
                    }
                
                    @JsonProperty("title")
                    public String getTitle() {
                        return title;
                    }
                
                    public void setTitle(String title) {
                        if (title == null) {
                            this.title = "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
                        } else if (title.length() > 200) {
                            this.title = title.substring(0, 197) + "...";
                        } else {
                            this.title = title.trim();
                        }
                    }
                
                    @JsonProperty("price")
                    public double getPrice() {
                        return price;
                    }
                
                    public void setPrice(double price) {
                        this.price = Math.max(0, price);
                    }
                
                    @JsonProperty("url")
                    public String getUrl() {
                        return url;
                    }
                
                    public void setUrl(String url) {
                        this.url = url;
                    }
                
                    @JsonProperty("site")
                    public String getSite() {
                        return site;
                    }
                
                    public void setSite(String site) {
                        this.site = site;
                    }
                
                    @JsonProperty("location")
                    public String getLocation() {
                        return location;
                    }
                
                    public void setLocation(String location) {
                        this.location = location;
                    }
                
                    @JsonProperty("ageMinutes")
                    public int getAgeMinutes() {
                        return ageMinutes;
                    }
                
                    public void setAgeMinutes(int ageMinutes) {
                        this.ageMinutes = Math.max(0, ageMinutes);
                    }
                
                    @JsonProperty("query")
                    public String getQuery() {
                        return query;
                    }
                
                    public void setQuery(String query) {
                        this.query = query;
                    }
                
                    @JsonProperty("images")
                    public List<String> getImages() {
                        return new ArrayList<>(images);
                    }
                
                    public void setImages(List<String> images) {
                        this.images = new ArrayList<>(images);
                    }
                
                    public void addImage(String image) {
                        if (image != null && !image.trim().isEmpty()) {
                            this.images.add(image.trim());
                        }
                    }
                
                    @JsonProperty("seller")
                    public String getSeller() {
                        return seller;
                    }
                
                    public void setSeller(String seller) {
                        this.seller = seller;
                    }
                
                    @JsonProperty("sellerRating")
                    public String getSellerRating() {
                        return sellerRating;
                    }
                
                    public void setSellerRating(String sellerRating) {
                        this.sellerRating = sellerRating;
                    }
                
                    @JsonProperty("category")
                    public String getCategory() {
                        return category;
                    }
                
                    public void setCategory(String category) {
                        this.category = category;
                    }
                
                    @JsonProperty("isNew")
                    public boolean isNew() {
                        return isNew;
                    }
                
                    public void setNew(boolean isNew) {
                        this.isNew = isNew;
                    }
                
                    @JsonProperty("foundTimestamp")
                    public long getFoundTimestamp() {
                        return foundTimestamp;
                    }
                
                    public void setFoundTimestamp(long foundTimestamp) {
                        this.foundTimestamp = foundTimestamp;
                    }
                
                    // –ú–µ—Ç–æ–¥—ã –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ü–µ–Ω—ã
                
                    @JsonIgnore
                    public double getPriceRubles() {
                        return Math.round(price * ParserSettings.getCurrencyRate(
                                ParserSettings.CURRENCY_YUAN, ParserSettings.CURRENCY_RUBLES) * 100.0) / 100.0;
                    }
                
                    @JsonIgnore
                    public String getPriceDisplay() {
                        return String.format("%.2f ¬•", price);
                    }
                
                    @JsonIgnore
                    public String getPriceDisplayRub() {
                        return String.format("%.2f —Ä—É–±.", getPriceRubles());
                    }
                
                    @JsonIgnore
                    public String getFormattedPrice(String currency) {
                        if (ParserSettings.CURRENCY_RUBLES.equals(currency)) {
                            return getPriceDisplayRub();
                        } else {
                            return getPriceDisplay();
                        }
                    }
                
                    // –ú–µ—Ç–æ–¥—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                
                    @JsonIgnore
                    public String getShortTitle() {
                        if (title == null || title.isEmpty() || "No title".equals(title)) {
                            return "–¢–æ–≤–∞—Ä #" + id;
                        }
                
                        if (title.length() <= 80) { // –£–º–µ–Ω—å—à–∞–µ–º –ª–∏–º–∏—Ç –¥–ª—è –±–æ–ª–µ–µ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            return title;
                        }
                        return title.substring(0, 77) + "...";
                    }
                
                    @JsonIgnore
                    public String getAgeDisplay() {
                        if (ageMinutes < 60) {
                            return ageMinutes + " –º–∏–Ω";
                        } else if (ageMinutes < 1440) {
                            return (ageMinutes / 60) + " —á";
                        } else {
                            return (ageMinutes / 1440) + " –¥–Ω";
                        }
                    }
                
                    @JsonIgnore
                    public boolean hasImages() {
                        return !images.isEmpty();
                    }
                
                    @JsonIgnore
                    public String getMainImage() {
                        return images.isEmpty() ? null : images.get(0);
                    }
                
                    // –ù–û–í–´–ô –ú–ï–¢–û–î: –ü–æ–ª—É—á–µ–Ω–∏–µ URL –æ–±–ª–æ–∂–∫–∏ (–ø–µ—Ä–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
                    @JsonIgnore
                    public String getCoverImageUrl() {
                        if (images != null && !images.isEmpty()) {
                            return images.get(0);
                        }
                        return null;
                    }
                
                    // –ù–û–í–´–ô –ú–ï–¢–û–î: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–±–ª–æ–∂–∫–∏
                    @JsonIgnore
                    public boolean hasCoverImage() {
                        return getCoverImageUrl() != null;
                    }
                
                    // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                
                    @JsonIgnore
                    public String toJsonString() {
                        return String.format(
                                "{\"id\":\"%s\",\"title\":\"%s\",\"price\":%.2f,\"url\":\"%s\",\"age\":%d}",
                                id, title.replace("\"", "\\\""), price, url, ageMinutes
                        );
                    }
                
                    @JsonIgnore
                    public String toCsvString() {
                        return String.format("%s,\"%s\",%.2f,%s,%s,%d",
                                id, title.replace("\"", "\"\""), price, url, location, ageMinutes);
                    }
                
                    @Override
                    public String toString() {
                        return String.format("Product{id='%s', title='%s', price=%.2f¬•, age=%dmin, location=%s}",
                                id, getShortTitle(), price, ageMinutes, location);
                    }
                
                    @Override
                    public boolean equals(Object obj) {
                        if (this == obj) return true;
                        if (obj == null || getClass() != obj.getClass()) return false;
                        Product product = (Product) obj;
                        return id != null && id.equals(product.id);
                    }
                
                    @Override
                    public int hashCode() {
                        return id != null ? id.hashCode() : 0;
                    }
                }
                ----------------------------------------

              [FILE] UserSettings.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/model/UserSettings.java
                –†–∞–∑–º–µ—Ä: 8886 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-28T19:39:40.586085721Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.model;
                
                import com.fasterxml.jackson.annotation.JsonIgnore;
                import com.fasterxml.jackson.annotation.JsonProperty;
                import com.parser.config.Config;
                import com.parser.config.ParserSettings;
                import java.io.Serializable;
                
                /**
                 * –ö–ª–∞—Å—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞
                 */
                public class UserSettings implements Serializable {
                    private static final long serialVersionUID = 1L;
                
                    // –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    private int checkInterval = 300; // —Å–µ–∫—É–Ω–¥—ã
                    private int maxAgeMinutes = 1440; // 24 —á–∞—Å–∞
                    private int maxPages = 3;
                    private int rowsPerPage = 100;
                
                    // –í–∞–ª—é—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    private String priceCurrency = ParserSettings.CURRENCY_RUBLES;
                
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                    private boolean notifyNewOnly = true;
                    private boolean notifyTelegram = true;
                    private boolean notifyEmail = false;
                    private boolean notifySound = true;
                
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
                    private double minPrice = 0;
                    private double maxPrice = 0; // 0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
                    private String[] locations = {};
                    private String[] excludedKeywords = {};
                
                    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    private boolean enableProxy = false;
                    private String proxyAddress = "";
                    private int proxyPort = 0;
                    private int requestDelay = 2000; // –º—Å
                    private int maxRetries = 3;
                
                    public UserSettings() {
                        // –î–µ—Ñ–æ–ª—Ç—ã –±–µ—Ä—ë–º –∏–∑ config.properties (—á—Ç–æ–±—ã —Å–æ–≤–ø–∞–¥–∞–ª–æ —Å —Ç–µ–º, —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
                        setCheckInterval(Config.getDefaultCheckInterval());
                        setMaxAgeMinutes(Config.getDefaultMaxAgeMinutes());
                        setMaxPages(Config.getDefaultMaxPages());
                        setRowsPerPage(Config.getDefaultRowsPerPage());
                    }
                
                    // –ì–µ—Ç—Ç–µ—Ä—ã –∏ —Å–µ—Ç—Ç–µ—Ä—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
                
                    @JsonProperty("checkInterval")
                    public int getCheckInterval() {
                        return checkInterval;
                    }
                
                    public void setCheckInterval(int checkInterval) {
                        this.checkInterval = ParserSettings.normalizeCheckInterval(checkInterval);
                    }
                
                    @JsonProperty("maxAgeMinutes")
                    public int getMaxAgeMinutes() {
                        return maxAgeMinutes;
                    }
                
                    public void setMaxAgeMinutes(int maxAgeMinutes) {
                        this.maxAgeMinutes = ParserSettings.normalizeMaxAge(maxAgeMinutes);
                    }
                
                    @JsonProperty("maxPages")
                    public int getMaxPages() {
                        return maxPages;
                    }
                
                    public void setMaxPages(int maxPages) {
                        this.maxPages = Math.max(ParserSettings.MIN_MAX_PAGES,
                                Math.min(maxPages, ParserSettings.MAX_MAX_PAGES));
                    }
                
                    @JsonProperty("rowsPerPage")
                    public int getRowsPerPage() {
                        return rowsPerPage;
                    }
                
                    public void setRowsPerPage(int rowsPerPage) {
                        this.rowsPerPage = Math.max(ParserSettings.MIN_ROWS_PER_PAGE,
                                Math.min(rowsPerPage, ParserSettings.MAX_ROWS_PER_PAGE));
                    }
                
                    @JsonProperty("priceCurrency")
                    public String getPriceCurrency() {
                        return priceCurrency;
                    }
                
                    public void setPriceCurrency(String priceCurrency) {
                        if (ParserSettings.CURRENCY_YUAN.equals(priceCurrency) ||
                                ParserSettings.CURRENCY_RUBLES.equals(priceCurrency)) {
                            this.priceCurrency = priceCurrency;
                        }
                    }
                
                    @JsonProperty("notifyNewOnly")
                    public boolean isNotifyNewOnly() {
                        return notifyNewOnly;
                    }
                
                    public void setNotifyNewOnly(boolean notifyNewOnly) {
                        this.notifyNewOnly = notifyNewOnly;
                    }
                
                    @JsonProperty("notifyTelegram")
                    public boolean isNotifyTelegram() {
                        return notifyTelegram;
                    }
                
                    public void setNotifyTelegram(boolean notifyTelegram) {
                        this.notifyTelegram = notifyTelegram;
                    }
                
                    @JsonProperty("notifyEmail")
                    public boolean isNotifyEmail() {
                        return notifyEmail;
                    }
                
                    public void setNotifyEmail(boolean notifyEmail) {
                        this.notifyEmail = notifyEmail;
                    }
                
                    @JsonProperty("notifySound")
                    public boolean isNotifySound() {
                        return notifySound;
                    }
                
                    public void setNotifySound(boolean notifySound) {
                        this.notifySound = notifySound;
                    }
                
                    @JsonProperty("minPrice")
                    public double getMinPrice() {
                        return minPrice;
                    }
                
                    public void setMinPrice(double minPrice) {
                        this.minPrice = Math.max(0, minPrice);
                    }
                
                    @JsonProperty("maxPrice")
                    public double getMaxPrice() {
                        return maxPrice;
                    }
                
                    public void setMaxPrice(double maxPrice) {
                        this.maxPrice = maxPrice < 0 ? 0 : maxPrice;
                    }
                
                    @JsonProperty("locations")
                    public String[] getLocations() {
                        return locations != null ? locations.clone() : new String[0];
                    }
                
                    public void setLocations(String[] locations) {
                        this.locations = locations != null ? locations.clone() : new String[0];
                    }
                
                    @JsonProperty("excludedKeywords")
                    public String[] getExcludedKeywords() {
                        return excludedKeywords != null ? excludedKeywords.clone() : new String[0];
                    }
                
                    public void setExcludedKeywords(String[] excludedKeywords) {
                        this.excludedKeywords = excludedKeywords != null ? excludedKeywords.clone() : new String[0];
                    }
                
                    @JsonProperty("enableProxy")
                    public boolean isEnableProxy() {
                        return enableProxy;
                    }
                
                    public void setEnableProxy(boolean enableProxy) {
                        this.enableProxy = enableProxy;
                    }
                
                    @JsonProperty("proxyAddress")
                    public String getProxyAddress() {
                        return proxyAddress;
                    }
                
                    public void setProxyAddress(String proxyAddress) {
                        this.proxyAddress = proxyAddress != null ? proxyAddress.trim() : "";
                    }
                
                    @JsonProperty("proxyPort")
                    public int getProxyPort() {
                        return proxyPort;
                    }
                
                    public void setProxyPort(int proxyPort) {
                        this.proxyPort = Math.max(0, Math.min(proxyPort, 65535));
                    }
                
                    @JsonProperty("requestDelay")
                    public int getRequestDelay() {
                        return requestDelay;
                    }
                
                    public void setRequestDelay(int requestDelay) {
                        this.requestDelay = Math.max(500, Math.min(requestDelay, 10000));
                    }
                
                    @JsonProperty("maxRetries")
                    public int getMaxRetries() {
                        return maxRetries;
                    }
                
                    public void setMaxRetries(int maxRetries) {
                        this.maxRetries = Math.max(0, Math.min(maxRetries, 10));
                    }
                
                    // –ú–µ—Ç–æ–¥—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                
                    @JsonIgnore
                    public boolean hasPriceFilter() {
                        return maxPrice > 0 && maxPrice > minPrice;
                    }
                
                    @JsonIgnore
                    public boolean hasLocationFilter() {
                        return locations != null && locations.length > 0;
                    }
                
                    @JsonIgnore
                    public boolean hasKeywordFilter() {
                        return excludedKeywords != null && excludedKeywords.length > 0;
                    }
                
                    @JsonIgnore
                    public boolean isPriceInRange(double price) {
                        if (minPrice > 0 && price < minPrice) {
                            return false;
                        }
                        if (maxPrice > 0 && price > maxPrice) {
                            return false;
                        }
                        return true;
                    }
                
                    @JsonIgnore
                    public boolean isLocationAllowed(String location) {
                        if (!hasLocationFilter()) {
                            return true;
                        }
                
                        if (location == null || location.trim().isEmpty()) {
                            return false;
                        }
                
                        String locationLower = location.toLowerCase();
                        for (String allowedLocation : locations) {
                            if (locationLower.contains(allowedLocation.toLowerCase())) {
                                return true;
                            }
                        }
                
                        return false;
                    }
                
                    @JsonIgnore
                    public boolean isKeywordAllowed(String text) {
                        if (!hasKeywordFilter() || text == null) {
                            return true;
                        }
                
                        String textLower = text.toLowerCase();
                        for (String keyword : excludedKeywords) {
                            if (keyword != null && !keyword.trim().isEmpty() &&
                                    textLower.contains(keyword.toLowerCase())) {
                                return false;
                            }
                        }
                
                        return true;
                    }
                
                    @JsonIgnore
                    public boolean isValid() {
                        return ParserSettings.isValidCheckInterval(checkInterval) &&
                                ParserSettings.isValidMaxAge(maxAgeMinutes) &&
                                maxPages >= ParserSettings.MIN_MAX_PAGES &&
                                rowsPerPage >= ParserSettings.MIN_ROWS_PER_PAGE;
                    }
                
                    @JsonIgnore
                    public String getSummary() {
                        return String.format(
                                "–ò–Ω—Ç–µ—Ä–≤–∞–ª: %d —Å–µ–∫, –í–æ–∑—Ä–∞—Å—Ç: %d –º–∏–Ω, –°—Ç—Ä–∞–Ω–∏—Ü: %d, –¢–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: %d",
                                checkInterval, maxAgeMinutes, maxPages, rowsPerPage
                        );
                    }
                
                    @Override
                    public String toString() {
                        return String.format(
                                "UserSettings{checkInterval=%d, maxAge=%d, maxPages=%d, rowsPerPage=%d}",
                                checkInterval, maxAgeMinutes, maxPages, rowsPerPage
                        );
                    }
                }
                ----------------------------------------
            [DIR] service

              [FILE] CookieService.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/service/CookieService.java
                –†–∞–∑–º–µ—Ä: 16673 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T22:46:43.647336526Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.service;
                
                import com.parser.config.Config;
                import com.parser.config.CookieConfig;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                
                import java.io.FileOutputStream;
                import java.util.*;
                import java.util.concurrent.ConcurrentHashMap;
                import java.util.concurrent.Executors;
                import java.util.concurrent.ScheduledExecutorService;
                import java.util.concurrent.TimeUnit;
                
                /**
                 * –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å cookies —á–µ—Ä–µ–∑ Selenium
                 */
                public class CookieService {
                    private static final Logger logger = LoggerFactory.getLogger(CookieService.class);
                
                    // –ö—ç—à cookies –¥–ª—è –¥–æ–º–µ–Ω–æ–≤
                    private static final Map<String, Map<String, String>> cookieCache = new ConcurrentHashMap<>();
                    private static final Map<String, Long> cacheTimestamp = new ConcurrentHashMap<>();
                    private static final long CACHE_TTL = 30 * 60 * 1000; // 30 –º–∏–Ω—É—Ç
                
                    private static long lastRefreshTime = 0;
                    private static final long REFRESH_INTERVAL = 120 * 60 * 1000; // 2 —á–∞—Å–∞
                
                    private static ScheduledExecutorService scheduler;
                
                    // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–º–µ–Ω—ã –¥–ª—è Goofish
                    private static final String PRIMARY_DOMAIN = "www.goofish.com";
                    private static final String API_DOMAIN = "h5api.m.goofish.com";
                    private static final String M_DOMAIN = "m.goofish.com";
                
                    /**
                     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
                     */
                    public static synchronized void initialize() {
                        if (scheduler != null && !scheduler.isShutdown()) {
                            return;
                        }
                
                        logger.info("üç™ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CookieService...");
                
                        // –°–æ–∑–¥–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                        scheduler = Executors.newScheduledThreadPool(1);
                
                        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
                        if (Config.getBoolean("cookie.auto.update", true)) {
                            int interval = Config.getInt("cookie.update.interval.minutes", 120);
                            scheduler.scheduleAtFixedRate(() -> {
                                try {
                                    logger.info("üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies...");
                                    if (refreshCookies(PRIMARY_DOMAIN)) {
                                        logger.info("‚úÖ Cookies —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã");
                                    } else {
                                        logger.warn("‚ö†Ô∏è –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies –Ω–µ —É–¥–∞–ª–æ—Å—å");
                                    }
                                } catch (Exception e) {
                                    logger.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ cookies: {}", e.getMessage());
                                }
                            }, interval, interval, TimeUnit.MINUTES);
                
                            logger.info("‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ: –∫–∞–∂–¥—ã–µ {} –º–∏–Ω—É—Ç", interval);
                        }
                
                        // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ cookies
                        try {
                            logger.info("üîÑ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ cookies...");
                            getFreshCookies(PRIMARY_DOMAIN);
                        } catch (Exception e) {
                            logger.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ cookies: {}", e.getMessage());
                        }
                
                        logger.info("‚úÖ CookieService –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ–∂–∏—Ö cookies –¥–ª—è –¥–æ–º–µ–Ω–∞
                     */
                    public static Map<String, String> getFreshCookies(String domain) {
                        if (!Config.isDynamicCookiesEnabled()) {
                            logger.debug("üç™ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ cookies –æ—Ç–∫–ª—é—á–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ");
                            return getCookiesFromConfig(domain);
                        }
                
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
                        if (cookieCache.containsKey(domain) && cacheTimestamp.containsKey(domain)) {
                            long cacheAge = System.currentTimeMillis() - cacheTimestamp.get(domain);
                            if (cacheAge < CACHE_TTL) {
                                logger.debug("üç™ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ cookies –¥–ª—è {} (–≤–æ–∑—Ä–∞—Å—Ç: {} –º–∏–Ω)",
                                        domain, cacheAge / (60 * 1000));
                                return new HashMap<>(cookieCache.get(domain));
                            } else {
                                logger.debug("üç™ –ö—ç—à cookies –¥–ª—è {} —É—Å—Ç–∞—Ä–µ–ª (–≤–æ–∑—Ä–∞—Å—Ç: {} –º–∏–Ω)",
                                        domain, cacheAge / (60 * 1000));
                            }
                        }
                
                        logger.info("üîÑ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ–∂–∏—Ö cookies –¥–ª—è {}", domain);
                
                        // –ü–æ–ª—É—á–∞–µ–º –∫—É–∫–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∫–∞–∫ fallback
                        Map<String, String> configCookies = getCookiesFromConfig(domain);
                
                        try {
                            // –ü–æ–ª—É—á–∞–µ–º —Å–≤–µ–∂–∏–µ cookies —á–µ—Ä–µ–∑ Selenium
                            Map<String, String> freshCookies = SeleniumCookieFetcher.getFreshCookies();
                
                            if (SeleniumCookieFetcher.validateCookies(freshCookies)) {
                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤ Goofish
                                updateCookieConfigForAllDomains(freshCookies);
                
                                // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
                                cookieCache.put(PRIMARY_DOMAIN, new HashMap<>(freshCookies));
                                cookieCache.put(API_DOMAIN, new HashMap<>(freshCookies));
                                cookieCache.put(M_DOMAIN, new HashMap<>(freshCookies));
                
                                cacheTimestamp.put(PRIMARY_DOMAIN, System.currentTimeMillis());
                                cacheTimestamp.put(API_DOMAIN, System.currentTimeMillis());
                                cacheTimestamp.put(M_DOMAIN, System.currentTimeMillis());
                
                                lastRefreshTime = System.currentTimeMillis();
                
                                logger.info("‚úÖ –ü–æ–ª—É—á–µ–Ω—ã —Å–≤–µ–∂–∏–µ cookies, {} —ç–ª–µ–º–µ–Ω—Ç–æ–≤", freshCookies.size());
                                return freshCookies;
                            } else {
                                logger.warn("‚ö†Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤–µ–∂–∏—Ö cookies –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ");
                                if (!configCookies.isEmpty()) {
                                    return configCookies;
                                }
                            }
                        } catch (Exception e) {
                            logger.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ–∂–∏—Ö cookies: {}", e.getMessage());
                            if (!configCookies.isEmpty()) {
                                logger.info("üç™ –ò—Å–ø–æ–ª—å–∑—É–µ–º cookies –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞");
                                return configCookies;
                            }
                        }
                
                        logger.warn("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å cookies, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—ã–µ");
                        return new HashMap<>();
                    }
                
                    /**
                     * –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies
                     */
                    public static boolean refreshCookies(String domain) {
                        logger.info("üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies –¥–ª—è: {}", domain);
                
                        try {
                            Map<String, String> freshCookies = SeleniumCookieFetcher.getFreshCookies();
                
                            if (SeleniumCookieFetcher.validateCookies(freshCookies)) {
                                updateCookieConfigForAllDomains(freshCookies);
                
                                // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
                                cookieCache.put(PRIMARY_DOMAIN, new HashMap<>(freshCookies));
                                cookieCache.put(API_DOMAIN, new HashMap<>(freshCookies));
                                cookieCache.put(M_DOMAIN, new HashMap<>(freshCookies));
                
                                cacheTimestamp.put(PRIMARY_DOMAIN, System.currentTimeMillis());
                                cacheTimestamp.put(API_DOMAIN, System.currentTimeMillis());
                                cacheTimestamp.put(M_DOMAIN, System.currentTimeMillis());
                
                                lastRefreshTime = System.currentTimeMillis();
                
                                logger.info("‚úÖ Cookies —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã, {} —ç–ª–µ–º–µ–Ω—Ç–æ–≤", freshCookies.size());
                                return true;
                            } else {
                                logger.error("‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è cookies –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞");
                                return false;
                            }
                        } catch (Exception e) {
                            logger.error("‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è cookies: {}", e.getMessage());
                            return false;
                        }
                    }
                
                    /**
                     * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies —á–µ—Ä–µ–∑ GUI (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
                     */
                    public static boolean refreshCookiesWithGUI(String domain) {
                        logger.info("üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies —á–µ—Ä–µ–∑ GUI –¥–ª—è: {}", domain);
                
                        try {
                            Map<String, String> freshCookies = SeleniumCookieFetcher.getFreshCookiesWithGUI();
                
                            if (SeleniumCookieFetcher.validateCookies(freshCookies)) {
                                updateCookieConfigForAllDomains(freshCookies);
                                lastRefreshTime = System.currentTimeMillis();
                                logger.info("‚úÖ Cookies –æ–±–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ GUI");
                                return true;
                            } else {
                                logger.error("‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞");
                                return false;
                            }
                        } catch (Exception e) {
                            logger.error("‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è cookies —á–µ—Ä–µ–∑ GUI: {}", e.getMessage());
                            return false;
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ cookies –¥–ª—è HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∞
                     */
                    public static String getCookieHeader(String domain) {
                        Map<String, String> cookies = getFreshCookies(domain);
                        return cookiesToHeaderString(cookies);
                    }
                
                    /**
                     * –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
                     */
                    public static void clearCache() {
                        cookieCache.clear();
                        cacheTimestamp.clear();
                        lastRefreshTime = 0;
                        logger.info("üßπ –ö—ç—à cookies –æ—á–∏—â–µ–Ω");
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                     */
                    public static Map<String, Object> getCacheStats() {
                        Map<String, Object> stats = new HashMap<>();
                        stats.put("lastRefreshTime", new Date(lastRefreshTime));
                        stats.put("refreshIntervalMinutes", REFRESH_INTERVAL / 60000);
                        stats.put("cacheTTLMinutes", CACHE_TTL / 60000);
                        stats.put("cachedDomains", cookieCache.size());
                        stats.put("dynamicCookiesEnabled", Config.isDynamicCookiesEnabled());
                
                        List<String> cachedDomains = new ArrayList<>();
                        for (Map.Entry<String, Long> entry : cacheTimestamp.entrySet()) {
                            long age = System.currentTimeMillis() - entry.getValue();
                            cachedDomains.add(String.format("%s (–≤–æ–∑—Ä–∞—Å—Ç: %d –º–∏–Ω)",
                                    entry.getKey(), age / (60 * 1000)));
                        }
                        stats.put("cachedDomainsInfo", cachedDomains);
                
                        return stats;
                    }
                
                    /**
                     * –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ cookies
                     */
                    public static boolean testCookies() {
                        try {
                            String cookieHeader = getCookieHeader(PRIMARY_DOMAIN);
                
                            if (cookieHeader == null || cookieHeader.isEmpty()) {
                                logger.error("‚ùå Cookies –ø—É—Å—Ç—ã");
                                return false;
                            }
                
                            logger.info("‚úÖ Cookies –¥–æ—Å—Ç—É–ø–Ω—ã, –¥–ª–∏–Ω–∞: {} —Å–∏–º–≤–æ–ª–æ–≤", cookieHeader.length());
                
                            Map<String, String> cookies = getFreshCookies(PRIMARY_DOMAIN);
                            logger.info("üìä –ö–ª—é—á–µ–≤—ã–µ cookies:");
                
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ cookies
                            String[] keyNames = {"_m_h5_tk", "_tb_token_", "cna", "cookie2", "t"};
                            for (String key : keyNames) {
                                if (cookies.containsKey(key)) {
                                    String value = cookies.get(key);
                                    logger.info("   {}: {}", key,
                                            value.length() > 30 ? value.substring(0, 27) + "..." : value);
                                } else {
                                    logger.warn("   ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç: {}", key);
                                }
                            }
                
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º _m_h5_tk
                            if (cookies.containsKey("_m_h5_tk")) {
                                String mh5tk = cookies.get("_m_h5_tk");
                                if (mh5tk.contains("_")) {
                                    String[] parts = mh5tk.split("_", 2);
                                    logger.info("üìä –ê–Ω–∞–ª–∏–∑ _m_h5_tk:");
                                    logger.info("   –¢–æ–∫–µ–Ω: {}",
                                            parts[0].length() > 20 ? parts[0].substring(0, 17) + "..." : parts[0]);
                                    logger.info("   –í—Ä–µ–º—è: {}", parts[1]);
                                }
                            }
                
                            return true;
                        } catch (Exception e) {
                            logger.error("‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è cookies: {}", e.getMessage());
                            return false;
                        }
                    }
                
                    /**
                     * –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞
                     */
                    public static void shutdown() {
                        if (scheduler != null) {
                            scheduler.shutdown();
                            try {
                                if (!scheduler.awaitTermination(10, TimeUnit.SECONDS)) {
                                    scheduler.shutdownNow();
                                }
                            } catch (InterruptedException e) {
                                scheduler.shutdownNow();
                                Thread.currentThread().interrupt();
                            }
                            logger.info("üõë CookieService –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");
                        }
                    }
                
                    /**
                     * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤ Goofish
                     */
                    private static void updateCookieConfigForAllDomains(Map<String, String> cookies) {
                        String cookieString = cookiesToHeaderString(cookies);
                
                        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
                        CookieConfig.setCookiesForDomain(PRIMARY_DOMAIN, cookieString);
                        CookieConfig.setCookiesForDomain(API_DOMAIN, cookieString);
                        CookieConfig.setCookiesForDomain(M_DOMAIN, cookieString);
                
                        saveCookiesToProperties(cookies);
                        logger.debug("–û–±–Ω–æ–≤–ª–µ–Ω—ã cookies –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤ Goofish");
                    }
                
                    /**
                     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ cookies –≤ —Ñ–∞–π–ª properties
                     */
                    private static void saveCookiesToProperties(Map<String, String> cookies) {
                        try {
                            Properties props = new Properties();
                
                            String cookieString = cookiesToHeaderString(cookies);
                
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
                            props.setProperty("www.goofish.com.cookies", cookieString);
                            props.setProperty("h5api.m.goofish.com.cookies", cookieString);
                            props.setProperty("m.goofish.com.cookies", cookieString);
                
                            try (FileOutputStream fos = new FileOutputStream("cookies.properties")) {
                                props.store(fos, "Cookies for HTTP requests\nAuto-generated file");
                                logger.info("üíæ Cookies —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤: cookies.properties");
                            }
                
                        } catch (Exception e) {
                            logger.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è cookies: {}", e.getMessage());
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ cookies –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
                     */
                    private static Map<String, String> getCookiesFromConfig(String domain) {
                        // –ü—Ä–æ–±—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                        String cookieString = CookieConfig.getCookiesForDomain(domain);
                        if (cookieString == null || cookieString.isEmpty()) {
                            cookieString = CookieConfig.getCookiesForDomain(PRIMARY_DOMAIN);
                        }
                
                        Map<String, String> cookies = new HashMap<>();
                
                        if (cookieString != null && !cookieString.trim().isEmpty()) {
                            String[] cookiePairs = cookieString.split("; ");
                            for (String pair : cookiePairs) {
                                String[] parts = pair.split("=", 2);
                                if (parts.length == 2) {
                                    cookies.put(parts[0].trim(), parts[1].trim());
                                }
                            }
                        }
                
                        return cookies;
                    }
                
                    /**
                     * –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Map cookies –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
                     */
                    private static String cookiesToHeaderString(Map<String, String> cookies) {
                        if (cookies == null || cookies.isEmpty()) {
                            return "";
                        }
                
                        StringBuilder header = new StringBuilder();
                        for (Map.Entry<String, String> entry : cookies.entrySet()) {
                            if (header.length() > 0) {
                                header.append("; ");
                            }
                            header.append(entry.getKey()).append("=").append(entry.getValue());
                        }
                        return header.toString();
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ cookie
                     */
                    public static String getCookie(String domain, String cookieName) {
                        Map<String, String> cookies = getFreshCookies(domain);
                        return cookies.getOrDefault(cookieName, "");
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞, –¥–æ—Å—Ç—É–ø–Ω—ã –ª–∏ cookies
                     */
                    public static boolean hasValidCookies() {
                        try {
                            String cookieHeader = getCookieHeader(PRIMARY_DOMAIN);
                            return cookieHeader != null && !cookieHeader.isEmpty();
                        } catch (Exception e) {
                            return false;
                        }
                    }
                }
                ----------------------------------------

              [FILE] RealTimeCookieService.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/service/RealTimeCookieService.java
                –†–∞–∑–º–µ—Ä: 6976 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T22:42:45.81948993Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.service;
                
                import com.parser.config.Config;
                import com.parser.config.CookieConfig;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                
                import java.io.FileOutputStream;
                import java.util.*;
                import java.util.concurrent.ConcurrentHashMap;
                
                /**
                 * –°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è cookies –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                 */
                public class RealTimeCookieService {
                    private static final Logger logger = LoggerFactory.getLogger(RealTimeCookieService.class);
                
                    private static final Map<String, String> currentCookies = new ConcurrentHashMap<>();
                    private static long lastUpdateTime = 0;
                    private static final long UPDATE_INTERVAL = 60 * 60 * 1000; // 1 —á–∞—Å
                
                    // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–º–µ–Ω—ã
                    private static final String[] GOOFISH_DOMAINS = {
                            "www.goofish.com",
                            "h5api.m.goofish.com",
                            "m.goofish.com"
                    };
                
                    /**
                     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è cookies
                     */
                    public static synchronized void initialize() {
                        if (currentCookies.isEmpty() || isExpired()) {
                            refreshCookies();
                        }
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ cookies
                     */
                    private static boolean isExpired() {
                        long now = System.currentTimeMillis();
                        return (now - lastUpdateTime) > UPDATE_INTERVAL;
                    }
                
                    /**
                     * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies
                     */
                    public static synchronized boolean refreshCookies() {
                        logger.info("üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies —á–µ—Ä–µ–∑ Selenium...");
                
                        try {
                            Map<String, String> freshCookies = SeleniumCookieFetcher.getFreshCookies();
                
                            if (SeleniumCookieFetcher.validateCookies(freshCookies)) {
                                currentCookies.clear();
                                currentCookies.putAll(freshCookies);
                                lastUpdateTime = System.currentTimeMillis();
                
                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–æ–Ω—Ñ–∏–≥
                                updateAllDomains();
                
                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                                saveToJsonFile();
                
                                logger.info("‚úÖ Cookies —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã");
                                return true;
                            } else {
                                logger.error("‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è cookies –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞");
                                return false;
                            }
                        } catch (Exception e) {
                            logger.error("‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è cookies: {}", e.getMessage());
                            return false;
                        }
                    }
                
                    /**
                     * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
                     */
                    private static void updateAllDomains() {
                        String cookieString = mapToString(currentCookies);
                
                        for (String domain : GOOFISH_DOMAINS) {
                            CookieConfig.setCookiesForDomain(domain, cookieString);
                            logger.debug("–û–±–Ω–æ–≤–ª–µ–Ω—ã cookies –¥–ª—è –¥–æ–º–µ–Ω–∞: {}", domain);
                        }
                
                        // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ cookies.properties
                        saveToPropertiesFile();
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ cookies –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
                     */
                    public static String getCookieHeader(String domain) {
                        if (currentCookies.isEmpty() || isExpired()) {
                            refreshCookies();
                        }
                        return mapToString(currentCookies);
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ cookie
                     */
                    public static String getCookie(String name) {
                        if (currentCookies.isEmpty() || isExpired()) {
                            refreshCookies();
                        }
                        return currentCookies.getOrDefault(name, "");
                    }
                
                    /**
                     * –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Map –≤ —Å—Ç—Ä–æ–∫—É cookies
                     */
                    private static String mapToString(Map<String, String> cookies) {
                        if (cookies == null || cookies.isEmpty()) {
                            return "";
                        }
                
                        StringBuilder sb = new StringBuilder();
                        for (Map.Entry<String, String> entry : cookies.entrySet()) {
                            if (sb.length() > 0) {
                                sb.append("; ");
                            }
                            sb.append(entry.getKey()).append("=").append(entry.getValue());
                        }
                
                        return sb.toString();
                    }
                
                    /**
                     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ cookies –≤ properties —Ñ–∞–π–ª
                     */
                    private static void saveToPropertiesFile() {
                        try {
                            Properties props = new Properties();
                
                            String cookieString = mapToString(currentCookies);
                
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
                            for (String domain : GOOFISH_DOMAINS) {
                                props.setProperty(domain + ".cookies", cookieString);
                            }
                
                            try (FileOutputStream fos = new FileOutputStream("cookies.properties")) {
                                props.store(fos, "Auto-generated cookies for Goofish\n" + new Date());
                                logger.info("üíæ Cookies —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ cookies.properties");
                            }
                        } catch (Exception e) {
                            logger.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è cookies: {}", e.getMessage());
                        }
                    }
                
                    /**
                     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ cookies –≤ JSON —Ñ–∞–π–ª
                     */
                    private static void saveToJsonFile() {
                        try {
                            Map<String, Object> data = new HashMap<>();
                            data.put("last_updated", new Date().toString());
                            data.put("source", "real_fetch");
                            data.put("cookies", currentCookies);
                            data.put("timestamp", System.currentTimeMillis());
                
                            String json = new com.fasterxml.jackson.databind.ObjectMapper()
                                    .writerWithDefaultPrettyPrinter()
                                    .writeValueAsString(data);
                
                            try (java.io.FileWriter fw = new java.io.FileWriter("real_cookies.json")) {
                                fw.write(json);
                                logger.info("üíæ Cookies —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ real_cookies.json");
                            }
                        } catch (Exception e) {
                            logger.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è JSON cookies: {}", e.getMessage());
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ cookies
                     */
                    public static Map<String, Object> getCookieInfo() {
                        Map<String, Object> info = new HashMap<>();
                        info.put("last_update", new Date(lastUpdateTime));
                        info.put("cookie_count", currentCookies.size());
                        info.put("key_cookies", getKeyCookiesInfo());
                        info.put("domains", Arrays.asList(GOOFISH_DOMAINS));
                
                        return info;
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª—é—á–µ–≤—ã—Ö cookies
                     */
                    private static Map<String, String> getKeyCookiesInfo() {
                        Map<String, String> keyCookies = new HashMap<>();
                
                        String[] keys = {"_m_h5_tk", "_tb_token_", "cna", "cookie2", "t"};
                        for (String key : keys) {
                            if (currentCookies.containsKey(key)) {
                                String value = currentCookies.get(key);
                                keyCookies.put(key, value.length() > 50 ? value.substring(0, 47) + "..." : value);
                            }
                        }
                
                        return keyCookies;
                    }
                }
                ----------------------------------------

              [FILE] SeleniumCookieFetcher.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/service/SeleniumCookieFetcher.java
                –†–∞–∑–º–µ—Ä: 14786 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-02-02T19:05:28.386042026Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.service;
                
                import io.github.bonigarcia.wdm.WebDriverManager;
                import org.openqa.selenium.*;
                import org.openqa.selenium.chrome.ChromeDriver;
                import org.openqa.selenium.chrome.ChromeOptions;
                import org.openqa.selenium.support.ui.WebDriverWait;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                
                import java.time.Duration;
                import java.util.*;
                
                /**
                 * –°–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è cookies —á–µ—Ä–µ–∑ Selenium - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô
                 */
                public class SeleniumCookieFetcher {
                    private static final Logger logger = LoggerFactory.getLogger(SeleniumCookieFetcher.class);
                
                    /**
                     * –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è cookies –¥–ª—è Goofish - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô
                     */
                    public static Map<String, String> fetchGoofishCookies(boolean headless) {
                        logger.info("üîÑ –ó–∞–ø—É—Å–∫ Selenium –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è cookies Goofish");
                        System.out.println("=".repeat(60));
                        System.out.println("üîÑ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –ü–û–õ–£–ß–ï–ù–ò–ï COOKIES GOOFISH");
                        System.out.println("=".repeat(60));
                
                        WebDriver driver = null;
                        try {
                            // 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WebDriver
                            WebDriverManager.chromedriver().setup();
                            logger.info("‚úÖ ChromeDriver –Ω–∞—Å—Ç—Ä–æ–µ–Ω");
                
                            // 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Chrome - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø
                            ChromeOptions options = new ChromeOptions();
                
                            // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—Ç–∫–ª—é—á–∞–µ–º headless, —Ç.–∫. —Å–∞–π—Ç –µ–≥–æ –¥–µ—Ç–µ–∫—Ç–∏—Ç
                            // if (headless) {
                            //     options.addArguments("--headless=new");
                            //     logger.info("üåê –†–µ–∂–∏–º: Headless");
                            // } else {
                            //     logger.info("üåê –†–µ–∂–∏–º: –° GUI (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)");
                            // }
                            logger.info("üåê –†–µ–∂–∏–º: –° GUI (headless –¥–µ—Ç–µ–∫—Ç–∏—Ç—Å—è —Å–∞–π—Ç–æ–º)");
                
                            // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è –æ–±—Ö–æ–¥–∞ –∑–∞—â–∏—Ç—ã
                            options.addArguments("--no-sandbox");
                            options.addArguments("--disable-dev-shm-usage");
                            options.addArguments("--disable-blink-features=AutomationControlled");
                            options.addArguments("--disable-gpu");
                            options.addArguments("--window-size=1920,1080");
                            options.addArguments("--start-maximized");
                            options.addArguments("--disable-features=VizDisplayCompositor");
                            options.addArguments("--disable-software-rasterizer");
                            options.addArguments("--disable-extensions");
                            options.addArguments("--disable-logging");
                            options.addArguments("--log-level=3");
                            options.addArguments("--disable-web-security");
                            options.addArguments("--allow-running-insecure-content");
                            options.addArguments("--ignore-certificate-errors");
                
                            // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ú–µ–Ω—è–µ–º User-Agent
                            String userAgent = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";
                            options.addArguments("--user-agent=" + userAgent);
                
                            // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
                            options.setExperimentalOption("excludeSwitches", new String[]{"enable-automation"});
                            options.setExperimentalOption("useAutomationExtension", false);
                            Map<String, Object> prefs = new HashMap<>();
                            prefs.put("credentials_enable_service", false);
                            prefs.put("profile.password_manager_enabled", false);
                            options.setExperimentalOption("prefs", prefs);
                
                            // 3. –ó–∞–ø—É—Å–∫ –±—Ä–∞—É–∑–µ—Ä–∞
                            driver = new ChromeDriver(options);
                            logger.info("‚úÖ –ë—Ä–∞—É–∑–µ—Ä –∑–∞–ø—É—â–µ–Ω");
                
                            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤
                            driver.manage().timeouts().pageLoadTimeout(Duration.ofSeconds(30));
                            driver.manage().timeouts().implicitlyWait(Duration.ofSeconds(15));
                
                            // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º cna cookie
                            logger.info("üç™ –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ cna cookie...");
                
                            // 4. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Goofish
                            String url = "https://www.goofish.com";
                            logger.info("üåê –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞: {}", url);
                            driver.get(url);
                
                            // 5. –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ cna
                            logger.info("‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ cna cookie (5 —Å–µ–∫—É–Ω–¥)...");
                            Thread.sleep(5000);
                
                            // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—ã–ø–æ–ª–Ω—è–µ–º JavaScript –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ cookies
                            ((JavascriptExecutor) driver).executeScript(
                                    "window.scrollTo(0, document.body.scrollHeight * 0.3);"
                            );
                            Thread.sleep(2000);
                
                            // 6. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
                            String searchUrl = "https://www.goofish.com/search?q=test&spm=a21ybx.search.searchInput.0";
                            logger.info("üîç –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞: {}", searchUrl);
                            driver.get(searchUrl);
                
                            logger.info("‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞ (5 —Å–µ–∫—É–Ω–¥)...");
                            Thread.sleep(5000);
                
                            // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                            try {
                                // –ö–ª–∏–∫–∞–µ–º –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
                                WebElement searchInput = driver.findElement(By.cssSelector("input[type='search'], input[type='text']"));
                                searchInput.click();
                                Thread.sleep(1000);
                
                                // –í–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç
                                searchInput.sendKeys("test");
                                Thread.sleep(1000);
                
                                // –ù–∞–∂–∏–º–∞–µ–º Enter
                                searchInput.sendKeys(Keys.ENTER);
                                Thread.sleep(3000);
                            } catch (Exception e) {
                                logger.debug("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –ø–æ–ª–µ–º –ø–æ–∏—Å–∫–∞: {}", e.getMessage());
                            }
                
                            // 7. –ü—Ä–æ–≤–µ—Ä—è–µ–º cookies
                            logger.info("üç™ –ü—Ä–æ–≤–µ—Ä–∫–∞ cookies –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è...");
                            Set<Cookie> allCookies = driver.manage().getCookies();
                            logger.info("üì¶ –ù–∞–π–¥–µ–Ω–æ cookies: {}", allCookies.size());
                
                            // 8. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ API –¥–æ–º–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ cookies
                            String apiUrl = "https://h5api.m.goofish.com";
                            logger.info("üåê –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ API –¥–æ–º–µ–Ω: {}", apiUrl);
                            driver.get(apiUrl);
                            Thread.sleep(3000);
                
                            // 9. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö cookies
                            logger.info("üç™ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö cookies...");
                            allCookies = driver.manage().getCookies();
                
                            // 10. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–±–æ—Ä cookies
                            Map<String, String> goofishCookies = new LinkedHashMap<>();
                
                            // –ö–ª—é—á–µ–≤—ã–µ cookies
                            String[] importantKeys = {
                                    "_m_h5_tk", "_m_h5_tk_enc", "_samesite_flag_", "_tb_token_",
                                    "cna", "cookie2", "mtop_partitioned_detect", "t",
                                    "tfstk", "xlly_s", "x5secdata", "isg", "unb", "lgc"
                            };
                
                            for (Cookie cookie : allCookies) {
                                String name = cookie.getName();
                                String value = cookie.getValue();
                                goofishCookies.put(name, value);
                
                                // –õ–æ–≥–∏—Ä—É–µ–º –≤–∞–∂–Ω—ã–µ cookies
                                if (Arrays.asList(importantKeys).contains(name)) {
                                    logger.debug("‚úÖ –í–∞–∂–Ω—ã–π cookie: {} = {}", name,
                                            value.length() > 50 ? value.substring(0, 47) + "..." : value);
                                }
                            }
                
                            // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ cna –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
                            if (!goofishCookies.containsKey("cna")) {
                                logger.warn("‚ö†Ô∏è Cookie 'cna' –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥...");
                
                                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –º–æ–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
                                String mobileUrl = "https://m.goofish.com";
                                driver.get(mobileUrl);
                                Thread.sleep(3000);
                
                                // –ü–æ–ª—É—á–∞–µ–º cookies —Å –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
                                Set<Cookie> mobileCookies = driver.manage().getCookies();
                                for (Cookie cookie : mobileCookies) {
                                    if ("cna".equals(cookie.getName())) {
                                        goofishCookies.put("cna", cookie.getValue());
                                        logger.info("‚úÖ –ü–æ–ª—É—á–µ–Ω cna —Å –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏: {}",
                                                cookie.getValue().length() > 30 ?
                                                        cookie.getValue().substring(0, 27) + "..." : cookie.getValue());
                                        break;
                                    }
                                }
                            }
                
                            // –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                            logger.info("üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:");
                            logger.info("üì¶ –í—Å–µ–≥–æ cookies: {}", allCookies.size());
                            logger.info("üîë –í–∞–∂–Ω—ã—Ö cookies: {}", goofishCookies.size());
                
                            if (!goofishCookies.isEmpty()) {
                                logger.info("üéØ –ö–ª—é—á–µ–≤—ã–µ cookies:");
                                for (String key : importantKeys) {
                                    if (goofishCookies.containsKey(key)) {
                                        String val = goofishCookies.get(key);
                                        logger.info("   {}: {}",
                                                String.format("%-25s", key),
                                                val.length() > 50 ? val.substring(0, 47) + "..." : val);
                                    }
                                }
                            }
                
                            return goofishCookies;
                
                        } catch (Exception e) {
                            logger.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ cookies —á–µ—Ä–µ–∑ Selenium: {}", e.getMessage());
                            e.printStackTrace();
                            return Collections.emptyMap();
                        } finally {
                            // –ó–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
                            if (driver != null) {
                                try {
                                    driver.quit();
                                    logger.info("‚úÖ –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç");
                                } catch (Exception e) {
                                    logger.error("‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞: {}", e.getMessage());
                                }
                            }
                        }
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ–∂–∏—Ö cookies (–ø—É–±–ª–∏—á–Ω—ã–π –º–µ—Ç–æ–¥)
                     */
                    public static Map<String, String> getFreshCookies() {
                        return fetchGoofishCookies(false); // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—Å–µ–≥–¥–∞ —Å GUI
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ cookies —Å GUI –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                     */
                    public static Map<String, String> getFreshCookiesWithGUI() {
                        return fetchGoofishCookies(false);
                    }
                
                    /**
                     * –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö cookies - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø
                     */
                    public static boolean validateCookies(Map<String, String> cookies) {
                        if (cookies == null || cookies.isEmpty()) {
                            logger.error("‚ùå Cookies –ø—É—Å—Ç—ã –∏–ª–∏ null");
                            return false;
                        }
                
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö cookies
                        String[] requiredKeys = {"_m_h5_tk", "_tb_token_", "cna", "cookie2", "t"};
                        int foundCount = 0;
                
                        for (String key : requiredKeys) {
                            if (cookies.containsKey(key)) {
                                foundCount++;
                                String value = cookies.get(key);
                                logger.debug("‚úÖ –ù–∞–π–¥–µ–Ω {}: {}", key,
                                        value.length() > 30 ? value.substring(0, 27) + "..." : value);
                            } else {
                                logger.warn("‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–ª—é—á–µ–≤–æ–π cookie: {}", key);
                            }
                        }
                
                        // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ –Ω–µ—Ç cna, –ø—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å –µ–≥–æ
                        if (!cookies.containsKey("cna")) {
                            logger.warn("‚ö†Ô∏è Cookie 'cna' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π...");
                            String fakeCna = generateFakeCna();
                            cookies.put("cna", fakeCna);
                            foundCount++;
                            logger.info("‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –≤—Ä–µ–º–µ–Ω–Ω—ã–π cna: {}", fakeCna);
                        }
                
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º _m_h5_tk –Ω–∞ –Ω–∞–ª–∏—á–∏–µ timestamp
                        if (cookies.containsKey("_m_h5_tk")) {
                            String mh5tk = cookies.get("_m_h5_tk");
                            if (mh5tk.contains("_")) {
                                String[] parts = mh5tk.split("_", 2);
                                logger.info("üìä –ê–Ω–∞–ª–∏–∑ _m_h5_tk:");
                                logger.info("   –¢–æ–∫–µ–Ω: {}",
                                        parts[0].length() > 20 ? parts[0].substring(0, 17) + "..." : parts[0]);
                                logger.info("   –í—Ä–µ–º—è: {}", parts[1]);
                
                                // üî¥ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ —É—Å—Ç–∞—Ä–µ–ª –ª–∏ —Ç–æ–∫–µ–Ω
                                try {
                                    long tokenTime = Long.parseLong(parts[1]);
                                    long currentTime = System.currentTimeMillis();
                                    long age = currentTime - tokenTime;
                
                                    if (age > 24 * 60 * 60 * 1000) { // 24 —á–∞—Å–∞
                                        logger.warn("‚ö†Ô∏è Token _m_h5_tk —É—Å—Ç–∞—Ä–µ–ª (–≤–æ–∑—Ä–∞—Å—Ç: {} —á–∞—Å–æ–≤)", age / (60 * 60 * 1000));
                                    }
                                } catch (NumberFormatException e) {
                                    logger.warn("‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤ _m_h5_tk");
                                }
                            } else {
                                logger.warn("‚ö†Ô∏è _m_h5_tk –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç timestamp");
                            }
                        }
                
                        boolean isValid = foundCount >= 4; // –ú–∏–Ω–∏–º—É–º 4 –∫–ª—é—á–µ–≤—ã—Ö cookie
                        logger.info("üìä –í–∞–ª–∏–¥–∞—Ü–∏—è cookies: {} (–Ω–∞–π–¥–µ–Ω–æ {}/{} –∫–ª—é—á–µ–≤—ã—Ö)",
                                isValid ? "‚úÖ –£–°–ü–ï–•" : "‚ùå –û–®–ò–ë–ö–ê", foundCount, requiredKeys.length);
                
                        return isValid;
                    }
                
                    /**
                     * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ cna cookie
                     */
                    private static String generateFakeCna() {
                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π cna (—Ñ–æ—Ä–º–∞—Ç: 16 —Å–∏–º–≤–æ–ª–æ–≤)
                        String chars = "abcdefghijklmnopqrstuvwxyz0123456789";
                        Random random = new Random();
                        StringBuilder cna = new StringBuilder();
                        for (int i = 0; i < 16; i++) {
                            cna.append(chars.charAt(random.nextInt(chars.length())));
                        }
                        return cna.toString();
                    }
                }
                ----------------------------------------

              [FILE] AutoCleanupService.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/service/AutoCleanupService.java
                –†–∞–∑–º–µ—Ä: 3452 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-02-02T18:59:36.569379479Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.service;
                
                import com.parser.config.Config;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.io.File;
                import java.nio.file.*;
                import java.util.concurrent.Executors;
                import java.util.concurrent.ScheduledExecutorService;
                import java.util.concurrent.TimeUnit;
                
                public class AutoCleanupService {
                    private static final Logger logger = LoggerFactory.getLogger(AutoCleanupService.class);
                    private static ScheduledExecutorService scheduler;
                
                    public static void start() {
                        scheduler = Executors.newScheduledThreadPool(1);
                
                        // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞
                        scheduler.scheduleAtFixedRate(() -> {
                            try {
                                cleanupOldLogs();
                                cleanupTempFiles();
                                cleanupOldBackups();
                            } catch (Exception e) {
                                logger.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ñ–∞–π–ª–æ–≤: {}", e.getMessage());
                            }
                        }, 1, 24, TimeUnit.HOURS); // –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 1 —á–∞—Å, –∑–∞—Ç–µ–º –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞
                
                        logger.info("–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ –∑–∞–ø—É—â–µ–Ω");
                    }
                
                    private static void cleanupOldLogs() {
                        String logDir = "logs";
                        File dir = new File(logDir);
                        if (!dir.exists()) return;
                
                        long cutoffTime = System.currentTimeMillis() - (30L * 24 * 60 * 60 * 1000); // 30 –¥–Ω–µ–π
                
                        for (File file : dir.listFiles()) {
                            if (file.isFile() && file.lastModified() < cutoffTime) {
                                if (file.delete()) {
                                    logger.debug("–£–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –ª–æ–≥: {}", file.getName());
                                }
                            }
                        }
                    }
                
                    private static void cleanupTempFiles() {
                        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ debug —Ñ–∞–π–ª—ã –∫—É–∫
                        File currentDir = new File(".");
                        long cutoffTime = System.currentTimeMillis() - (7L * 24 * 60 * 60 * 1000); // 7 –¥–Ω–µ–π
                
                        for (File file : currentDir.listFiles()) {
                            String name = file.getName();
                            if (name.startsWith("cookies_debug_") && name.endsWith(".properties") &&
                                    file.isFile() && file.lastModified() < cutoffTime) {
                                if (file.delete()) {
                                    logger.debug("–£–¥–∞–ª–µ–Ω debug —Ñ–∞–π–ª –∫—É–∫: {}", name);
                                }
                            }
                        }
                    }
                
                    private static void cleanupOldBackups() {
                        String backupDir = "data/backups";
                        File dir = new File(backupDir);
                        if (!dir.exists()) return;
                
                        long cutoffTime = System.currentTimeMillis() - (14L * 24 * 60 * 60 * 1000); // 14 –¥–Ω–µ–π
                
                        for (File file : dir.listFiles()) {
                            if (file.isFile() && file.lastModified() < cutoffTime) {
                                if (file.delete()) {
                                    logger.debug("–£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: {}", file.getName());
                                }
                            }
                        }
                    }
                
                    public static void shutdown() {
                        if (scheduler != null) {
                            scheduler.shutdown();
                            try {
                                if (!scheduler.awaitTermination(10, TimeUnit.SECONDS)) {
                                    scheduler.shutdownNow();
                                }
                            } catch (InterruptedException e) {
                                scheduler.shutdownNow();
                                Thread.currentThread().interrupt();
                            }
                            logger.info("–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");
                        }
                    }
                }
                ----------------------------------------

              [FILE] NotificationService.java
                –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/service/NotificationService.java
                –†–∞–∑–º–µ—Ä: 6359 –±–∞–π—Ç
                –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-19T09:31:29.773206169Z
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
                ----------------------------------------
                package com.parser.service;
                
                import com.parser.model.Product;
                import com.parser.telegram.TelegramNotificationService;
                import org.slf4j.Logger;
                import org.slf4j.LoggerFactory;
                import java.util.List;
                import java.util.Map;
                
                /**
                 * –°–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
                 */
                public class NotificationService {
                    private static final Logger logger = LoggerFactory.getLogger(NotificationService.class);
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö
                     */
                    public static void sendProductNotification(int userId, List<Product> products, String query) {
                        if (products == null || products.isEmpty()) {
                            logger.debug("No products to notify for user {}", userId);
                            return;
                        }
                
                        logger.info("Sending product notification for user {}, query: {}, products: {}",
                                userId, query, products.size());
                
                        // –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram
                        sendTelegramProductNotification(userId, products, query);
                
                        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∫–∏:
                        // - Email
                        // - Webhook
                        // - Discord/Slack
                        // - SMS
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram
                     */
                    private static void sendTelegramProductNotification(int userId, List<Product> products, String query) {
                        if (products.isEmpty()) {
                            return;
                        }
                
                        try {
                            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                            TelegramNotificationService.sendProductsNotification(userId, products.size(), query);
                
                            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ –ø–æ —Ç–æ–≤–∞—Ä–∞–º (–ø–µ—Ä–≤—ã–µ 5)
                            StringBuilder message = new StringBuilder();
                            message.append("üõçÔ∏è **–î–µ—Ç–∞–ª–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤**\n\n");
                            message.append("–ó–∞–ø—Ä–æ—Å: ").append(query).append("\n\n");
                
                            for (int i = 0; i < Math.min(products.size(), 5); i++) {
                                Product p = products.get(i);
                                message.append(i + 1).append(". ").append(p.getTitle()).append("\n");
                                message.append("   üí∞ ").append(p.getPriceDisplay()).append("\n");
                                message.append("   üìç ").append(p.getLocation()).append("\n");
                                message.append("   ‚è≥ ").append(p.getAgeMinutes()).append(" –º–∏–Ω\n");
                                message.append("   üîó ").append(p.getUrl()).append("\n\n");
                            }
                
                            if (products.size() > 5) {
                                message.append("... –∏ –µ—â–µ ").append(products.size() - 5).append(" —Ç–æ–≤–∞—Ä–æ–≤\n");
                            }
                
                            TelegramNotificationService.sendMessage(userId, message.toString());
                
                            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä–≤—ã—Ö 3 —Ç–æ–≤–∞—Ä–æ–≤
                            for (int i = 0; i < Math.min(products.size(), 3); i++) {
                                Product p = products.get(i);
                                if (p.getImages() != null && !p.getImages().isEmpty()) {
                                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ sendPhotoWithCaption –≤–º–µ—Å—Ç–æ sendPhoto
                                    TelegramNotificationService.sendPhotoWithCaption(userId,
                                            p.getImages().get(0),
                                            "üì∏ " + p.getTitle());
                                }
                            }
                
                        } catch (Exception e) {
                            logger.error("Error sending Telegram notification for user {}: {}",
                                    userId, e.getMessage());
                        }
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
                     */
                    public static void sendErrorNotification(int userId, String errorMessage) {
                        logger.error("Sending error notification to user {}: {}", userId, errorMessage);
                
                        // –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram
                        TelegramNotificationService.sendErrorNotification(userId, errorMessage);
                
                        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤ —Ñ–∞–π–ª –∏–ª–∏ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
                        logErrorToFile(userId, errorMessage);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã
                     */
                    public static void sendStatusNotification(int userId, String status, String details) {
                        logger.info("Sending status notification to user {}: {}", userId, status);
                
                        TelegramNotificationService.sendStatusNotification(userId, status, details);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                     */
                    public static void sendAdminNotification(String message) {
                        logger.info("Sending admin notification: {}", message);
                
                        TelegramNotificationService.sendAdminNotification(message);
                    }
                
                    /**
                     * –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                     */
                    public static boolean sendTestNotification(int userId) {
                        logger.info("Sending test notification to user {}", userId);
                
                        return TelegramNotificationService.sendTestNotification(userId);
                    }
                
                    /**
                     * –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤ —Ñ–∞–π–ª
                     */
                    private static void logErrorToFile(int userId, String errorMessage) {
                        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥-—Ñ–∞–π–ª
                        String logEntry = String.format("[%s] User %d: %s",
                                new java.util.Date(), userId, errorMessage);
                
                        // –ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥
                        logger.error("User error: {}", logEntry);
                    }
                
                    /**
                     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–ª—É–∂–± —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                     */
                    public static Map<String, Boolean> checkNotificationServices() {
                        Map<String, Boolean> status = new java.util.HashMap<>();
                
                        status.put("telegram", TelegramNotificationService.isBotAvailable());
                        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
                
                        return status;
                    }
                
                    /**
                     * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                     */
                    public static String getNotificationStats() {
                        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –≤–µ—Å—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                        return "Notification service is operational";
                    }
                }
                ----------------------------------------

            [FILE] ProjectStructureExporter.java
              –ü—É—Ç—å: /Users/yanmore/IdeaProjects/multiParser/src/main/java/com/parser/ProjectStructureExporter.java
              –†–∞–∑–º–µ—Ä: 5639 –±–∞–π—Ç
              –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: 2026-01-18T19:50:03.384565602Z
              –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
              ----------------------------------------
              package com.parser;
              
              import java.io.*;
              import java.nio.file.*;
              import java.nio.file.attribute.BasicFileAttributes;
              
              public class ProjectStructureExporter {
                  private static final String OUTPUT_FILE = "project_structure.txt";
                  private static final String[] IGNORED_DIRS = {".git", ".idea", "target", "build", "node_modules", "out", "bin"};
                  private static final int MAX_FILE_SIZE = 1024 * 1024 * 1024; // 1MB - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è
              
                  public static void main(String[] args) throws IOException {
                      Path currentDir = Paths.get(".").toAbsolutePath().normalize();
                      System.out.println("–°–∫–∞–Ω–∏—Ä—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: " + currentDir);
              
                      try (PrintWriter writer = new PrintWriter(new FileWriter(OUTPUT_FILE))) {
                          writer.println("–°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê");
                          writer.println("=================");
                          writer.println("–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: " + currentDir);
                          writer.println("–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞: " + java.time.LocalDateTime.now());
                          writer.println("\n" + "=".repeat(80) + "\n");
              
                          Files.walkFileTree(currentDir, new SimpleFileVisitor<Path>() {
                              private int depth = 0;
              
                              @Override
                              public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) {
                                  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                                  for (String ignored : IGNORED_DIRS) {
                                      if (dir.toString().contains(File.separator + ignored)) {
                                          return FileVisitResult.SKIP_SUBTREE;
                                      }
                                  }
              
                                  // –ü–µ—á–∞—Ç–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
                                  String indent = "  ".repeat(depth);
                                  writer.println(indent + "[DIR] " + dir.getFileName());
                                  depth++;
                                  return FileVisitResult.CONTINUE;
                              }
              
                              @Override
                              public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {
                                  String indent = "  ".repeat(depth);
                                  String fileName = file.getFileName().toString();
              
                                  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∞–º —Ñ–∞–π–ª –æ—Ç—á–µ—Ç–∞
                                  if (fileName.equals(OUTPUT_FILE)) {
                                      return FileVisitResult.CONTINUE;
                                  }
              
                                  writer.println("\n" + indent + "[FILE] " + fileName);
                                  writer.println(indent + "  –ü—É—Ç—å: " + file);
                                  writer.println(indent + "  –†–∞–∑–º–µ—Ä: " + attrs.size() + " –±–∞–π—Ç");
                                  writer.println(indent + "  –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è: " + attrs.lastModifiedTime());
              
                                  // –ß–∏—Ç–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
                                  if (isTextFile(fileName) && attrs.size() <= MAX_FILE_SIZE) {
                                      writer.println(indent + "  –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:");
                                      writer.println(indent + "  " + "-".repeat(40));
                                      try {
                                          String content = Files.readString(file);
                                          String[] lines = content.split("\n");
                                          for (int i = 0; i < Math.min(lines.length, 10000); i++) { // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 100 —Å—Ç—Ä–æ–∫–∞–º–∏
                                              writer.println(indent + "  " + lines[i]);
                                          }
                                          if (lines.length > 10000) {
                                              writer.println(indent + "  ... (—Ñ–∞–π–ª —É—Å–µ—á–µ–Ω, –ø–æ–∫–∞–∑–∞–Ω–æ 100 –∏–∑ " + lines.length + " —Å—Ç—Ä–æ–∫)");
                                          }
                                      } catch (IOException e) {
                                          writer.println(indent + "  –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª (–≤–æ–∑–º–æ–∂–Ω–æ, –±–∏–Ω–∞—Ä–Ω—ã–π)");
                                      }
                                      writer.println(indent + "  " + "-".repeat(40));
                                  } else {
                                      writer.println(indent + "  [–ë–ò–ù–ê–†–ù–´–ô –§–ê–ô–õ –ò–õ–ò –°–õ–ò–®–ö–û–ú –ë–û–õ–¨–®–û–ô]");
                                  }
              
                                  return FileVisitResult.CONTINUE;
                              }
              
                              @Override
                              public FileVisitResult postVisitDirectory(Path dir, IOException exc) {
                                  depth--;
                                  return FileVisitResult.CONTINUE;
                              }
              
                              @Override
                              public FileVisitResult visitFileFailed(Path file, IOException exc) {
                                  writer.println("\n–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ —Ñ–∞–π–ª—É: " + file);
                                  return FileVisitResult.CONTINUE;
                              }
                          });
              
                          writer.println("\n" + "=".repeat(80));
                          writer.println("–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!");
                      }
              
                      System.out.println("–û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ñ–∞–π–ª: " + OUTPUT_FILE);
                  }
              
                  private static boolean isTextFile(String fileName) {
                      String[] textExtensions = {
                              ".java", ".txt", ".xml", ".html", ".htm", ".css", ".js", ".json",
                              ".properties", ".yml", ".yaml", ".md", ".gradle", ".kt", ".py",
                              ".cpp", ".c", ".h", ".hpp", ".sql", ".sh", ".bat", ".cfg", ".ini"
                      };
              
                      String lowerName = fileName.toLowerCase();
                      for (String ext : textExtensions) {
                          if (lowerName.endsWith(ext)) {
                              return true;
                          }
                      }
                      return false;
                  }
              }
              ----------------------------------------

================================================================================
–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!
